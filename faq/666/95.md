## 95. Eslint 代码检查的过程是啥？

`ESLint` 是一个用于 **静态代码分析** 的工具，主要用于检查和修复 JavaScript/TypeScript 代码中的潜在问题（如语法错误、风格问题、逻辑错误等）。以下是它的代码检查过程详解：

---

## **1. 初始化配置**
### **步骤**
1. **配置文件**：ESLint 会查找项目中的配置文件（优先级从高到低）：
    - `.eslintrc.js` / `.eslintrc.cjs` / `.eslintrc.yaml` / `.eslintrc.json`
    - `package.json` 中的 `eslintConfig` 字段。
    - 如果没有配置文件，使用内置默认规则。

2. **扩展规则**：通过 `extends` 继承社区或团队的预设规则（如 `eslint:recommended`、`airbnb`）。
   ```javascript
   module.exports = {
     extends: ['eslint:recommended', 'plugin:react/recommended'],
   };
   ```

3. **插件支持**：通过 `plugins` 加载特定框架（如 React、Vue）或工具（如 Jest）的规则。
   ```javascript
   module.exports = {
     plugins: ['react', '@typescript-eslint'],
   };
   ```

4. **解析器配置**：指定代码解析器（如 `@typescript-eslint/parser` 用于 TypeScript）。
   ```javascript
   module.exports = {
     parser: '@typescript-eslint/parser',
   };
   ```

---

## **2. 文件匹配**
### **步骤**
1. **目标文件**：通过命令行或配置文件指定要检查的文件（如 `src/**/*.{js,ts}`）。
2. **忽略文件**：通过 `.eslintignore` 或配置文件中的 `ignorePatterns` 排除不需要检查的文件。
   ```text
   # .eslintignore
   node_modules/
   dist/
   ```

---

## **3. 代码解析**
### **步骤**
1. **词法分析（Lexing）**：将代码拆分为 **Tokens**（如标识符、运算符、字符串）。
2. **语法分析（Parsing）**：根据 ECMAScript 规范生成 **抽象语法树（AST）**。

### **示例**
```javascript
const a = 1 + 2;
```
对应的 AST 结构：
```json
{
  "type": "VariableDeclaration",
  "declarations": [
    {
      "type": "VariableDeclarator",
      "id": { "type": "Identifier", "name": "a" },
      "init": {
        "type": "BinaryExpression",
        "operator": "+",
        "left": { "type": "Literal", "value": 1 },
        "right": { "type": "Literal", "value": 2 }
      }
    }
  ]
}
```

---

## **4. 规则检查**
### **步骤**
1. **遍历 AST**：ESLint 深度优先遍历 AST，访问每个节点。
2. **触发规则**：对每个节点匹配配置的规则。
    - 每条规则是一个函数，接收上下文（Context）和节点信息。
    - 如果发现违规，生成错误或警告。

### **示例规则**
```javascript
// 自定义规则：禁止使用 console.log
module.exports = {
  rules: {
    'no-console': 'error',
  },
};
```

当检查到 `console.log` 时，ESLint 会报错：
```text
error: Unexpected console statement (no-console)
```

---

## **5. 报告结果**
### **步骤**
1. **输出格式**：根据配置输出检查结果（默认格式、JSON、表格等）。
   ```bash
   eslint src/ --format table
   ```
2. **错误分级**：
    - `error`（阻塞性错误，通常导致退出码为 1）。
    - `warn`（警告，不影响退出码）。

3. **自动修复**：通过 `--fix` 尝试自动修复可修复的问题（如缩进、分号）。
   ```bash
   eslint src/ --fix
   ```

---

## **6. 集成与扩展**
### **常见场景**
1. **编辑器集成**：通过 VS Code 的 ESLint 插件实时显示错误。
2. **Git Hooks**：通过 `husky` + `lint-staged` 在提交前检查代码。
   ```json
   // package.json
   {
     "lint-staged": {
       "*.{js,ts}": "eslint --fix"
     }
   }
   ```
3. **CI/CD 流程**：在构建阶段强制执行检查。
   ```yaml
   # GitHub Actions 示例
   - name: Run ESLint
     run: npm run lint
   ```

---

## **总结**
| **阶段**         | **关键操作**                          | **工具/技术**                     |
|------------------|-------------------------------------|----------------------------------|
| 初始化配置       | 加载规则、插件、解析器                | `.eslintrc.js`, `plugins`        |
| 文件匹配         | 确定检查范围                          | `.eslintignore`, `glob` 模式      |
| 代码解析         | 生成 AST                             | `@typescript-eslint/parser`       |
| 规则检查         | 遍历 AST 并匹配规则                  | 自定义规则、社区规则集            |
| 报告结果         | 输出错误/警告，自动修复               | `--format`, `--fix`              |
| 集成扩展         | 编辑器、Git Hooks、CI/CD             | VS Code, husky, GitHub Actions   |

通过这一过程，ESLint 能高效地确保代码质量和一致性！ 🛠️
**提示**：结合 Prettier（格式化）和 TypeScript（类型检查）效果更佳。