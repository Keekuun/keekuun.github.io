## 102. git 仓库迁移应该怎么操作

### **Git 仓库迁移操作指南**

迁移 Git 仓库通常涉及 **更改远程仓库地址** 或 **完整迁移到新平台（如 GitHub → GitLab）**。以下是详细步骤：

---

## **1. 仅更改远程仓库地址（不迁移历史记录）**
如果只是更换远程仓库 URL（例如从 `https` 改为 `SSH`），可以直接修改：
```bash
# 查看当前远程仓库
git remote -v

# 修改远程仓库地址（以 origin 为例）
git remote set-url<新仓库地址>

# 验证是否修改成功
git remote -v
```
**适用场景**：仅更新仓库链接，不涉及数据迁移。

---

## **2. 完整迁移仓库（保留所有提交历史）**
### **方法 1：直接 `git clone` + `git push`（推荐）**
适用于 **迁移到新平台（如 GitHub → GitLab）**：
```bash
# 克隆原仓库（bare 模式，只下载数据，不生成工作文件）
git clone --bare https://github.com/原仓库.git

# 进入克隆的仓库目录
cd 原仓库.git

# 推送到新仓库
git push --mirror https://gitlab.com/新仓库.git

# 清理临时文件
cd ..
rm -rf 原仓库.git
```
**✅ 优点**：
- 保留所有分支、标签和提交历史。
- 无需手动添加远程仓库。

---

### **方法 2：修改本地仓库的远程地址**
如果已有本地仓库，只需更换远程地址并推送：
```bash
# 查看当前远程仓库
git remote -v

# 移除旧的远程仓库（如 origin）
git remote remove origin

# 添加新的远程仓库
git remote add origin <新仓库地址>

# 推送所有分支和标签
git push --all origin
git push --tags origin
```
**✅ 适用场景**：已有本地仓库，仅需更换远程地址。

---

## **3. 迁移部分分支（选择性迁移）**
如果只需要迁移特定分支：
```bash
# 克隆指定分支
git clone -b <分支名> --single-branch https://原仓库.git

# 添加新远程仓库
git remote add new-origin https://新仓库.git

# 推送分支到新仓库
git push new-origin <分支名>
```

---

## **4. 迁移后验证**
确保所有内容已正确迁移：
```bash
# 检查所有分支
git branch -a

# 检查所有标签
git tag

# 拉取测试
git fetch --all
git pull origin main
```

---

## **5. 常见问题**
### **❌ 报错：`remote: Repository not found`**
- 检查新仓库是否存在。
- 确认是否有推送权限。

### **❌ 报错：`Permission denied (publickey)`**
- 如果是 SSH 方式，确保已添加公钥：
  ```bash
  cat ~/.ssh/id_rsa.pub
  ```
  并粘贴到 Git 平台（GitHub/GitLab）的 SSH Keys 设置。

### **❌ 报错：`SSL certificate problem`**
- 临时关闭 SSL 验证（不推荐生产环境）：
  ```bash
  git config --global http.sslVerify false
  ```

---

## **6. 自动化脚本（一键迁移）**
```bash
#!/bin/bash

OLD_REPO="https://github.com/原仓库.git"
NEW_REPO="https://gitlab.com/新仓库.git"

git clone --bare $OLD_REPO
cd 原仓库.git
git push --mirror $NEW_REPO
cd ..
rm -rf 原仓库.git
echo "仓库迁移完成！🎉"
```

---

## **总结**
| 场景 | 推荐方法 |
|------|----------|
| **仅修改远程地址** | `git remote set-url` |
| **完整迁移（推荐）** | `git clone --bare` + `git push --mirror` |
| **选择性迁移分支** | `git clone -b <分支>` + `git push` |
| **本地仓库迁移** | `git remote remove/add` + `git push --all` |

迁移完成后，记得 **通知团队成员更新仓库地址**！  🔄