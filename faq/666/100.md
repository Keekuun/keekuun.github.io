## 100. åˆ—è¡¨åˆ†é¡µï¼Œå¿«é€Ÿç¿»é¡µä¸‹çš„ç«æ€é—®é¢˜

åœ¨åˆ—è¡¨åˆ†é¡µåœºæ™¯ä¸­ï¼Œ**å¿«é€Ÿç¿»é¡µ**å¯èƒ½å¼•å‘**ç«æ€é—®é¢˜ï¼ˆRace Conditionï¼‰**ï¼Œå³å…ˆå‘èµ·çš„è¯·æ±‚åè¿”å›ï¼Œå¯¼è‡´é¡µé¢æ˜¾ç¤ºçš„æ•°æ®ä¸å½“å‰åˆ†é¡µçŠ¶æ€ä¸ä¸€è‡´ã€‚ä»¥ä¸‹æ˜¯è§£å†³æ–¹æ¡ˆå’Œä»£ç å®ç°ï¼š

---

## **1. é—®é¢˜å¤ç°**
å‡è®¾ç”¨æˆ·å¿«é€Ÿç‚¹å‡»åˆ†é¡µæŒ‰é’®ï¼š
1. ç‚¹å‡»ç¬¬2é¡µ â†’ å‘èµ·è¯·æ±‚Aã€‚
2. ç«‹å³ç‚¹å‡»ç¬¬3é¡µ â†’ å‘èµ·è¯·æ±‚Bã€‚
3. å¦‚æœè¯·æ±‚Bå…ˆè¿”å›ï¼Œè¯·æ±‚Aåè¿”å›ï¼Œæœ€ç»ˆæ˜¾ç¤ºçš„æ˜¯ç¬¬2é¡µçš„æ•°æ®ï¼ˆé”™è¯¯çŠ¶æ€ï¼‰ã€‚

---

## **2. è§£å†³æ–¹æ¡ˆ**
### **æ–¹æ¡ˆ 1ï¼šå–æ¶ˆæ—§è¯·æ±‚**
ä½¿ç”¨ **AbortController** å–æ¶ˆæœªå®Œæˆçš„è¯·æ±‚ã€‚
```typescript
let controller: AbortController | null = null;

async function fetchPage(page: number) {
  // å–æ¶ˆä¸Šä¸€ä¸ªæœªå®Œæˆçš„è¯·æ±‚
  if (controller) controller.abort();

  controller = new AbortController();
  try {
    const response = await fetch(`/api/data?page=${page}`, {
      signal: controller.signal,
    });
    const data = await response.json();
    updateUI(data); // æ›´æ–°é¡µé¢æ•°æ®
  } catch (error) {
    if (error.name !== 'AbortError') {
      console.error('è¯·æ±‚å¤±è´¥:', error);
    }
  }
}
```

### **æ–¹æ¡ˆ 2ï¼šè¯·æ±‚æ ‡è®°ï¼ˆRequest IDï¼‰**
ä¸ºæ¯ä¸ªè¯·æ±‚åˆ†é…å”¯ä¸€IDï¼Œåªå¤„ç†æœ€æ–°è¯·æ±‚çš„å“åº”ã€‚
```typescript
let currentRequestId = 0;

async function fetchPage(page: number) {
  const requestId = ++currentRequestId;
  const response = await fetch(`/api/data?page=${page}`);
  const data = await response.json();

  // åªå¤„ç†æœ€æ–°çš„è¯·æ±‚
  if (requestId === currentRequestId) {
    updateUI(data);
  }
}
```

### **æ–¹æ¡ˆ 3ï¼šé˜²æŠ–ï¼ˆDebounceï¼‰**
é™åˆ¶è¯·æ±‚é¢‘ç‡ï¼Œç¡®ä¿åªæœ‰æœ€åä¸€æ¬¡æ“ä½œç”Ÿæ•ˆã€‚
```typescript
import { debounce } from 'lodash-es';

const debouncedFetch = debounce(async (page: number) => {
  const response = await fetch(`/api/data?page=${page}`);
  const data = await response.json();
  updateUI(data);
}, 300); // 300ms å†…åªæ‰§è¡Œæœ€åä¸€æ¬¡

function handlePageChange(page: number) {
  debouncedFetch(page);
}
```

### **æ–¹æ¡ˆ 4ï¼šç¦ç”¨åˆ†é¡µæŒ‰é’®**
åœ¨è¯·æ±‚å®Œæˆå‰ç¦ç”¨æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤æ“ä½œã€‚
```typescript
let isFetching = false;

async function fetchPage(page: number) {
  if (isFetching) return;
  isFetching = true;

  try {
    const response = await fetch(`/api/data?page=${page}`);
    const data = await response.json();
    updateUI(data);
  } finally {
    isFetching = false;
  }
}
```

---

## **3. å®Œæ•´å®ç°ï¼ˆReact ç¤ºä¾‹ï¼‰**
ç»“åˆ **AbortController** å’Œ **è¯·æ±‚æ ‡è®°**ï¼š
```tsx
import { useState, useEffect } from 'react';

function PaginatedList() {
  const [data, setData] = useState([]);
  const [page, setPage] = useState(1);
  const [controller, setController] = useState<AbortController | null>(null);
  const [requestId, setRequestId] = useState(0);

  useEffect(() => {
    const fetchData = async () => {
      // å–æ¶ˆæ—§è¯·æ±‚
      if (controller) controller.abort();
      const newController = new AbortController();
      setController(newController);

      const currentRequestId = requestId + 1;
      setRequestId(currentRequestId);

      try {
        const response = await fetch(`/api/data?page=${page}`, {
          signal: newController.signal,
        });
        const result = await response.json();

        // åªå¤„ç†æœ€æ–°è¯·æ±‚
        if (currentRequestId === requestId + 1) {
          setData(result);
        }
      } catch (error) {
        if (error.name !== 'AbortError') {
          console.error('Error:', error);
        }
      }
    };

    fetchData();
  }, [page]);

  return (
    <div>
      <ul>
        {data.map((item) => (
          <li key={item.id}>{item.name}</li>
        ))}
      </ul>
      <button onClick={() => setPage(page - 1)} disabled={page === 1}>
        ä¸Šä¸€é¡µ
      </button>
      <span>å½“å‰é¡µ: {page}</span>
      <button onClick={() => setPage(page + 1)}>ä¸‹ä¸€é¡µ</button>
    </div>
  );
}
```

---

## **4. æ–¹æ¡ˆå¯¹æ¯”**
| **æ–¹æ¡ˆ**              | **é€‚ç”¨åœºæ™¯**               | **ä¼˜ç‚¹**                      | **ç¼ºç‚¹**                     |
|-----------------------|--------------------------|------------------------------|-----------------------------|
| **å–æ¶ˆæ—§è¯·æ±‚**        | éœ€è¦å³æ—¶å“åº”çš„åœºæ™¯         | ç²¾å‡†æ§åˆ¶è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ          | éœ€è¦å¤„ç†å–æ¶ˆé”™è¯¯ï¼ˆ`AbortError`ï¼‰ |
| **è¯·æ±‚æ ‡è®°**          | ç®€å•åˆ†é¡µé€»è¾‘               | å®ç°ç®€å•                      | ä¸é€‚ç”¨äºå¹¶å‘è¯·æ±‚              |
| **é˜²æŠ–**              | ç”¨æˆ·é¢‘ç¹æ“ä½œï¼ˆå¦‚æœç´¢æ¡†ï¼‰   | å‡å°‘è¯·æ±‚å‹åŠ›                  | å»¶è¿Ÿå“åº”ï¼Œä½“éªŒå¯èƒ½å—å½±å“       |
| **ç¦ç”¨æŒ‰é’®**          | é˜²æ­¢é‡å¤æäº¤               | ç”¨æˆ·ä½“éªŒç›´è§‚                  | ä¸èƒ½è§£å†³æ‰€æœ‰ç«æ€é—®é¢˜           |

---

## **5. é¢å¤–ä¼˜åŒ–**
- **æ•°æ®é¢„åŠ è½½**ï¼šåœ¨ç”¨æˆ·æ‚¬åœåˆ†é¡µæŒ‰é’®æ—¶é¢„åŠ è½½ä¸‹ä¸€é¡µæ•°æ®ã€‚
- **æœ¬åœ°ç¼“å­˜**ï¼šç¼“å­˜å·²è¯·æ±‚çš„åˆ†é¡µæ•°æ®ï¼ˆå¦‚ä½¿ç”¨ `SWR` æˆ– `React Query`ï¼‰ã€‚

---

## **æ€»ç»“**
é€šè¿‡ **å–æ¶ˆè¯·æ±‚**ã€**è¯·æ±‚æ ‡è®°** æˆ– **é˜²æŠ–**ï¼Œå¯ä»¥æœ‰æ•ˆè§£å†³å¿«é€Ÿç¿»é¡µçš„ç«æ€é—®é¢˜ã€‚æ ¹æ®é¡¹ç›®éœ€æ±‚é€‰æ‹©åˆé€‚æ–¹æ¡ˆï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼ ğŸš€