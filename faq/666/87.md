## 87. å¦‚ä½•ä¸€æ¬¡æ€§æ¸²æŸ“åä¸‡æ¡æ•°æ®è¿˜èƒ½ä¿è¯é¡µé¢ä¸å¡é¡¿

æ¸²æŸ“å¤§é‡æ•°æ®ï¼ˆå¦‚åä¸‡æ¡ï¼‰æ—¶ï¼Œç›´æ¥æ“ä½œ DOM ä¼šå¯¼è‡´é¡µé¢å¡é¡¿ç”šè‡³å´©æºƒã€‚ä»¥ä¸‹æ˜¯å‡ ç§ä¼˜åŒ–æ–¹æ¡ˆï¼Œç¡®ä¿é«˜æ€§èƒ½æ¸²æŸ“ï¼š

---

## **1. è™šæ‹Ÿæ»šåŠ¨ï¼ˆVirtual Scrollingï¼‰**
### **åŸç†**
åªæ¸²æŸ“å½“å‰è§†å£å¯è§çš„æ•°æ®ï¼ŒåŠ¨æ€æ›¿æ¢ä¸å¯è§åŒºåŸŸçš„å†…å®¹ï¼Œå‡å°‘ DOM èŠ‚ç‚¹æ•°é‡ã€‚

### **å®ç°æ–¹å¼**
- ä½¿ç”¨ç°æˆåº“ï¼ˆæ¨èï¼‰ï¼š
    - [React](https://reactjs.org/): `react-window` æˆ– `react-virtualized`
    - [Vue](https://vuejs.org/): `vue-virtual-scroller`
    - åŸç”Ÿ JS: `IntersectionObserver` + åŠ¨æ€æ¸²æŸ“

### **ä»£ç ç¤ºä¾‹ï¼ˆReact + react-windowï¼‰**
```typescript
import { FixedSizeList as List } from 'react-window';

const BigList = () => {
  const data = Array(100000).fill().map((_, i) => `Item ${i + 1}`);

  const Row = ({ index, style }: { index: number; style: React.CSSProperties }) => (
    <div style={style}>{data[index]}</div>
  );

  return (
    <List
      height={600}    // åˆ—è¡¨å¯è§†é«˜åº¦
      itemCount={data.length}
      itemSize={50}   // æ¯é¡¹é«˜åº¦
      width="100%"
    >
      {Row}
    </List>
  );
};
```

### **ä¼˜ç‚¹**
- å†…å­˜å ç”¨æä½ï¼ˆä»…æ¸²æŸ“å‡ åä¸ª DOM èŠ‚ç‚¹ï¼‰ã€‚
- æ»šåŠ¨æµç•…ï¼Œæ— å¡é¡¿ã€‚

---

## **2. åˆ†é¡µåŠ è½½ï¼ˆPaginationï¼‰**
### **åŸç†**
å°†æ•°æ®åˆ†é¡µï¼Œç”¨æˆ·æ»šåŠ¨æˆ–ç‚¹å‡»æ—¶åŠ è½½ä¸‹ä¸€é¡µã€‚

### **å®ç°æ–¹å¼**
- å‰ç«¯åˆ†é¡µï¼šä¸€æ¬¡æ€§åŠ è½½æ•°æ®ï¼Œä½†æŒ‰é¡µæ˜¾ç¤ºã€‚
- åç«¯åˆ†é¡µï¼šæ¯æ¬¡è¯·æ±‚ä¸€é¡µæ•°æ®ï¼ˆæ¨èå¤§æ•°æ®é‡åœºæ™¯ï¼‰ã€‚

### **ä»£ç ç¤ºä¾‹ï¼ˆå‰ç«¯åˆ†é¡µï¼‰**
```typescript
const PaginatedList = () => {
  const [page, setPage] = useState(1);
  const itemsPerPage = 50;
  const data = Array(100000).fill().map((_, i) => `Item ${i + 1}`);

  const paginatedData = data.slice(
    (page - 1) * itemsPerPage,
    page * itemsPerPage
  );

  return (
    <div>
      {paginatedData.map((item) => (
        <div key={item}>{item}</div>
      ))}
      <button onClick={() => setPage(page + 1)}>Load More</button>
    </div>
  );
};
```

### **ä¼˜ç‚¹**
- å®ç°ç®€å•ã€‚
- é€‚åˆç”¨æˆ·ä¸»åŠ¨è§¦å‘çš„åœºæ™¯ã€‚

---

## **3. æ—¶é—´åˆ‡ç‰‡ï¼ˆTime Slicingï¼‰**
### **åŸç†**
å°†æ¸²æŸ“ä»»åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªå°ä»»åŠ¡ï¼Œé€šè¿‡ `requestIdleCallback` æˆ– `setTimeout` åˆ†æ‰¹æ‰§è¡Œï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚

### **ä»£ç ç¤ºä¾‹**
```typescript
const renderChunk = (data: string[], start: number, end: number) => {
  const fragment = document.createDocumentFragment();
  for (let i = start; i < end; i++) {
    const div = document.createElement('div');
    div.textContent = data[i];
    fragment.appendChild(div);
  }
  document.body.appendChild(fragment);

  if (end < data.length) {
    requestIdleCallback(() => renderChunk(data, end, Math.min(end + 100, data.length)));
  }
};

// åˆå§‹åŒ–æ¸²æŸ“
const data = Array(100000).fill().map((_, i) => `Item ${i + 1}`);
renderChunk(data, 0, 100);
```

### **ä¼˜ç‚¹**
- é¿å…é•¿æ—¶é—´å ç”¨ä¸»çº¿ç¨‹ã€‚
- å…¼å®¹æ€§è¾ƒå¥½ã€‚

---

## **4. Web Worker åå°å¤„ç†**
### **åŸç†**
å°†æ•°æ®å¤„ç†é€»è¾‘ï¼ˆå¦‚æ’åºã€è¿‡æ»¤ï¼‰æ”¾åˆ° Web Worker ä¸­æ‰§è¡Œï¼Œä¸é˜»å¡ UI çº¿ç¨‹ã€‚

### **ä»£ç ç¤ºä¾‹**
#### **Worker è„šæœ¬ï¼ˆworker.jsï¼‰**
```javascript
self.onmessage = (e) => {
  const data = e.data;
  // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
  const processedData = data.map((item, i) => `Processed ${i}`);
  postMessage(processedData);
};
```

#### **ä¸»çº¿ç¨‹**
```typescript
const worker = new Worker('worker.js');
worker.postMessage(Array(100000).fill());

worker.onmessage = (e) => {
  const processedData = e.data;
  // æ¸²æŸ“å¤„ç†åçš„æ•°æ®ï¼ˆç»“åˆè™šæ‹Ÿæ»šåŠ¨æˆ–åˆ†é¡µï¼‰
};
```

### **ä¼˜ç‚¹**
- å½»åº•è§£æ”¾ä¸»çº¿ç¨‹ã€‚
- é€‚åˆå¤æ‚æ•°æ®å¤„ç†ã€‚

---

## **5. ä¼˜åŒ– DOM æ“ä½œ**
### **å…³é”®æŠ€å·§**
- **æ–‡æ¡£ç‰‡æ®µï¼ˆDocumentFragmentï¼‰**ï¼šå‡å°‘å¤šæ¬¡ DOM æ“ä½œã€‚
  ```typescript
  const fragment = document.createDocumentFragment();
  data.forEach(item => {
    const div = document.createElement('div');
    div.textContent = item;
    fragment.appendChild(div);
  });
  document.body.appendChild(fragment);
  ```
- **é¿å…å†…è”æ ·å¼**ï¼šä½¿ç”¨ CSS ç±»æ›¿ä»£ã€‚
- **å‡å°‘å¸ƒå±€æŠ–åŠ¨**ï¼šæ‰¹é‡è¯»å–/ä¿®æ”¹ DOM å±æ€§ã€‚

---

## **6. æ€§èƒ½å¯¹æ¯”**
| **æ–¹æ¡ˆ**          | **é€‚ç”¨åœºæ™¯**               | **å†…å­˜å ç”¨** | **å®ç°å¤æ‚åº¦** |
|-------------------|--------------------------|-------------|--------------|
| è™šæ‹Ÿæ»šåŠ¨          | é•¿åˆ—è¡¨å®æ—¶æ»šåŠ¨            | æä½        | ä¸­           |
| åˆ†é¡µåŠ è½½          | ç”¨æˆ·ä¸»åŠ¨è§¦å‘åŠ è½½          | ä½          | ä½           |
| æ—¶é—´åˆ‡ç‰‡          | å…¼å®¹æ€§è¦æ±‚é«˜              | ä¸­          | ä¸­           |
| Web Worker        | å¤æ‚æ•°æ®å¤„ç†              | é«˜          | é«˜           |

---

## **æ€»ç»“**
1. **é¦–é€‰è™šæ‹Ÿæ»šåŠ¨**ï¼šé€‚ç”¨äºéœ€è¦æµç•…æ»šåŠ¨çš„é•¿åˆ—è¡¨ï¼ˆå¦‚èŠå¤©è®°å½•ã€è¡¨æ ¼ï¼‰ã€‚
2. **åˆ†é¡µåŠ è½½**ï¼šé€‚åˆç”¨æˆ·ä¸»åŠ¨æ“ä½œçš„åœºæ™¯ï¼ˆå¦‚å•†å“åˆ—è¡¨ï¼‰ã€‚
3. **æ—¶é—´åˆ‡ç‰‡/Worker**ï¼šä½œä¸ºè¡¥å……æ–¹æ¡ˆï¼Œå¤„ç†ç‰¹æ®Šéœ€æ±‚ã€‚

é€šè¿‡åˆç†é€‰æ‹©æ–¹æ¡ˆï¼Œå³ä½¿æ¸²æŸ“åä¸‡æ¡æ•°æ®ä¹Ÿèƒ½ä¿è¯é¡µé¢æµç•…ï¼ ğŸš€