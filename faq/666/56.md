## 56. package.json é‡Œé¢ sideEffects å±æ€§çš„ä½œç”¨æ˜¯å•¥

`package.json` ä¸­çš„ `sideEffects` å±æ€§æ˜¯ç”¨äº**å‘ŠçŸ¥æ‰“åŒ…å·¥å…·ï¼ˆå¦‚ Webpackã€Rollup ç­‰ï¼‰å½“å‰ npm åŒ…æˆ–é¡¹ç›®ä¸­çš„æ–‡ä»¶æ˜¯å¦æœ‰å‰¯ä½œç”¨**ï¼Œä»è€Œå¸®åŠ©æ‰“åŒ…å·¥å…·è¿›è¡Œæ›´é«˜æ•ˆçš„ Tree Shakingï¼ˆæ ‘æ‘‡ä¼˜åŒ–ï¼‰ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£æï¼š

---

### ğŸŒŸ **æ ¸å¿ƒä½œç”¨**
```mermaid
graph LR
    A[sideEffects] --> B[false: æ‰€æœ‰æ–‡ä»¶æ— å‰¯ä½œç”¨]
    A --> C[true: æ‰€æœ‰æ–‡ä»¶æœ‰å‰¯ä½œç”¨]
    A --> D[æ•°ç»„: åˆ—å‡ºæœ‰å‰¯ä½œç”¨çš„æ–‡ä»¶]
```

---

### ğŸ“Œ **å…³é”®æ¦‚å¿µ**
#### 1. **ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨ï¼Ÿ**
- **æ¨¡å—å‰¯ä½œç”¨**ï¼šå½“å¯¼å…¥ä¸€ä¸ªæ¨¡å—æ—¶ï¼Œé™¤äº†å¯¼å‡ºæˆå‘˜å¤–ï¼Œè¿˜ä¼šæ‰§è¡Œå…¶ä»–æ“ä½œï¼ˆä¾‹å¦‚ä¿®æ”¹å…¨å±€å˜é‡ã€è‡ªåŠ¨æ³¨å†Œç»„ä»¶ç­‰ï¼‰ã€‚
- **å…¸å‹å‰¯ä½œç”¨åœºæ™¯**ï¼š
  ```javascript
  // å‰¯ä½œç”¨ç¤ºä¾‹ï¼šå¯¼å…¥æ—¶è‡ªåŠ¨æ³¨å†Œå…¨å±€ç»„ä»¶
  import 'vue-global-component'
  ```

#### 2. **Tree Shaking æœºåˆ¶**
- æ‰“åŒ…å·¥å…·ä¼šé™æ€åˆ†æä»£ç ï¼Œç§»é™¤æœªè¢«ä½¿ç”¨çš„å¯¼å‡ºï¼ˆDead Codeï¼‰ã€‚
- è‹¥æ¨¡å—è¢«æ ‡è®°ä¸ºæ— å‰¯ä½œç”¨ï¼Œå³ä½¿æœªè¢«ä½¿ç”¨ä¹Ÿä¼šè¢«å®‰å…¨ç§»é™¤ã€‚

---

### ğŸ› ï¸ **é…ç½®ç¤ºä¾‹**
#### 1. **æ‰€æœ‰æ–‡ä»¶æ— å‰¯ä½œç”¨ï¼ˆæ¨èåº“ä½¿ç”¨ï¼‰**
```json
{
  "sideEffects": false
}
```
- **æ•ˆæœ**ï¼šæ‰“åŒ…å·¥å…·ä¼šæ¿€è¿›åœ°ç§»é™¤æ‰€æœ‰æœªä½¿ç”¨çš„å¯¼å‡ºã€‚

#### 2. **ç‰¹å®šæ–‡ä»¶æœ‰å‰¯ä½œç”¨**
```json
{
  "sideEffects": [
    "**/*.css",
    "**/*.scss",
    "./src/polyfill.js"
  ]
}
```
- **æ•ˆæœ**ï¼šä»…å¯¹åˆ—å‡ºçš„æ–‡ä»¶ä¿ç•™å‰¯ä½œç”¨ï¼Œå…¶ä»–æ–‡ä»¶å‚ä¸ Tree Shakingã€‚

#### 3. **æ‰€æœ‰æ–‡ä»¶æœ‰å‰¯ä½œç”¨ï¼ˆä¿å®ˆæ–¹æ¡ˆï¼‰**
```json
{
  "sideEffects": true
}
```
- **æ•ˆæœ**ï¼šç¦ç”¨ Tree Shakingï¼ˆä¸æ¨èï¼‰ã€‚

---

### ğŸ“¦ **ä¸åŒåœºæ™¯ä¸‹çš„æœ€ä½³å®è·µ**
#### 1. **UI ç»„ä»¶åº“**
```json
{
  "sideEffects": [
    "**/*.css",
    "**/*.scss"
  ]
}
```
- **åŸå› **ï¼šæ ·å¼æ–‡ä»¶éœ€è¦è¢«å¯¼å…¥ä½†æ— æ˜¾å¼å¯¼å‡ºã€‚

#### 2. **å·¥å…·å‡½æ•°åº“**
```json
{
  "sideEffects": false
}
```
- **åŸå› **ï¼šçº¯å‡½æ•°æ— å‰¯ä½œç”¨ã€‚

#### 3. **ä¸šåŠ¡é¡¹ç›®**
```json
{
  "sideEffects": [
    "./src/init-analytics.js",
    "**/*.css"
  ]
}
```
- **åŸå› **ï¼šéœ€è¦ä¿ç•™åˆå§‹åŒ–è„šæœ¬å’Œæ ·å¼æ–‡ä»¶ã€‚

---

### âš¡ **å¯¹æ„å»ºçš„å½±å“**
| é…ç½®                | Tree Shaking å¼ºåº¦ | æ„å»ºé€Ÿåº¦ | è¾“å‡ºä½“ç§¯ |
|---------------------|------------------|---------|---------|
| `false`             | æ¿€è¿›              | æœ€å¿«     | æœ€å°     |
| æŒ‡å®šæ–‡ä»¶æ•°ç»„        | ä¿å®ˆ              | ä¸­ç­‰     | ä¸­ç­‰     |
| `true`              | ç¦ç”¨              | æœ€æ…¢     | æœ€å¤§     |

---

### ğŸ” **å®é™…æ¡ˆä¾‹è§£æ**
#### 1. **æ— å‰¯ä½œç”¨é…ç½®ï¼ˆlodash-esï¼‰**
```json
// lodash-es çš„ package.json
{
  "sideEffects": false
}
```
- **æ•ˆæœ**ï¼šå…è®¸æŒ‰éœ€å¯¼å…¥å•ä¸ªå‡½æ•°ï¼š
  ```javascript
  import { debounce } from 'lodash-es' // ä»…æ‰“åŒ… debounce
  ```

#### 2. **æœ‰å‰¯ä½œç”¨é…ç½®ï¼ˆantdï¼‰**
```json
// antd çš„ package.json
{
  "sideEffects": [
    "dist/**",
    "es/**",
    "lib/**",
    "*.less"
  ]
}
```
- **åŸå› **ï¼šéœ€è¦ä¿ç•™æ ·å¼æ–‡ä»¶ï¼ˆ.lessï¼‰çš„å‰¯ä½œç”¨ã€‚

---

### âš ï¸ **å¸¸è§è¯¯åŒº**
1. **è¯¯è®¤ä¸º CSS éœ€è¦é»˜è®¤å¯¼å‡º**ï¼š
   ```javascript
   // é”™è¯¯ï¼å³ä½¿æ²¡æœ‰å¯¼å‡ºï¼ŒCSSä¹Ÿéœ€è¦æ ‡è®°ä¸ºæœ‰å‰¯ä½œç”¨
   import './styles.css' // ä¼šè¢«é”™è¯¯ç§»é™¤
   ```

2. **æ··æ·† `sideEffects` å’Œ `pure` æ ‡æ³¨**ï¼š
    - `/*#__PURE__*/`ï¼šæ ‡è®°å•ä¸ªå‡½æ•°è°ƒç”¨æ— å‰¯ä½œç”¨ã€‚
    - `sideEffects`ï¼šæ ‡è®°æ•´ä¸ªæ¨¡å—çº§åˆ«ã€‚

3. **å¿˜è®° Babel è½¬è¯‘å½±å“**ï¼š
    - è‹¥ä½¿ç”¨ Babel çš„ `@babel/preset-env`ï¼Œéœ€è®¾ç½® `modules: false` ä¿ç•™ ES æ¨¡å—è¯­æ³•ï¼š
      ```json
      // .babelrc
      {
        "presets": [
          ["@babel/preset-env", { "modules": false }]
        ]
      }
      ```

---

### ğŸ›¡ï¸ **å®‰å…¨æ£€æµ‹æ–¹æ³•**
1. **æ‰‹åŠ¨éªŒè¯å‰¯ä½œç”¨**ï¼š
   ```bash
   # ä½¿ç”¨ webpack çš„ test æ¨¡å¼
   npx webpack --mode production --json > stats.json
   ```
   åˆ†æè¾“å‡ºæ–‡ä»¶ä¸­æ˜¯å¦æ„å¤–ç§»é™¤äº†å¿…è¦ä»£ç ã€‚

2. **ä½¿ç”¨ rollup-plugin-analyzer**ï¼š
   ```javascript
   // rollup.config.js
   import analyze from 'rollup-plugin-analyzer'
   export default {
     plugins: [analyze()]
   }
   ```

---

### ğŸŒ **æµè§ˆå™¨å…¼å®¹æ€§**
- ä»…é€‚ç”¨äºæ”¯æŒ ES æ¨¡å—çš„æ‰“åŒ…å·¥å…·ï¼š
    - âœ… Webpack 4+
    - âœ… Rollup
    - âœ… Vite
    - âŒ CommonJS æ¨¡å—ç³»ç»Ÿï¼ˆéœ€è½¬æ¢ï¼‰

---

é€šè¿‡åˆç†é…ç½® `sideEffects`ï¼Œå¯ä½¿é¡¹ç›®æ„å»ºä½“ç§¯å‡å°‘ **30%-70%**ï¼ˆè§†ä»£ç ç»“æ„è€Œå®šï¼‰ã€‚å»ºè®®ç»“åˆ `production` æ¨¡å¼æ„å»ºå’Œ Bundle Analyzer æ’ä»¶è¿›è¡ŒæŒç»­ä¼˜åŒ–ã€‚