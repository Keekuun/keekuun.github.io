## 63. [ä»£ç å®ç°] JS ä¸­å¦‚ä½•å®ç°å¤§å¯¹è±¡æ·±åº¦å¯¹æ¯”

åœ¨ JavaScript ä¸­å®ç°å¤§å¯¹è±¡çš„æ·±åº¦å¯¹æ¯”ï¼ˆDeep Comparisonï¼‰æ˜¯ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦æ¯”è¾ƒä¸¤ä¸ªå¤æ‚å¯¹è±¡æ˜¯å¦å®Œå…¨ç›¸ç­‰æ—¶ï¼ˆä¾‹å¦‚åœ¨çŠ¶æ€ç®¡ç†ã€æµ‹è¯•æ–­è¨€ç­‰åœºæ™¯ï¼‰ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å®ç°æ–¹å¼åŠå…¶ä¼˜ç¼ºç‚¹åˆ†æï¼š

---

## **1. é€’å½’æ·±åº¦å¯¹æ¯”**
é€šè¿‡é€’å½’éå†å¯¹è±¡çš„æ¯ä¸€ä¸ªå±æ€§ï¼Œé€ä¸€æ¯”è¾ƒã€‚

### **ä»£ç å®ç°**
```typescript
function deepEqual(obj1: any, obj2: any): boolean {
  // 1. åŸºæœ¬ç±»å‹ç›´æ¥æ¯”è¾ƒ
  if (obj1 === obj2) return true;

  // 2. æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined
  if (obj1 == null || obj2 == null || typeof obj1 !== 'object' || typeof obj2 !== 'object') {
    return false;
  }

  // 3. æ¯”è¾ƒå¯¹è±¡çš„é”®æ•°é‡
  const keys1 = Object.keys(obj1);
  const keys2 = Object.keys(obj2);
  if (keys1.length !== keys2.length) return false;

  // 4. é€’å½’æ¯”è¾ƒæ¯ä¸ªå±æ€§
  for (const key of keys1) {
    if (!keys2.includes(key) || !deepEqual(obj1[key], obj2[key])) {
      return false;
    }
  }

  return true;
}
```

### **æµ‹è¯•ç”¨ä¾‹**
```typescript
const obj1 = { a: 1, b: { c: 2 } };
const obj2 = { a: 1, b: { c: 2 } };
const obj3 = { a: 1, b: { c: 3 } };

console.log(deepEqual(obj1, obj2)); // true
console.log(deepEqual(obj1, obj3)); // false
```

âœ… **ä¼˜ç‚¹**ï¼š
- å®Œå…¨è‡ªå®šä¹‰ï¼Œé€‚ç”¨äºä»»ä½•å¯¹è±¡ç»“æ„ã€‚
- ä¸ä¾èµ–ç¬¬ä¸‰æ–¹åº“ã€‚

âŒ **ç¼ºç‚¹**ï¼š
- é€’å½’å¯èƒ½å¯¼è‡´æ ˆæº¢å‡ºï¼ˆStack Overflowï¼‰å¦‚æœå¯¹è±¡å±‚çº§è¿‡æ·±ã€‚
- æ€§èƒ½è¾ƒå·®ï¼ˆæ—¶é—´å¤æ‚åº¦ä¸º `O(n)`ï¼Œ`n` ä¸ºå¯¹è±¡å±æ€§æ€»æ•°ï¼‰ã€‚

---

## **2. JSON.stringify å¯¹æ¯”**
å°†å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²åæ¯”è¾ƒã€‚

### **ä»£ç å®ç°**
```typescript
function deepEqualJSON(obj1: any, obj2: any): boolean {
  return JSON.stringify(obj1) === JSON.stringify(obj2);
}
```

âœ… **ä¼˜ç‚¹**ï¼š
- å®ç°ç®€å•ï¼Œä»£ç é‡å°‘ã€‚
- é€‚ç”¨äºç®€å•å¯¹è±¡ã€‚

âŒ **ç¼ºç‚¹**ï¼š
- **ä¸å¯é **ï¼šå±æ€§é¡ºåºä¸åŒä¼šå¯¼è‡´è¯¯åˆ¤ï¼ˆ`{a:1, b:2}` å’Œ `{b:2, a:1}` ä¼šè¢«è®¤ä¸ºä¸ç›¸ç­‰ï¼‰ã€‚
- æ— æ³•å¤„ç† `undefined`ã€`å‡½æ•°`ã€`Symbol` ç­‰ç‰¹æ®Šç±»å‹ã€‚
- æ€§èƒ½é—®é¢˜ï¼šå¤§å¯¹è±¡è½¬æ¢å­—ç¬¦ä¸²è€—æ—¶è¾ƒé•¿ã€‚

---

## **3. ä½¿ç”¨ Lodash çš„ `_.isEqual`**
Lodash æä¾›äº†æˆç†Ÿçš„æ·±åº¦å¯¹æ¯”æ–¹æ³•ã€‚

### **å®‰è£…**
```bash
npm install lodash
```

### **ä»£ç å®ç°**
```typescript
import _ from 'lodash';

const obj1 = { a: 1, b: { c: 2 } };
const obj2 = { a: 1, b: { c: 2 } };

console.log(_.isEqual(obj1, obj2)); // true
```

âœ… **ä¼˜ç‚¹**ï¼š
- æ”¯æŒå„ç§å¤æ‚å¯¹è±¡ï¼ˆåŒ…æ‹¬ `Map`ã€`Set`ã€`Buffer` ç­‰ï¼‰ã€‚
- æ€§èƒ½ä¼˜åŒ–è¾ƒå¥½ï¼ˆLodash å†…éƒ¨åšäº†å¤§é‡ä¼˜åŒ–ï¼‰ã€‚

âŒ **ç¼ºç‚¹**ï¼š
- éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹åº“ã€‚

---

## **4. ä½¿ç”¨ `structuredClone` å¯¹æ¯”**
é€šè¿‡æµè§ˆå™¨åŸç”Ÿ API æ·±åº¦å…‹éš†åæ¯”è¾ƒï¼ˆä»…é€‚ç”¨äºéƒ¨åˆ†åœºæ™¯ï¼‰ã€‚

### **ä»£ç å®ç°**
```typescript
function deepEqualStructuredClone(obj1: any, obj2: any): boolean {
  try {
    const clone1 = structuredClone(obj1);
    const clone2 = structuredClone(obj2);
    return JSON.stringify(clone1) === JSON.stringify(clone2);
  } catch (e) {
    return false; // ä¸æ”¯æŒå…‹éš†çš„ç±»å‹ï¼ˆå¦‚å‡½æ•°ï¼‰
  }
}
```

âœ… **ä¼˜ç‚¹**ï¼š
- æµè§ˆå™¨åŸç”Ÿæ”¯æŒï¼Œæ— éœ€é¢å¤–ä¾èµ–ã€‚

âŒ **ç¼ºç‚¹**ï¼š
- å…¼å®¹æ€§é—®é¢˜ï¼ˆæ—§æµè§ˆå™¨ä¸æ”¯æŒï¼‰ã€‚
- æ— æ³•å…‹éš†æŸäº›ç‰¹æ®Šç±»å‹ï¼ˆå¦‚å‡½æ•°ã€DOM èŠ‚ç‚¹ï¼‰ã€‚

---

## **5. æ€§èƒ½ä¼˜åŒ–ç‰ˆæ·±åº¦å¯¹æ¯”**
é’ˆå¯¹å¤§å¯¹è±¡çš„ä¼˜åŒ–æ–¹æ¡ˆï¼š
1. **ç¼“å­˜å·²æ¯”è¾ƒçš„å¯¹è±¡**ï¼Œé¿å…å¾ªç¯å¼•ç”¨å¯¼è‡´çš„æ— é™é€’å½’ã€‚
2. **éé€’å½’éå†**ï¼ˆä½¿ç”¨æ ˆæˆ–é˜Ÿåˆ—æ›¿ä»£é€’å½’ï¼‰ã€‚

### **ä»£ç å®ç°ï¼ˆéé€’å½’ + ç¼“å­˜ï¼‰**
```typescript
function deepEqualOptimized(obj1: any, obj2: any): boolean {
  const stack = [{ a: obj1, b: obj2 }];
  const cache = new Set();

  while (stack.length) {
    const { a, b } = stack.pop()!;

    if (a === b) continue;
    if (a == null || b == null || typeof a !== 'object' || typeof b !== 'object') {
      return false;
    }

    // æ£€æŸ¥ç¼“å­˜ï¼Œé¿å…å¾ªç¯å¼•ç”¨
    const cacheKey = `${a}-${b}`;
    if (cache.has(cacheKey)) continue;
    cache.add(cacheKey);

    const keysA = Object.keys(a);
    const keysB = Object.keys(b);
    if (keysA.length !== keysB.length) return false;

    for (const key of keysA) {
      if (!keysB.includes(key)) return false;
      stack.push({ a: a[key], b: b[key] });
    }
  }

  return true;
}
```

âœ… **ä¼˜ç‚¹**ï¼š
- é¿å…é€’å½’æ ˆæº¢å‡ºã€‚
- å¤„ç†å¾ªç¯å¼•ç”¨ã€‚

âŒ **ç¼ºç‚¹**ï¼š
- å®ç°å¤æ‚ã€‚

---

## **6. å¯¹æ¯”ä¸åŒæ–¹æ³•çš„é€‚ç”¨åœºæ™¯**
| æ–¹æ³•                  | é€‚ç”¨åœºæ™¯                          | æ˜¯å¦æ¨è |
|-----------------------|----------------------------------|----------|
| **é€’å½’æ·±åº¦å¯¹æ¯”**       | ç®€å•å¯¹è±¡ï¼Œæ— å¾ªç¯å¼•ç”¨              | âœ…        |
| **JSON.stringify**    | ç®€å•å¯¹è±¡ï¼Œå±æ€§é¡ºåºå›ºå®š            | âŒ        |
| **Lodash `_.isEqual`**| ä»»ä½•å¤æ‚å¯¹è±¡ï¼Œéœ€è¦é«˜å¯é æ€§        | âœ…        |
| **structuredClone**   | æµè§ˆå™¨ç¯å¢ƒï¼Œæ— éœ€æ”¯æŒç‰¹æ®Šç±»å‹      | âŒ        |
| **éé€’å½’ä¼˜åŒ–ç‰ˆ**      | è¶…å¤§å¯¹è±¡æˆ–éœ€è¦å¤„ç†å¾ªç¯å¼•ç”¨        | âœ…        |

---

## **7. æœ€ç»ˆæ¨èæ–¹æ¡ˆ**
1. **ä¸€èˆ¬åœºæ™¯**ï¼šç›´æ¥ä½¿ç”¨ **Lodash çš„ `_.isEqual`**ï¼ˆæœ€çœå¿ƒï¼‰ã€‚
2. **æ— ç¬¬ä¸‰æ–¹åº“**ï¼šç”¨ **é€’å½’æ·±åº¦å¯¹æ¯”** æˆ– **éé€’å½’ä¼˜åŒ–ç‰ˆ**ã€‚
3. **æç®€éœ€æ±‚**ï¼š`JSON.stringify`ï¼ˆä½†éœ€æ³¨æ„å±€é™æ€§ï¼‰ã€‚

---

## **8. æµ‹è¯•ç”¨ä¾‹**
```typescript
const obj1 = { a: 1, b: { c: 2 }, d: [1, 2, 3] };
const obj2 = { a: 1, b: { c: 2 }, d: [1, 2, 3] };
const obj3 = { a: 1, b: { c: 2 }, d: [1, 2, 4] };

console.log(deepEqual(obj1, obj2)); // true
console.log(deepEqual(obj1, obj3)); // false
console.log(_.isEqual(obj1, obj2)); // true (Lodash)
```

é€šè¿‡ä»¥ä¸Šæ–¹æ³•ï¼Œå¯ä»¥é«˜æ•ˆã€å¯é åœ°å®ç°å¤§å¯¹è±¡çš„æ·±åº¦å¯¹æ¯”ï¼ ğŸš€