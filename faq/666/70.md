## 70. [React] react-router 和原生路由区别

在 React 应用中，`react-router` 和原生路由（如基于浏览器 `history API` 或 `hash` 的路由）的核心区别在于 **实现方式**、**功能特性** 和 **开发体验**。以下是详细对比：

---

## **1. 核心区别对比**
| **特性**               | **react-router**                          | **原生路由**                          |
|------------------------|------------------------------------------|--------------------------------------|
| **实现原理**           | 基于 React 组件的声明式路由               | 基于 `window.location` 或 `history API` 的命令式路由 |
| **URL 同步**           | 自动同步 UI 和 URL                        | 需手动监听和更新 URL                  |
| **动态路由**           | 支持（如 `/user/:id`）                    | 需手动解析 URL 参数                   |
| **嵌套路由**           | 原生支持                                  | 需自行实现                            |
| **导航守卫**           | 提供 `Navigate`、`useNavigate` 等 API     | 需手动拦截跳转                        |
| **代码分割**           | 支持 `React.lazy` + `Suspense` 自动拆分   | 需手动实现                            |
| **SSR 支持**           | 完善（如 `StaticRouter`）                 | 需额外配置                           |
| **开发复杂度**         | 低（开箱即用）                           | 高（需处理细节）                      |

---

## **2. 实现方式对比**
### **(1) react-router**
通过 **组件化** 和 **Hooks** 实现路由：
```tsx
import { BrowserRouter, Routes, Route, Link } from 'react-router-dom';

function App() {
  return (
    <BrowserRouter>
      <nav>
        <Link to="/">Home</Link>
        <Link to="/about">About</Link>
      </nav>
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/about" element={<About />} />
        <Route path="/user/:id" element={<User />} /> {/* 动态路由 */}
      </Routes>
    </BrowserRouter>
  );
}
```

### **(2) 原生路由**
基于 `history.pushState` 或 `hashchange` 事件：
```typescript
// 命令式跳转
function navigateTo(path: string) {
  window.history.pushState({}, '', path);
  updateUI(); // 需手动更新 UI
}

// 监听路由变化
window.addEventListener('popstate', () => {
  updateUI();
});

// 手动解析动态路由
const path = window.location.pathname;
if (path.startsWith('/user/')) {
  const userId = path.split('/')[2]; // 提取参数
}
```

---

## **3. 功能特性对比**
### **(1) react-router 独有功能**
- **嵌套路由**：通过 `<Outlet>` 实现布局嵌套。
  ```tsx
  <Route path="/dashboard" element={<Dashboard />}>
    <Route path="stats" element={<Stats />} /> {/* /dashboard/stats */}
  </Route>
  ```
- **导航守卫**：通过 `<Navigate>` 或 `useNavigate` 控制跳转。
  ```tsx
  function PrivateRoute() {
    const isAuth = useAuth();
    return isAuth ? <Dashboard /> : <Navigate to="/login" />;
  }
  ```
- **懒加载**：无缝集成代码分割。
  ```tsx
  const About = React.lazy(() => import('./About'));
  <Route path="/about" element={<Suspense fallback="Loading..."><About /></Suspense>} />
  ```

### **(2) 原生路由的局限性**
- **手动同步 UI**：需监听 `popstate` 并手动渲染对应组件。
- **无内置动态路由**：需用正则表达式或字符串操作解析参数。
- **维护成本高**：复杂路由逻辑易出错。

---

## **4. 性能与 SEO**
| **维度**       | **react-router**                          | **原生路由**                          |
|----------------|------------------------------------------|--------------------------------------|
| **性能**       | 虚拟 DOM 局部更新（高效）                 | 全页面刷新或手动 DOM 操作（性能较低） |
| **SEO**        | 需配合 SSR（如 `Remix`）                  | 原生支持（但需服务器配置）            |

---

## **5. 如何选择？**
- **用 react-router 的场景**：
    - 单页应用（SPA）。
    - 需要动态路由、嵌套路由等高级功能。
    - 追求开发效率。

- **用原生路由的场景**：
    - 超轻量级页面（如静态网站）。
    - 需要完全控制路由行为（如特殊历史记录管理）。

---

## **6. 代码示例：原生路由模拟 react-router**
以下是一个简化版原生路由实现，模拟 `react-router` 的功能：
```typescript
// 原生路由模拟
class SimpleRouter {
  private routes: Record<string, () => void> = {};

  addRoute(path: string, callback: () => void) {
    this.routes[path] = callback;
  }

  navigate(path: string) {
    window.history.pushState({}, '', path);
    this.updateView();
  }

  private updateView() {
    const path = window.location.pathname;
    const handler = this.routes[path] || (() => console.error('404'));
    handler();
  }

  init() {
    window.addEventListener('popstate', () => this.updateView());
    this.updateView();
  }
}

// 使用示例
const router = new SimpleRouter();
router.addRoute('/', () => renderHome());
router.addRoute('/about', () => renderAbout());
router.init();
```

---

## **7. 总结**
- **react-router**：适合现代 React 应用，提供声明式 API 和丰富功能。
- **原生路由**：更底层，适合特殊需求或学习原理。

根据项目需求选择，大多数场景下 `react-router` 是更优解！ 🚀