## 67. Script 放在 head 里和放在 body 里有什么区别？

在 HTML 中，`<script>` 标签的放置位置（`<head>` 或 `<body>`）会对页面加载性能、DOM 解析和脚本执行顺序产生显著影响。以下是两者的核心区别和最佳实践：

---

## **1. 放在 `<head>` 中**
### **特点**
- **立即加载**：浏览器在解析到 `<head>` 中的 `<script>` 时会**立即下载并执行**脚本。
- **阻塞 DOM 解析**：脚本执行会暂停 HTML 解析，直到脚本下载并执行完成（除非使用 `async` 或 `defer`）。
- **适用场景**：
    - 需要提前初始化的全局配置（如 `polyfill`、`环境变量`）。
    - 必须在页面渲染前执行的脚本（如 `性能监控 SDK`）。

### **示例**
```html
<head>
  <script src="config.js"></script> <!-- 阻塞解析 -->
  <script src="analytics.js" async></script> <!-- 异步加载 -->
</head>
<body>
  <!-- 页面内容 -->
</body>
```

### **问题**
- **页面渲染延迟**：如果脚本较大或网络慢，用户会看到长时间的白屏。

---

## **2. 放在 `<body>` 末尾**
### **特点**
- **延迟加载**：脚本在 DOM 解析完成后才加载和执行。
- **不阻塞渲染**：页面内容会优先显示，提升用户体验。
- **适用场景**：
    - 非关键脚本（如广告、统计代码）。
    - 依赖 DOM 的脚本（如 `jQuery 插件`）。

### **示例**
```html
<body>
  <!-- 页面内容 -->
  <script src="jquery.js"></script>
  <script src="app.js"></script> <!-- 在 DOM 就绪后执行 -->
</body>
```

### **优点**
- **首屏加载更快**：用户更快看到页面内容。
- **避免脚本依赖问题**：确保 DOM 已解析完成。

---

## **3. 关键区别对比**
| **特性**               | **`<head>` 中**                | **`<body>` 末尾**              |
|------------------------|--------------------------------|--------------------------------|
| **加载时机**           | 立即加载                       | DOM 解析完成后加载             |
| **阻塞 DOM 解析**      | 是（除非用 `async/defer`）     | 否                             |
| **脚本执行顺序**       | 按出现顺序执行                 | 按出现顺序执行                 |
| **适用场景**           | 关键脚本、需提前初始化         | 非关键脚本、依赖 DOM 的脚本    |
| **用户体验**           | 可能白屏                       | 首屏更快                       |

---

## **4. 优化策略**
### **(1) 使用 `async` 或 `defer`（仅 `<head>` 有效）**
- **`async`**：脚本异步加载，下载完成后**立即执行**（不保证顺序）。
  ```html
  <script src="ad.js" async></script>
  ```
- **`defer`**：脚本异步加载，但在 **DOM 解析完成后按顺序执行**。
  ```html
  <script src="vendor.js" defer></script>
  <script src="app.js" defer></script> <!-- 保证 vendor.js 先执行 -->
  ```

### **(2) 动态加载脚本**
通过 JavaScript 按需加载脚本：
```typescript
const script = document.createElement('script');
script.src = 'dynamic.js';
document.body.appendChild(script);
```

### **(3) 模块化（ES Modules）**
使用 `type="module"`，默认行为类似 `defer`：
```html
<script type="module" src="app.js"></script> <!-- 延迟执行 -->
```

---

## **5. 最佳实践**
1. **关键脚本**：
    - 放在 `<head>` 中，加 `defer`（如框架、polyfill）。
2. **非关键脚本**：
    - 放在 `<body>` 末尾（如广告、统计代码）。
3. **依赖 DOM 的脚本**：
    - 放在 `</body>` 前，或使用 `DOMContentLoaded` 事件。
4. **大型脚本**：
    - 用 `async` 或动态加载避免阻塞。

---

## **6. 示例场景**
### **场景 1：优先加载框架**
```html
<head>
  <script src="vue.js" defer></script> <!-- 框架提前加载但不阻塞 -->
</head>
<body>
  <div id="app"></div>
  <script src="init.js"></script> <!-- 依赖 Vue，放在 DOM 后 -->
</body>
```

### **场景 2：广告脚本（非关键）**
```html
<body>
  <!-- 主要内容 -->
  <script src="ads.js" async></script> <!-- 异步加载，不阻塞 -->
</body>
```

---

## **7. 总结**
- **`<head>` + 无属性**：慎用，会阻塞渲染。
- **`<head>` + `defer`**：最佳选择，提前加载但不阻塞。
- **`<body>` 末尾**：适合非关键脚本。
- **`async`**：适合完全独立的脚本（如广告）。

合理选择位置和属性，可以显著提升页面性能！ 🚀