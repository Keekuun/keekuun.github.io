## 88. [webpack] æ‰“åŒ…æ—¶ hash ç æ˜¯å¦‚ä½•ç”Ÿæˆçš„

åœ¨ Webpack æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼Œ**hash ç **ï¼ˆå¦‚ `[hash]`ã€`[chunkhash]`ã€`[contenthash]`ï¼‰ç”¨äºç”Ÿæˆå”¯ä¸€çš„æ–‡ä»¶æ ‡è¯†ï¼Œé€šå¸¸ç”¨äºè§£å†³æµè§ˆå™¨ç¼“å­˜é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯å®ƒä»¬çš„ç”ŸæˆåŸç†å’ŒåŒºåˆ«ï¼š

---

## **1. Hash ç çš„ä½œç”¨**
- **ç¼“å­˜ä¼˜åŒ–**ï¼šé€šè¿‡æ–‡ä»¶åä¸­çš„ hash å€¼ï¼Œç¡®ä¿æ–‡ä»¶å†…å®¹å˜åŒ–æ—¶æ–‡ä»¶åä¹Ÿå˜åŒ–ï¼Œå¼ºåˆ¶æµè§ˆå™¨åŠ è½½æ–°èµ„æºã€‚
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šé¿å…ç”¨æˆ·å› ç¼“å­˜é—®é¢˜çœ‹åˆ°æ—§å†…å®¹ã€‚

---

## **2. Webpack ä¸­ä¸‰ç§ Hash ç **
| **ç±»å‹**         | **ä½œç”¨èŒƒå›´**                | **é€‚ç”¨åœºæ™¯**               |
|------------------|---------------------------|--------------------------|
| `[hash]`         | æ•´ä¸ªé¡¹ç›®çš„æ‰€æœ‰æ–‡ä»¶          | ä¸æ¨èï¼ˆä»»ä½•æ–‡ä»¶å˜åŒ–éƒ½ä¼šæ›´æ–°æ‰€æœ‰æ–‡ä»¶åï¼‰ |
| `[chunkhash]`    | å•ä¸ª chunkï¼ˆä»£ç å—ï¼‰        | é€‚ç”¨äº JS æ–‡ä»¶             |
| `[contenthash]`  | æ–‡ä»¶å†…å®¹ï¼ˆå¦‚ CSSã€å›¾ç‰‡ï¼‰     | æ¨èç”¨äº CSS æˆ–é™æ€èµ„æº     |

---

## **3. Hash ç ç”ŸæˆåŸç†**
### **(1) åŸºäºå†…å®¹çš„å“ˆå¸Œç®—æ³•**
Webpack é»˜è®¤ä½¿ç”¨ **MD4** ç®—æ³•ï¼ˆå¯é€šè¿‡é…ç½®ä¿®æ”¹ï¼‰å¯¹æ–‡ä»¶å†…å®¹è®¡ç®—å“ˆå¸Œå€¼ï¼Œç”Ÿæˆå”¯ä¸€çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼š
- **è¾“å…¥**ï¼šæ–‡ä»¶å†…å®¹ `console.log("hello")`ã€‚
- **å“ˆå¸Œè®¡ç®—**ï¼š`md4("console.log(\"hello\")")` â†’ `a1b2c3d4`ã€‚
- **è¾“å‡ºæ–‡ä»¶å**ï¼š`bundle.a1b2c3d4.js`ã€‚

### **(2) è§¦å‘æ¡ä»¶**
- **`[hash]`**ï¼šé¡¹ç›®ä¸­ä»»ä½•æ–‡ä»¶å˜åŒ–ï¼Œæ‰€æœ‰æ–‡ä»¶çš„ hash å€¼éƒ½ä¼šæ›´æ–°ã€‚
- **`[chunkhash]`**ï¼šåªæœ‰å½“å‰ chunk çš„ä¾èµ–å˜åŒ–æ—¶ï¼Œhash å€¼æ‰ä¼šæ›´æ–°ã€‚
- **`[contenthash]`**ï¼šä»…å½“æ–‡ä»¶å†…å®¹å˜åŒ–æ—¶æ›´æ–°ã€‚

---

## **4. é…ç½®ç¤ºä¾‹**
### **(1) è¾“å‡ºæ–‡ä»¶åå¸¦ hash**
```javascript
// webpack.config.js
module.exports = {
  output: {
    filename: '[name].[contenthash].js', // ä½¿ç”¨ contenthash
    path: path.resolve(__dirname, 'dist'),
  },
  plugins: [
    new MiniCssExtractPlugin({
      filename: '[name].[contenthash].css', // CSS æ–‡ä»¶ä¹Ÿç”¨ contenthash
    }),
  ],
};
```

### **(2) ä¼˜åŒ– hash çš„ç¨³å®šæ€§**
é»˜è®¤æƒ…å†µä¸‹ï¼ŒWebpack çš„ hash å¯èƒ½å› æ¨¡å— ID æˆ–ä¾èµ–é¡ºåºå˜åŒ–è€Œæ”¹å˜ï¼Œå³ä½¿å†…å®¹æœªå˜ã€‚å¯é€šè¿‡ä»¥ä¸‹é…ç½®å›ºå®š hashï¼š
```javascript
module.exports = {
  optimization: {
    moduleIds: 'deterministic', // å›ºå®šæ¨¡å— ID
    runtimeChunk: 'single',     // åˆ†ç¦» runtime ä»£ç 
  },
};
```

---

## **5. åº•å±‚å®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰**
Webpack çš„å“ˆå¸Œç”Ÿæˆæµç¨‹ï¼š
1. **è¯»å–æ–‡ä»¶å†…å®¹**ï¼šè·å–æ‰€æœ‰ chunk æˆ–æ–‡ä»¶çš„ä»£ç ã€‚
2. **è®¡ç®—å“ˆå¸Œ**ï¼š
   ```javascript
   const crypto = require('crypto');
   const content = 'console.log("hello")';
   const hash = crypto.createHash('md4').update(content).digest('hex').slice(0, 8);
   ```
3. **ç”Ÿæˆæ–‡ä»¶å**ï¼šå°†å“ˆå¸Œå€¼æ’å…¥æ–‡ä»¶åæ¨¡æ¿ï¼ˆå¦‚ `[name].[hash].js`ï¼‰ã€‚

---

## **6. æ³¨æ„äº‹é¡¹**
1. **`[hash]` vs `[chunkhash]`**ï¼š
    - ä½¿ç”¨ `[chunkhash]` æ—¶ï¼Œéœ€æ³¨æ„å…¬å…±ä¾èµ–ï¼ˆå¦‚ `node_modules`ï¼‰å˜åŒ–ä¼šå¯¼è‡´æ‰€æœ‰ chunk çš„ hash æ›´æ–°ã€‚
    - è§£å†³æ–¹æ¡ˆï¼šç”¨ `SplitChunksPlugin` åˆ†ç¦»ç¬¬ä¸‰æ–¹åº“ã€‚
      ```javascript
      optimization: {
        splitChunks: {
          chunks: 'all',
        },
      },
      ```

2. **CSS çš„ `[contenthash]`**ï¼š
    - å¦‚æœ JS ä¸­å¼•å…¥çš„ CSS å†…å®¹æœªå˜ï¼Œä½† JS å˜åŒ–ï¼Œå¯èƒ½å¯¼è‡´ CSS çš„ hash ä¹Ÿè¢«æ›´æ–°ã€‚
    - è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ `MiniCssExtractPlugin` ç‹¬ç«‹æå– CSSã€‚

---

## **7. æ€»ç»“**
| **è¦ç‚¹**               | **è¯´æ˜**                                                                 |
|------------------------|--------------------------------------------------------------------------|
| **å“ˆå¸Œç±»å‹**           | `[hash]`ï¼ˆå…¨å±€ï¼‰ã€`[chunkhash]`ï¼ˆchunk çº§ï¼‰ã€`[contenthash]`ï¼ˆæ–‡ä»¶çº§ï¼‰ã€‚ |
| **ç”Ÿæˆç®—æ³•**           | é»˜è®¤ MD4ï¼ŒåŸºäºæ–‡ä»¶å†…å®¹è®¡ç®—ã€‚                                             |
| **ç¼“å­˜ä¼˜åŒ–**           | å†…å®¹å˜åŒ– â†’ hash å˜åŒ– â†’ æ–‡ä»¶åå˜åŒ– â†’ å¼ºåˆ¶æµè§ˆå™¨æ›´æ–°ã€‚                     |
| **ç¨³å®šæ€§é…ç½®**         | å›ºå®šæ¨¡å— ID å’Œ runtime ä»£ç ï¼Œé¿å…æ— å…³ hash å˜åŒ–ã€‚                        |

---

é€šè¿‡åˆç†é…ç½® hash ç­–ç•¥ï¼Œå¯ä»¥é«˜æ•ˆç®¡ç†å‰ç«¯èµ„æºçš„ç¼“å­˜å’Œç‰ˆæœ¬æ§åˆ¶ï¼ ğŸš€