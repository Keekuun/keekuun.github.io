## 74. git merge 和 git rebase 有啥区别？

`git merge` 和 `git rebase` 是 Git 中用于 **整合分支变更** 的两种核心策略，但它们的 **工作方式** 和 **适用场景** 完全不同。以下是详细对比和最佳实践：

---

## **1. 核心区别**
| **特性**          | `git merge`                  | `git rebase`                  |
|-------------------|-----------------------------|-------------------------------|
| **提交历史**       | 保留分支的完整历史（生成合并提交） | 线性历史（重新应用提交）         |
| **冲突处理**       | 一次性解决冲突（合并提交时）     | 可能在每一步提交时遇到冲突        |
| **适用场景**       | 公共分支协作（如 `main`）      | 本地分支整理（未推送的提交）       |
| **命令示例**       | `git merge feature`         | `git rebase main`              |

---

## **2. 工作流程对比**
### **(1) `git merge`**
- **行为**：将目标分支（如 `feature`）的更改合并到当前分支（如 `main`），生成一个新的 **合并提交**。
- **示例**：
  ```bash
  git checkout main      # 切换到主分支
  git merge feature      # 合并 feature 分支
  ```
- **提交历史**：
  ```
  *   合并提交 (main)
  |\
  | * 提交 C (feature)
  | * 提交 B
  |/
  * 提交 A
  ```

### **(2) `git rebase`**
- **行为**：将当前分支的提交“重新播放”到目标分支的最新提交之后，形成线性历史。
- **示例**：
  ```bash
  git checkout feature   # 切换到 feature 分支
  git rebase main        # 将 feature 的提交变基到 main 分支
  ```
- **提交历史**：
  ```
  * 提交 C' (feature)
  * 提交 B'
  * 提交 A (main)
  ```

---

## **3. 使用场景**
### **✅ 适合 `git merge` 的情况**
- **公共分支协作**（如 `main` 或 `develop`）：保留完整的合并历史，便于追踪分支来源。
- **需要明确分支关系**：合并提交清晰展示分支的合并点。

### **✅ 适合 `git rebase` 的情况**
- **整理本地提交**：在推送前清理冗余提交（如 `fix typo`）。
- **保持线性历史**：避免合并提交污染历史（适合个人开发分支）。
- **同步上游变更**：将本地分支基于最新的 `main` 分支重新构建。

---

## **4. 风险与注意事项**
### **⚠️ `git merge` 的风险**
- **历史复杂**：频繁合并会导致提交历史杂乱（尤其是多人协作时）。
- **冗余提交**：合并提交可能包含无实际变更的内容。

### **⚠️ `git rebase` 的风险**
- **重写历史**：如果已推送分支，变基会强制覆盖远程历史（需 `git push --force`）。
- **冲突频发**：每一步提交都可能需要解决冲突（相比 `merge` 的一次性冲突）。

---

## **5. 最佳实践**
### **(1) 黄金法则**
- **不要对公共分支使用 `rebase`**：仅对未推送的本地分支变基。
- **协作时优先用 `merge`**：避免强制推送破坏他人代码。

### **(2) 常用工作流**
- **`merge` 示例（团队协作）**：
  ```bash
  git checkout main
  git pull origin main   # 同步最新代码
  git merge feature      # 合并 feature 分支
  git push origin main   # 推送合并结果
  ```

- **`rebase` 示例（本地整理）**：
  ```bash
  git checkout feature
  git rebase main        # 基于 main 分支变基
  git push --force       # 谨慎！仅用于私有分支
  ```

### **(3) 交互式变基（`rebase -i`）**
- **用途**：合并、修改或重排提交。
- **示例**：
  ```bash
  git rebase -i HEAD~3   # 编辑最近 3 个提交
  ```
    - 操作选项：`squash`（合并）、`edit`（修改）、`drop`（删除）。

---

## **6. 如何选择？**
| **需求**                | **推荐策略**       | **理由**                               |
|-------------------------|-------------------|----------------------------------------|
| 公共分支合并            | `git merge`       | 保留完整历史，避免强制推送               |
| 本地提交整理            | `git rebase -i`   | 清理冗余提交，保持历史清晰               |
| 同步上游代码            | `git rebase`      | 线性历史，避免合并提交                   |
| 多人协作                | `git merge`       | 安全，无需强制推送                       |

---

## **7. 总结**
- **`git merge`**：适合协作，保留历史，但可能杂乱。
- **`git rebase`**：适合本地整理，历史干净，但需谨慎操作。
- **核心原则**：
  🔹 **已推送的分支 → 用 `merge`**（安全第一！）。
  🔹 **未推送的分支 → 用 `rebase`**（优雅整理！）。

通过合理选择，你的 Git 历史会像 🎯 一样精准！