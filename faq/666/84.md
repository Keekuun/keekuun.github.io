## 84. ts 项目中，如何使用 node modules 里面定义的全局类型包到自己项目 src 下面使用？

在 TypeScript 项目中，如果需要在 `src` 目录下使用 `node_modules` 中定义的全局类型包（如 `@types` 或第三方库的类型声明），可以通过以下步骤实现：

---

## **1. 确保类型包已安装**
首先，确认类型包已通过 npm/yarn 安装：
```bash
npm install --save-dev @types/package-name  # 例如 @types/lodash
```
或直接安装包含类型的库：
```bash
npm install package-name  # 例如 lodash（自带类型）
```

---

## **2. 配置 `tsconfig.json`**
在项目的 `tsconfig.json` 中，确保以下配置正确：

### **(1) 包含 `node_modules` 类型**
```json
{
  "compilerOptions": {
    "types": ["package-name"],  // 显式引入全局类型包
    "typeRoots": [
      "./node_modules/@types",  // 默认类型路径
      "./src/@types"            // 自定义类型路径（可选）
    ]
  },
  "include": ["src/**/*"]       // 确保包含 src 目录
}
```

### **(2) 允许解析 `node_modules`**
```json
{
  "compilerOptions": {
    "moduleResolution": "node"  // 使用 Node.js 的模块解析策略
  }
}
```

---

## **3. 全局类型的声明扩展**
如果类型包是全局的（如 `@types/jquery`），可能需要手动扩展全局类型：

### **(1) 在 `src` 下创建声明文件**
在 `src/@types` 或 `src` 目录下新建一个 `.d.ts` 文件（如 `global.d.ts`）：
```typescript
// src/@types/global.d.ts
import "package-name";  // 导入全局类型包
```

### **(2) 扩展全局接口**
如果需要扩展全局变量或模块：
```typescript
// src/@types/global.d.ts
declare global {
  interface Window {
    myCustomProp: string;  // 扩展全局 Window 类型
  }
}
```

---

## **4. 在代码中直接使用**
完成配置后，在 `src` 下的代码中可以直接使用类型包：
```typescript
// src/index.ts
import _ from "lodash";  // 使用第三方库的类型
const list: _.List<number> = [1, 2, 3];

// 使用全局类型（如 jQuery）
declare const $: JQueryStatic;
$("#app").hide();
```

---

## **5. 处理常见问题**
### **(1) 类型找不到**
- **原因**：类型包未正确安装或 `tsconfig.json` 配置错误。
- **解决**：
  ```bash
  npm install --save-dev @types/package-name
  ```
  检查 `tsconfig.json` 的 `types` 和 `typeRoots` 配置。

### **(2) 全局类型未生效**
- **原因**：声明文件未被 TypeScript 识别。
- **解决**：
  确保 `.d.ts` 文件在 `include` 范围内，或显式引用：
  ```typescript
  /// <reference types="package-name" />
  ```

### **(3) 模块类型冲突**
- **原因**：多个类型包定义了相同的模块。
- **解决**：在 `tsconfig.json` 中指定优先级：
  ```json
  {
    "compilerOptions": {
      "paths": {
        "package-name": ["node_modules/accurate-types"]
      }
    }
  }
  ```

---

## **6. 示例项目结构**
```
project/
├── node_modules/
│   └── @types/
│       └── jquery/  # 全局类型包
├── src/
│   ├── @types/
│   │   └── global.d.ts  # 自定义全局类型
│   └── index.ts     # 使用全局类型
├── tsconfig.json
└── package.json
```

---

## **总结**
1. **安装类型包**：确保 `@types/package-name` 或自带类型的库已安装。
2. **配置 `tsconfig.json`**：设置 `types`、`typeRoots` 和 `moduleResolution`。
3. **声明全局类型**：通过 `.d.ts` 文件扩展或导入全局类型。
4. **直接使用**：在 `src` 下的代码中引用类型。

通过以上步骤，可以无缝集成 `node_modules` 中的全局类型到你的 TypeScript 项目中！ 🚀