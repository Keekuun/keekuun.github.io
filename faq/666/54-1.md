## 54-1. å¦‚æœä¸ä½¿ç”¨è„šæ‰‹æ¶ï¼Œå¦‚æœç”¨ vite æ„å»ºä¸€ä¸ªè‡ªå·±çš„ react åº”ç”¨

ä¸ä½¿ç”¨è„šæ‰‹æ¶ï¼Œæ‰‹åŠ¨é€šè¿‡ Vite æ„å»º React åº”ç”¨çš„å®Œæ•´æŒ‡å—ï¼ˆTypeScript ç‰ˆï¼‰ï¼š

---

### ğŸš€ **é¡¹ç›®åˆå§‹åŒ–**
```bash
mkdir react-vite-manual
cd react-vite-manual
npm init -y
git init
```

---

### ğŸ“¦ **æ ¸å¿ƒä¾èµ–å®‰è£…**
```bash
# React åŸºç¡€
npm install react react-dom
npm install @types/react @types/react-dom --save-dev

# Vite æ ¸å¿ƒ
npm install vite @vitejs/plugin-react --save-dev

# æ ·å¼å¤„ç†
npm install sass --save-dev

# å·¥å…·é“¾
npm install typescript @types/node --save-dev
```

---

### âš™ï¸ **Vite é…ç½®**
#### 1. `vite.config.ts` (å®Œæ•´é…ç½®)
```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [
    react({
      babel: {
        plugins: [
          ['@babel/plugin-transform-react-jsx', { runtime: 'automatic' }]
        ]
      }
    })
  ],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
      '~': path.resolve(__dirname, './public')
    }
  },
  css: {
    modules: {
      localsConvention: 'camelCaseOnly',
      generateScopedName: '[name]__[local]--[hash:base64:5]'
    },
    preprocessorOptions: {
      scss: {
        additionalData: `@import "@/styles/variables.scss";`
      }
    }
  },
  server: {
    port: 5173,
    open: true,
    cors: true,
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true,
        rewrite: path => path.replace(/^\/api/, '')
      }
    }
  },
  build: {
    outDir: 'dist',
    assetsInlineLimit: 4096,
    rollupOptions: {
      output: {
        assetFileNames: 'assets/[name].[hash].[ext]',
        chunkFileNames: 'chunks/[name].[hash].js',
        entryFileNames: 'entries/[name].[hash].js'
      }
    }
  },
  optimizeDeps: {
    include: ['react', 'react-dom']
  }
})
```

#### 2. ç¯å¢ƒå˜é‡é…ç½®
```bash
# åˆ›å»ºç¯å¢ƒæ–‡ä»¶
touch .env .env.development .env.production
```

`.env.development` ç¤ºä¾‹ï¼š
```ini
VITE_API_BASE=/api
VITE_DEBUG=true
```

`.env.production` ç¤ºä¾‹ï¼š
```ini
VITE_API_BASE=https://api.example.com
```

---

### ğŸ“ **é¡¹ç›®ç»“æ„**
```bash
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ assets/            # é™æ€èµ„æº
â”‚   â”œâ”€â”€ components/        # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ hooks/             # è‡ªå®šä¹‰Hook
â”‚   â”œâ”€â”€ styles/            # å…¨å±€æ ·å¼
â”‚   â”‚   â””â”€â”€ variables.scss # SCSSå˜é‡
â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ App.tsx            # æ ¹ç»„ä»¶
â”‚   â””â”€â”€ main.tsx           # å…¥å£æ–‡ä»¶
â”œâ”€â”€ public/                # å…¬å…±èµ„æº
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â””â”€â”€ robots.txt
â”œâ”€â”€ index.html             # å…¥å£HTML
â”œâ”€â”€ tsconfig.json
â””â”€â”€ vite.config.ts
```

---

### ğŸ–¥ï¸ **å…³é”®æ–‡ä»¶å®ç°**
#### 1. `index.html` (Viteå…¥å£)
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vite + React</title>
</head>
<body>
  <div id="root"></div>
  <script type="module" src="/src/main.tsx"></script>
</body>
</html>
```

#### 2. `src/main.tsx`
```typescript
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App'
import './styles/main.scss'

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
)
```

#### 3. `src/App.tsx` (å¸¦CSS Modules)
```typescript
import { useState } from 'react'
import styles from './App.module.scss'
import logo from './assets/vite.svg'

function App() {
  const [count, setCount] = useState(0)

  return (
    <div className={styles.container}>
      <img src={logo} className={styles.logo} alt="Vite logo" />
      <h1>Vite + React</h1>
      <button 
        onClick={() => setCount(c => c + 1)}
        className={styles.button}
      >
        Count: {count}
      </button>
    </div>
  )
}

export default App
```

#### 4. `src/App.module.scss`
```scss
.container {
  text-align: center;
  padding: 2rem;

  .logo {
    height: 6em;
    will-change: filter;
    transition: filter 300ms;

    &:hover {
      filter: drop-shadow(0 0 2em #646cffaa);
    }
  }

  .button {
    padding: 0.6em 1.2em;
    font-size: 1em;
    font-weight: 500;
    background: linear-gradient(90deg, #646cff, #61dafb);
  }
}
```

---

### ğŸ”§ **TypeScript é…ç½®**
#### `tsconfig.json`
```json
{
  "compilerOptions": {
    "target": "ESNext",
    "module": "ESNext",
    "moduleResolution": "node",
    "jsx": "react-jsx",
    "strict": true,
    "baseUrl": "./",
    "paths": {
      "@/*": ["src/*"]
    },
    "types": ["vite/client"],
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true
  },
  "include": ["src", "vite.config.ts"],
  "exclude": ["node_modules"]
}
```

---

### ğŸ“œ **NPM è„šæœ¬é…ç½®**
```json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "type-check": "tsc --noEmit",
    "lint": "eslint src --ext .ts,.tsx"
  }
}
```

---

### ğŸ› ï¸ **é«˜çº§åŠŸèƒ½æ‰©å±•**
#### 1. ç¯å¢ƒå˜é‡æ™ºèƒ½æç¤º
```typescript
// src/env.d.ts
interface ImportMetaEnv {
  readonly VITE_API_BASE: string
  readonly VITE_DEBUG: string
}

interface ImportMeta {
  readonly env: ImportMetaEnv
}
```

#### 2. SVGç»„ä»¶åŒ–
```bash
npm install @vitejs/plugin-react-svg --save-dev
```

```typescript
// vite.config.ts
import svgr from '@vitejs/plugin-react-svg'

plugins: [
  svgr({
    svgrOptions: {
      icon: true
    }
  })
]
```

ä½¿ç”¨ç¤ºä¾‹ï¼š
```typescript
import { ReactComponent as Logo } from './logo.svg'
<Logo className="icon" />
```

#### 3. æ€§èƒ½ä¼˜åŒ–é…ç½®
```typescript
// vite.config.ts
build: {
  chunkSizeWarningLimit: 1000,
  rollupOptions: {
    output: {
      manualChunks(id) {
        if (id.includes('node_modules')) {
          return 'vendor'
        }
      }
    }
  }
}
```

---

### ğŸ” **å¼€å‘ä¸ç”Ÿäº§å·®å¼‚**
| åŠŸèƒ½         | å¼€å‘æ¨¡å¼                      | ç”Ÿäº§æ¨¡å¼                     |
|--------------|-----------------------------|----------------------------|
| æºç          | æœªç¼–è¯‘                       | å‹ç¼©+æ··æ·†                  |
| é”™è¯¯æç¤º     | å®Œæ•´å †æ ˆ                     | ç®€åŒ–ä¿¡æ¯                   |
| ç¯å¢ƒå˜é‡     | .env.development             | .env.production            |
| çƒ­æ›´æ–°       | æ”¯æŒ                         | æ—                         |
| èµ„æºè·¯å¾„     | /src/...                    | /assets/...               |

---

### âš¡ **æ€§èƒ½ä¼˜åŒ–æŠ€å·§**
1. **å›¾ç‰‡å‹ç¼©**
   ```bash
   npm install vite-plugin-imagemin --save-dev
   ```
   ```typescript
   import imagemin from 'vite-plugin-imagemin'
   plugins: [
     imagemin({
       gifsicle: { optimizationLevel: 3 },
       mozjpeg: { quality: 75 },
       pngquant: { quality: [0.8, 0.9] }
     })
   ]
   ```

2. **æŒ‰éœ€åŠ è½½**
   ```typescript
   const HeavyComponent = React.lazy(() => import('./HeavyComponent'))
   <Suspense fallback={<Loading />}>
     <HeavyComponent />
   </Suspense>
   ```

3. **CDN å¼•å…¥**
   ```typescript
   // vite.config.ts
   import { splitVendorChunkPlugin } from 'vite'
   plugins: [
     splitVendorChunkPlugin()
   ]
   ```

---

### ğŸ›¡ï¸ **å®‰å…¨åŠ å›ºæ–¹æ¡ˆ**
1. **CSP ç­–ç•¥**
   ```html
   <!-- index.html -->
   <meta http-equiv="Content-Security-Policy" content="default-src 'self'">
   ```

2. **æ•æ„Ÿä¿¡æ¯ä¿æŠ¤**
   ```bash
   npm install vite-plugin-env-compatible --save-dev
   ```
   ```typescript
   // vite.config.ts
   import envCompatible from 'vite-plugin-env-compatible'
   plugins: [
     envCompatible({ prefix: 'VITE_' })
   ]
   ```

---

### âš ï¸ **å¸¸è§é—®é¢˜è§£å†³**
1. **çƒ­æ›´æ–°å¤±æ•ˆ**ï¼š
   ```typescript
   server: {
     watch: {
       usePolling: true // è§£å†³WSL2ä¸‹çš„HMRé—®é¢˜
     }
   }
   ```

2. **è·¯å¾„åˆ«åæŠ¥é”™**ï¼š
   ```bash
   npm install @types/node --save-dev
   ```

3. **SCSSå˜é‡å…¨å±€æ³¨å…¥**ï¼š
   ```typescript
   css: {
     preprocessorOptions: {
       scss: {
         additionalData: `@import "@/styles/variables.scss";`
       }
     }
   }
   ```

---

### ğŸŒŸ **Vite ä¼˜åŠ¿ä½“ç°**
```mermaid
pie
    title Vite vs Webpack æ„å»ºé€Ÿåº¦
    "Viteå†·å¯åŠ¨" : 0.5
    "Webpackå†·å¯åŠ¨" : 15
    "Viteçƒ­æ›´æ–°" : 0.1
    "Webpackçƒ­æ›´æ–°" : 1.5
```

é€šè¿‡è¿™å¥—é…ç½®ï¼Œä½ å°†è·å¾—ï¼š
- é—ªç”µèˆ¬çš„å¯åŠ¨å’Œçƒ­æ›´æ–°
- å¼€ç®±å³ç”¨çš„TypeScriptæ”¯æŒ
- ç°ä»£åŒ–çš„CSSå¤„ç†æ–¹æ¡ˆ
- é«˜åº¦å¯å®šåˆ¶çš„æ„å»ºæµç¨‹
- ç”Ÿäº§çº§ä¼˜åŒ–é…ç½®

éœ€è¦æ‰©å±•æµ‹è¯•é…ç½®(Jest/Vitest)ã€çŠ¶æ€ç®¡ç†(Redux/Zustand)æˆ–è·¯ç”±æ–¹æ¡ˆ(React Router)çš„å®ç°å—ï¼Ÿå¯ä»¥è¿›ä¸€æ­¥æ¢è®¨å…·ä½“éœ€æ±‚ã€‚