## 126. [React] å¦‚ä½•é¿å…ä¸å¿…è¦çš„æ¸²æŸ“ï¼Ÿ

åœ¨ React ä¸­ï¼Œé¿å…ä¸å¿…è¦çš„æ¸²æŸ“æ˜¯ä¼˜åŒ–æ€§èƒ½çš„å…³é”®ä¹‹ä¸€ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ–¹æ³•å’ŒæŠ€å·§ï¼Œå¸®åŠ©ä½ å‡å°‘ä¸å¿…è¦çš„æ¸²æŸ“ï¼š

---

### 1. **ä½¿ç”¨ `React.memo` è¿›è¡Œç»„ä»¶è®°å¿†**
`React.memo` æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œç”¨äºå¯¹å‡½æ•°ç»„ä»¶è¿›è¡Œæµ…æ¯”è¾ƒï¼ˆshallow comparisonï¼‰ï¼Œé¿å…åœ¨ props æœªå˜åŒ–æ—¶é‡æ–°æ¸²æŸ“ã€‚

```tsx
import React from 'react';

const MyComponent = React.memo(({ name }: { name: string }) => {
  console.log('MyComponent æ¸²æŸ“');
  return <div>{name}</div>;
});

// ä½¿ç”¨ç¤ºä¾‹
const App = () => {
  const [count, setCount] = React.useState(0);
  return (
    <div>
      <button onClick={() => setCount(count + 1)}>ç‚¹å‡» {count}</button>
      <MyComponent name="å›ºå®šå€¼" /> {/* ä¸ä¼šå›  count å˜åŒ–è€Œé‡æ–°æ¸²æŸ“ */}
    </div>
  );
};
```

---

### 2. **ä½¿ç”¨ `useMemo` ç¼“å­˜è®¡ç®—ç»“æœ**
`useMemo` å¯ä»¥ç¼“å­˜è®¡ç®—ç»“æœï¼Œé¿å…åœ¨ä¾èµ–é¡¹æœªå˜åŒ–æ—¶é‡å¤è®¡ç®—ã€‚

```tsx
import React from 'react';

const ExpensiveComponent = ({ list }: { list: number[] }) => {
  const sum = React.useMemo(() => {
    console.log('é‡æ–°è®¡ç®— sum');
    return list.reduce((acc, num) => acc + num, 0);
  }, [list]); // ä»…åœ¨ list å˜åŒ–æ—¶é‡æ–°è®¡ç®—

  return <div>æ€»å’Œ: {sum}</div>;
};
```

---

### 3. **ä½¿ç”¨ `useCallback` ç¼“å­˜å‡½æ•°**
`useCallback` å¯ä»¥ç¼“å­˜å‡½æ•°ï¼Œé¿å…å› çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“å¯¼è‡´å­ç»„ä»¶çš„å‡½æ•°å¼•ç”¨å˜åŒ–ã€‚

```tsx
import React from 'react';

const ChildComponent = React.memo(({ onClick }: { onClick: () => void }) => {
  console.log('ChildComponent æ¸²æŸ“');
  return <button onClick={onClick}>ç‚¹å‡»æˆ‘</button>;
});

const ParentComponent = () => {
  const [count, setCount] = React.useState(0);

  const handleClick = React.useCallback(() => {
    console.log('ç‚¹å‡»äº‹ä»¶');
  }, []); // ä¾èµ–é¡¹ä¸ºç©ºï¼Œå‡½æ•°å¼•ç”¨ä¸å˜

  return (
    <div>
      <button onClick={() => setCount(count + 1)}>æ›´æ–°çˆ¶ç»„ä»¶ {count}</button>
      <ChildComponent onClick={handleClick} /> {/* ä¸ä¼šå› çˆ¶ç»„ä»¶æ›´æ–°è€Œé‡æ–°æ¸²æŸ“ */}
    </div>
  );
};
```

---

### 4. **é¿å…åœ¨ `JSX` ä¸­ç›´æ¥å®šä¹‰å¯¹è±¡æˆ–å‡½æ•°**
åœ¨ `JSX` ä¸­ç›´æ¥å®šä¹‰å¯¹è±¡æˆ–å‡½æ•°ä¼šå¯¼è‡´æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ç”Ÿæˆæ–°çš„å¼•ç”¨ï¼Œå¯èƒ½è§¦å‘å­ç»„ä»¶çš„ä¸å¿…è¦æ¸²æŸ“ã€‚

```tsx
// âŒ ä¸æ¨è
<ChildComponent style={{ color: 'red' }} onClick={() => console.log('ç‚¹å‡»')} />

// âœ… æ¨è
const style = { color: 'red' };
const handleClick = () => console.log('ç‚¹å‡»');
<ChildComponent style={style} onClick={handleClick} />
```

---

### 5. **ä½¿ç”¨ `shouldComponentUpdate`ï¼ˆç±»ç»„ä»¶ï¼‰**
å¦‚æœæ˜¯ç±»ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡ `shouldComponentUpdate` æ‰‹åŠ¨æ§åˆ¶æ˜¯å¦é‡æ–°æ¸²æŸ“ã€‚

```tsx
class MyComponent extends React.Component {
  shouldComponentUpdate(nextProps) {
    // ä»…å½“ name å˜åŒ–æ—¶æ‰é‡æ–°æ¸²æŸ“
    return nextProps.name !== this.props.name;
  }

  render() {
    return <div>{this.props.name}</div>;
  }
}
```

---

### 6. **é¿å…ä¸å¿…è¦çš„çŠ¶æ€æ›´æ–°**
ç¡®ä¿ `setState` åªåœ¨æ•°æ®å®é™…å˜åŒ–æ—¶è°ƒç”¨ã€‚

```tsx
const [user, setUser] = React.useState({ name: 'Alice', age: 25 });

// âŒ ä¸æ¨èï¼ˆå³ä½¿ name æœªå˜åŒ–ä¹Ÿä¼šè§¦å‘æ¸²æŸ“ï¼‰
setUser({ ...user, name: 'Alice' });

// âœ… æ¨èï¼ˆä»…åœ¨ name å˜åŒ–æ—¶æ›´æ–°ï¼‰
if (user.name !== 'Alice') {
  setUser({ ...user, name: 'Alice' });
}
```

---

### 7. **ä½¿ç”¨ `React DevTools` æ£€æµ‹æ¸²æŸ“**
é€šè¿‡ React DevTools çš„ **Highlight Updates** åŠŸèƒ½ï¼Œå¯ä»¥ç›´è§‚åœ°çœ‹åˆ°å“ªäº›ç»„ä»¶åœ¨é‡æ–°æ¸²æŸ“ã€‚

---

### 8. **é¿å…æ»¥ç”¨ Context**
`Context` çš„æ›´æ–°ä¼šè§¦å‘æ‰€æœ‰æ¶ˆè´¹è€…ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¼˜åŒ–ï¼š
- å°† `Context` æ‹†åˆ†ä¸ºå¤šä¸ªå°çš„ `Context`ã€‚
- ä½¿ç”¨ `useMemo` æˆ– `useCallback` ç¼“å­˜ `Context` æä¾›çš„å€¼ã€‚

```tsx
const UserContext = React.createContext();

const UserProvider = ({ children }) => {
  const [user, setUser] = React.useState({ name: 'Alice', age: 25 });

  const value = React.useMemo(() => ({ user, setUser }), [user]);

  return <UserContext.Provider value={value}>{children}</UserContext.Provider>;
};
```

---

### 9. **ä½¿ç”¨ `React.lazy` å’Œ `Suspense` æŒ‰éœ€åŠ è½½ç»„ä»¶**
é€šè¿‡ä»£ç åˆ†å‰²ï¼ˆcode splittingï¼‰å‡å°‘åˆå§‹åŠ è½½æ—¶çš„æ¸²æŸ“å‹åŠ›ã€‚

```tsx
const LazyComponent = React.lazy(() => import('./LazyComponent'));

const App = () => (
  <React.Suspense fallback={<div>åŠ è½½ä¸­...</div>}>
    <LazyComponent />
  </React.Suspense>
);
```

---

### æ€»ç»“
- **è®°å¿†åŒ–**ï¼š`React.memo`ã€`useMemo`ã€`useCallback`ã€‚
- **é¿å…ä¸å¿…è¦çš„å¼•ç”¨å˜åŒ–**ï¼šä¸è¦åœ¨ `JSX` ä¸­ç›´æ¥å®šä¹‰å¯¹è±¡æˆ–å‡½æ•°ã€‚
- **æ‰‹åŠ¨æ§åˆ¶æ¸²æŸ“**ï¼š`shouldComponentUpdate` æˆ–æ¡ä»¶æ›´æ–°çŠ¶æ€ã€‚
- **å·¥å…·è¾…åŠ©**ï¼šä½¿ç”¨ React DevTools æ£€æµ‹æ¸²æŸ“ã€‚
- **ä¼˜åŒ– Context**ï¼šæ‹†åˆ†æˆ–ç¼“å­˜ `Context` å€¼ã€‚

é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘ä¸å¿…è¦çš„æ¸²æŸ“ï¼Œæå‡ React åº”ç”¨çš„æ€§èƒ½ï¼ ğŸš€