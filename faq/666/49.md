## 49. html 中前缀为 data- 开头的元素属性是什么？

# HTML中的data-*自定义数据属性

## 一、基本概念与语法

`data-*`属性是HTML5引入的一种自定义数据存储机制，允许开发者在HTML元素上嵌入专有数据：

```html
<!-- 基本使用示例 -->
<div id="user-card" 
     data-user-id="12345" 
     data-user-role="admin" 
     data-registration-date="2023-01-15">
  John Doe
</div>
```

### 命名规则：
- 必须以`data-`开头
- 不能包含大写字母（会被自动转换为小写）
- 建议使用kebab-case（短横线连接）命名方式
- 在JavaScript中通过驼峰式访问

## 二、核心特性

### 1. 数据存储能力
```typescript
interface HTMLElement {
  // TypeScript类型定义
  dataset: DOMStringMap;
}

// 实际存储结构
const element = document.getElementById('user-card');
console.log(element.dataset);
/*
{
  userId: "12345",
  userRole: "admin",
  registrationDate: "2023-01-15"
}
*/
```

### 2. 数据类型支持
- 存储值总是字符串类型
- 复杂数据需要序列化：
```html
<div data-user='{"id":12345,"name":"John"}'></div>
```

```typescript
// 读取JSON数据
const user = JSON.parse(element.dataset.user);
```

## 三、与标准属性的对比

| 特性                | 标准属性          | data-*属性           |
|--------------------|------------------|---------------------|
| 命名规范            | 预定义的有限集合   | 完全自定义           |
| 浏览器处理          | 有特殊行为        | 仅作为数据存储       |
| 可访问性           | 可能影响ARIA      | 纯粹数据存储         |
| 类型转换            | 自动类型转换      | 始终为字符串         |
| CSS访问             | 可直接使用        | 需通过attr()函数     |

## 四、实际应用场景

### 1. 前端框架集成
```vue
<!-- Vue示例 -->
<template>
  <div :data-test-id="componentName"></div>
</template>

<script setup>
const componentName = 'user-profile';
</script>
```

```typescript
// React示例
function Component() {
  return (
    <div data-testid="component-root">
      {/* ... */}
    </div>
  );
}
```

### 2. 测试标识
```tsx
// 测试代码
import { render, screen } from '@testing-library/react';

// 组件
function MyComponent() {
   return <button data-testid="submit-button">提交</button>;
}

// 测试
test('点击提交按钮', () => {
   render(<MyComponent />);

   // 通过 data-testid 查找元素
   const button = screen.getByTestId('submit-button');

   expect(button).toBeInTheDocument();
});

```

> [Testing Library API: screen.getByTestId](https://testing-library.com/docs/queries/bytestid)

### 3. 状态管理
```html
<div class="modal" data-modal-state="closed">
  <!-- 内容 -->
</div>
```

```typescript
// 状态切换
function toggleModal() {
  const modal = document.querySelector('.modal');
  const currentState = modal.dataset.modalState;
  modal.dataset.modalState = currentState === 'open' ? 'closed' : 'open';
}
```

## 五、高级用法

### 1. CSS基于数据的样式
```css
/* 根据数据属性设置样式 */
[data-priority="high"] {
  border-left: 3px solid red;
}

[data-theme="dark"] {
  background-color: #333;
  color: white;
}

/* 使用attr()函数显示内容 */
.tooltip::after {
  content: attr(data-tooltip);
}
```

### 2. 性能优化实践
```typescript
// 批量数据操作
function processItems() {
  const items = document.querySelectorAll('[data-item-id]');

  items.forEach(item => {
    const id = item.dataset.itemId;
    const processed = item.dataset.processed === 'true';
  
    if (!processed) {
      // 处理逻辑...
      item.dataset.processed = 'true';
    }
  });
}
```

### 3. 类型安全扩展（TypeScript）
```typescript
// 扩展HTMLElement类型
declare global {
  interface HTMLElement {
    dataset: DOMStringMap & {
      userId?: string;
      userRole?: 'admin' | 'user' | 'guest';
      isActive?: 'true' | 'false';
    };
  }
}

// 类型安全访问
const element = document.getElementById('user-card')!;
const role = element.dataset.userRole; // 类型为 'admin' | 'user' | 'guest' | undefined
```

## 六、最佳实践指南

1. **命名规范建议**
    - 保持命名一致性（团队统一约定）
    - 避免与标准属性冲突（如不要使用`data-id`，直接用`id`）
    - 对公共组件使用命名空间：`data-<团队/项目>-<名称>`

2. **数据量控制**
   ```html
   <!-- 不推荐：存储大量数据 -->
   <div data-json='{"a":1,"b":2,...}'></div>
 
   <!-- 推荐：只存储关键标识 -->
   <div data-item-id="123"></div>
   ```

3. **性能考量**
    - 避免频繁读写`dataset`（会触发DOM操作）
    - 大数据集考虑使用`Map`或WeakMap关联DOM元素
    - 复杂状态使用专门的state管理库

4. **可访问性注意**
    - 不要用`data-*`替代ARIA属性
    - 屏幕阅读器通常不会读取`data-*`内容
    - 关键信息应同时包含在可见文本或ARIA属性中

## 七、浏览器兼容性

所有现代浏览器都完全支持`data-*`属性，包括：
- Chrome 8+
- Firefox 6+
- Safari 6+
- Edge 12+
- Opera 11.1+

对于IE兼容性（IE10以下）：
```typescript
// 兼容性处理
function getDataAttribute(element: HTMLElement, name: string) {
  if ('dataset' in element) {
    return element.dataset[name];
  }
  return element.getAttribute(`data-${name}`);
}
```

`data-*`属性是现代Web开发中非常重要的功能，它提供了标准化的自定义数据存储方式，既保持了HTML的语义化，又为JavaScript提供了灵活的数据访问接口。合理使用可以显著提高代码的可维护性和可测试性。
