## 62. 用户访问页面白屏了，原因是啥，如何排查？

用户访问页面时出现 **白屏** 是前端开发中常见的问题，可能由多种原因导致。以下是详细的排查思路和解决方案：

---

## **1. 常见原因**
### **(1) JavaScript 报错**
- 代码中存在未捕获的异常，导致页面渲染中断。
- 依赖的第三方库未正确加载或版本冲突。

### **(2) 资源加载失败**
- JS、CSS 文件路径错误或服务器未正确返回资源（404/500）。
- CDN 资源跨域或 HTTPS 混合内容问题。

### **(3) 路由配置问题**
- SPA（如 Vue/React）的路由配置错误，导致无法匹配到正确的组件。
- 动态路由未正确处理。

### **(4) 浏览器兼容性问题**
- 代码使用了某些浏览器不支持的 API（如 ES6+ 语法）。
- Polyfill 未正确配置。

### **(5) 数据加载问题**
- 页面依赖的 API 请求失败或返回异常数据。
- 数据未正确处理（如未判空）。

### **(6) 构建工具问题**
- Webpack/Vite 打包配置错误（如 `publicPath` 设置错误）。
- 代码分割（Code Splitting）导致资源加载顺序问题。

---

## **2. 排查步骤**
### **🔍 第一步：检查控制台报错**
打开浏览器开发者工具（`F12`），查看 **Console** 和 **Network** 面板：
1. **Console**：
    - 是否有 `Uncaught TypeError`、`SyntaxError` 等错误。
    - 是否有 `Failed to load resource` 提示。
2. **Network**：
    - 检查 JS、CSS 文件是否加载成功（状态码是否为 `200`）。
    - 检查 API 请求是否失败（如 `500` 或 `404`）。

### **🌐 第二步：检查资源加载**
- 如果资源加载失败：
    - 确认文件路径是否正确（尤其是生产环境 `publicPath`）。
    - 检查 CDN 是否可用或跨域问题（如 `CORS` 错误）。
- 示例：
  ```bash
  # 检查资源路径
  <script src="/static/js/main.js"></script>  # 确保路径正确
  ```

### **🛠️ 第三步：检查路由配置**
- **SPA 应用**：
    - 确认路由配置是否正确（如 `vue-router` 或 `react-router`）。
    - 检查是否匹配到默认路由（如 `404` 页面）。
- 示例（Vue Router）：
  ```typescript
  const router = createRouter({
    history: createWebHistory(),
    routes: [
      { path: '/', component: Home }, // 确保根路径配置正确
      { path: '/:pathMatch(.*)*', component: NotFound }, // 兜底路由
    ],
  });
  ```

### **📦 第四步：检查构建问题**
- 如果是生产环境白屏：
    - 检查 `dist` 目录是否生成完整。
    - 确认 `publicPath` 是否正确（尤其是部署到子目录时）。
- 示例（Vite 配置）：
  ```typescript
  // vite.config.ts
  export default defineConfig({
    base: '/your-subdirectory/', // 确保与部署路径一致
  });
  ```

### **🔄 第五步：回滚或降级**
- 如果是更新后出现的白屏：
    - 回滚到上一个稳定版本，确认是否是新代码导致。
    - 检查第三方库是否升级（如 `vue`、`react` 版本冲突）。

### **📱 第六步：检查浏览器兼容性**
- 使用 [Can I Use](https://caniuse.com/) 确认代码是否兼容目标浏览器。
- 添加必要的 Polyfill（如 `core-js`、`babel`）：
  ```typescript
  // main.ts
  import 'core-js/stable'; // 添加 Polyfill
  ```

### **📡 第七步：检查数据加载**
- 如果页面依赖 API 数据：
    - 检查 API 是否返回了预期数据。
    - 对数据做判空处理：
      ```typescript
      // 示例：Vue 中处理异步数据
      const data = ref(null);
      fetchData().catch(() => (data.value = [])); // 避免因报错中断渲染
      ```

---

## **3. 高级排查工具**
### **(1) Source Map 调试**
- 在构建时生成 `sourcemap`，便于定位生产环境报错：
  ```typescript
  // vite.config.ts
  export default defineConfig({
    build: {
      sourcemap: true, // 生成 sourcemap
    },
  });
  ```

### **(2) 性能分析**
- 使用 **Lighthouse** 或 **WebPageTest** 分析页面加载过程：
  ```bash
  # 使用 Lighthouse
  npm install -g lighthouse
  lighthouse http://your-site.com
  ```

### **(3) 监控工具**
- 接入 **Sentry** 或 **Fundebug** 捕获前端异常：
  ```typescript
  // Sentry 示例
  import * as Sentry from '@sentry/browser';
  Sentry.init({ dsn: 'your-dsn' });
  ```

---

## **4. 常见问题解决方案**
| **问题**                | **解决方案**                                                                 |
|-------------------------|-----------------------------------------------------------------------------|
| JS 报错中断渲染         | 使用 `try-catch` 或 `ErrorBoundary`（React）捕获错误。                      |
| 资源加载失败            | 检查路径、CDN 和服务器配置。                                                |
| 路由未匹配              | 添加兜底路由（如 `404` 页面）。                                             |
| 浏览器兼容性问题        | 添加 `core-js` 和 `babel` Polyfill。                                        |
| API 数据异常            | 对数据判空，并添加加载状态。                                                |
| 生产环境白屏            | 检查 `publicPath` 和构建配置。                                              |

---

## **5. 总结**
1. **优先检查控制台报错**（Console + Network）。
2. **确认资源加载和路由配置**是否正确。
3. **生产环境**重点关注构建配置和路径问题。
4. **兼容性**问题通过 Polyfill 解决。
5. **数据依赖**的页面需做好错误处理。

通过以上步骤，可以快速定位和解决白屏问题！ 🚀