## 52. å‰ç«¯å¦‚ä½•ç”¨ canvas æ¥åšç”µå½±é™¢é€‰ç¥¨åŠŸèƒ½

ä½¿ç”¨ HTML5 `<canvas>` å®ç°ç”µå½±é™¢é€‰ç¥¨åŠŸèƒ½æ˜¯ä¸€ç§é«˜æ•ˆã€çµæ´»çš„æ–¹æ¡ˆã€‚Canvas å…è®¸æˆ‘ä»¬ç›´æ¥åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶å›¾å½¢ï¼Œéå¸¸é€‚åˆç”¨äºåº§ä½å¸ƒå±€ã€é€‰ä¸­çŠ¶æ€å±•ç¤ºç­‰äº¤äº’åœºæ™¯ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„å®ç°æ–¹æ¡ˆï¼ŒåŒ…å«åº§ä½ç»˜åˆ¶ã€é€‰ä¸­çŠ¶æ€ã€åº§ä½ä»·æ ¼ã€é€‰åº§é™åˆ¶ç­‰å®ç”¨åŠŸèƒ½ï¼Œå¹¶ä½¿ç”¨ TypeScript è¿›è¡Œç±»å‹å®‰å…¨å¤„ç†ã€‚

---

## ğŸ¥ ä¸€ã€åŠŸèƒ½ç›®æ ‡

- å±•ç¤ºå½±é™¢åº§ä½å¸ƒå±€
- æ”¯æŒç‚¹å‡»é€‰åº§ä¸å–æ¶ˆé€‰åº§
- æ˜¾ç¤ºé€‰ä¸­åº§ä½æ•°é‡å’Œæ€»ä»·
- é™åˆ¶æœ€å¤šé€‰åº§æ•°é‡
- æ”¯æŒä¸åŒåº§ä½ä»·æ ¼ï¼ˆå¦‚ VIP åº§ä½æ›´è´µï¼‰

---

## ğŸ§© äºŒã€æ•°æ®ç»“æ„è®¾è®¡

```typescript
type SeatState = 'available' | 'selected' | 'occupied';

interface Seat {
  state: SeatState;
  price: number;
}

// åº§ä½å¸ƒå±€äºŒç»´æ•°ç»„
const seats: Seat[][] = [
  // è¡Œæ•°ä¸º 8ï¼Œåˆ—æ•°ä¸º 10ï¼ŒVIP åº§ä½ä»·æ ¼æ›´é«˜
  Array(10).fill({ state: 'available', price: 40 }),
  Array(10).fill({ state: 'available', price: 40 }),
  Array(10).fill({ state: 'available', price: 35 }),
  Array(10).fill({ state: 'available', price: 35 }),
  Array(10).fill({ state: 'available', price: 30 }),
  Array(10).fill({ state: 'available', price: 30 }),
  Array(10).fill({ state: 'available', price: 25 }),
  Array(10).fill({ state: 'available', price: 25 }),
];
```

---

## ğŸ¨ ä¸‰ã€Canvas åˆå§‹åŒ–ä¸ç»˜åˆ¶

```typescript
const canvas = document.createElement('canvas');
canvas.width = 800;
canvas.height = 600;
document.body.appendChild(canvas);

const ctx = canvas.getContext('2d')!;
const seatWidth = 40;
const seatHeight = 40;
const margin = 10;
const maxSelection = 5;

// ç”¨äºè®°å½•å½“å‰é€‰ä¸­çš„åº§ä½
const selectedSeats = new Set<string>();

function drawSeats() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  for (let row = 0; row < seats.length; row++) {
    for (let col = 0; col < seats[row].length; col++) {
      const seat = seats[row][col];
      const x = margin + col * (seatWidth + margin);
      const y = margin + row * (seatHeight + margin);

      // å¡«å……é¢œè‰²
      if (seat.state === 'occupied') {
        ctx.fillStyle = '#ccc'; // ç°è‰²è¡¨ç¤ºä¸å¯é€‰
      } else if (selectedSeats.has(`${row}-${col}`)) {
        ctx.fillStyle = 'red'; // å·²é€‰ä¸­
      } else {
        ctx.fillStyle = 'green'; // å¯é€‰
      }

      ctx.fillRect(x, y, seatWidth, seatHeight);
      ctx.strokeStyle = '#000';
      ctx.strokeRect(x, y, seatWidth, seatHeight);

      // æ˜¾ç¤ºä»·æ ¼
      ctx.fillStyle = 'white';
      ctx.font = '12px Arial';
      ctx.fillText(`Â¥${seat.price}`, x + 5, y + 20);
    }
  }

  // æ˜¾ç¤ºé€‰ä¸­ä¿¡æ¯
  const selected = [...selectedSeats].length;
  const total = [...selectedSeats]
    .reduce((sum, key) => {
      const [row, col] = key.split('-').map(Number);
      return sum + seats[row][col].price;
    }, 0);

  ctx.fillStyle = '#000';
  ctx.font = '16px Arial';
  ctx.fillText(`å·²é€‰åº§ä½: ${selected} ä¸ªï¼Œæ€»ä»·: Â¥${total}`, 20, canvas.height - 30);
}
```

---

## ğŸ–±ï¸ å››ã€é¼ æ ‡ç‚¹å‡»äº‹ä»¶å¤„ç†

```typescript
canvas.addEventListener('click', (e) => {
  const rect = canvas.getBoundingClientRect();
  const clickX = e.clientX - rect.left;
  const clickY = e.clientY - rect.top;

  for (let row = 0; row < seats.length; row++) {
    for (let col = 0; col < seats[row].length; col++) {
      const seat = seats[row][col];
      const x = margin + col * (seatWidth + margin);
      const y = margin + row * (seatHeight + margin);

      if (
        clickX >= x &&
        clickX <= x + seatWidth &&
        clickY >= y &&
        clickY <= y + seatHeight
      ) {
        const key = `${row}-${col}`;

        if (seat.state === 'occupied') return;

        if (selectedSeats.has(key)) {
          selectedSeats.delete(key);
        } else {
          if (selectedSeats.size >= maxSelection) {
            alert(`æœ€å¤šåªèƒ½é€‰ ${maxSelection} ä¸ªåº§ä½`);
            return;
          }
          selectedSeats.add(key);
        }

        drawSeats();
        return;
      }
    }
  }
});
```

---

## âœ… äº”ã€å®Œæ•´è°ƒç”¨

```typescript
drawSeats(); // åˆå§‹ç»˜åˆ¶
```

---

## ğŸ§  å…­ã€å¯æ‰©å±•åŠŸèƒ½å»ºè®®

- **æ”¯æŒæ‹–åŠ¨é€‰åº§**ï¼šé€šè¿‡ç›‘å¬ `mousedown`, `mousemove`, `mouseup` å®ç°æ‹–åŠ¨é€‰åº§
- **ä¿å­˜é€‰åº§çŠ¶æ€**ï¼šä½¿ç”¨ localStorage æˆ–å‘é€åˆ°åç«¯
- **åº§ä½é¢œè‰²åŒºåˆ†**ï¼šæ ¹æ®ä»·æ ¼ä¸åŒä½¿ç”¨ä¸åŒé¢œè‰²
- **å“åº”å¼è®¾è®¡**ï¼šæ ¹æ®å±å¹•å¤§å°åŠ¨æ€è°ƒæ•´ç”»å¸ƒå°ºå¯¸
- **åŠ¨ç”»æ•ˆæœ**ï¼šæ·»åŠ é€‰ä¸­æ—¶çš„åŠ¨ç”»æˆ–é«˜äº®æ•ˆæœ

---

## ğŸ“Œ ä¸ƒã€æ€»ç»“

ä½¿ç”¨ Canvas å®ç°ç”µå½±é™¢é€‰åº§åŠŸèƒ½ï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **æ€§èƒ½é«˜** | ç›´æ¥æ“ä½œåƒç´ ï¼Œæ¸²æŸ“æ•ˆç‡é«˜ |
| **çµæ´»å¸ƒå±€** | å¯ä»¥è‡ªç”±è®¾è®¡åº§ä½å½¢çŠ¶å’Œæ ·å¼ |
| **äº¤äº’ä¸°å¯Œ** | æ”¯æŒç‚¹å‡»ã€æ‹–åŠ¨ã€æ‚¬åœç­‰äº¤äº’ |
| **æ˜“äºæ‰©å±•** | å¯é›†æˆåŠ¨ç”»ã€ä»·æ ¼ã€çŠ¶æ€ç­‰é€»è¾‘ |

å¦‚æœä½ å¸Œæœ›å°†æ­¤åŠŸèƒ½å°è£…æˆç»„ä»¶ï¼ˆå¦‚ React ç»„ä»¶ï¼‰ï¼Œä¹Ÿå¯ä»¥è¿›ä¸€æ­¥å°è£…æˆå¯å¤ç”¨çš„ UI æ¨¡å—ï¼Œæ¬¢è¿ç»§ç»­æé—®å“¦ï¼

ğŸ¬ **ç°åœ¨ä½ å¯ä»¥ç›´æ¥åœ¨é¡µé¢ä¸­çœ‹åˆ°ä¸€ä¸ªç”µå½±é™¢çš„åº§ä½å›¾ï¼Œç‚¹å‡»åº§ä½å³å¯é€‰ä¸­ï¼Œæœ€å¤šé€‰ 5 ä¸ªï¼Œæ€»ä»·è‡ªåŠ¨è®¡ç®—ã€‚**
