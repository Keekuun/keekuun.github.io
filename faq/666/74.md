## 74. git pull 和 git fetch 有啥区别？

`git pull` 和 `git fetch` 是 Git 中用于同步远程仓库代码的两个常用命令，但它们的 **行为** 和 **使用场景** 有显著区别。以下是详细对比：

---

## **1. 核心区别**
| **命令**       | **作用**                                                                 | **是否自动合并** | **安全性**       |
|----------------|-------------------------------------------------------------------------|----------------|------------------|
| `git fetch`    | 从远程仓库下载最新代码到本地仓库（`.git` 目录），**但不修改工作目录**。       | ❌ 否           | ✅ 安全（只读操作） |
| `git pull`     | `git fetch` + `git merge`（或 `git rebase`），**直接更新工作目录**。         | ✅ 是           | ⚠️ 可能冲突       |

---

## **2. 工作流程对比**
### **(1) `git fetch`**
- **步骤**：
    1. 从远程仓库拉取最新代码（如 `origin/main`）。
    2. 更新本地仓库的 **远程分支引用**（如 `origin/main`），但 **不修改本地分支**（如 `main`）。
- **示例**：
  ```bash
  git fetch origin  # 拉取远程仓库的所有分支更新
  git fetch origin main  # 仅拉取远程 main 分支
  ```

### **(2) `git pull`**
- **步骤**：
    1. 执行 `git fetch`（拉取远程代码）。
    2. 自动执行 `git merge`（默认）或 `git rebase`，将远程分支合并到当前本地分支。
- **示例**：
  ```bash
  git pull origin main  # 拉取并合并远程 main 分支到当前分支
  git pull --rebase     # 使用 rebase 代替 merge（避免多余合并提交）
  ```

---

## **3. 使用场景**
### **✅ 适合 `git fetch` 的情况**
- **查看远程更新**：先检查远程代码变化，再决定是否合并。
  ```bash
  git fetch
  git log origin/main..main  # 查看本地与远程的差异
  ```
- **安全操作**：避免直接合并可能冲突的代码。
- **复杂协作**：在团队协作中，先 `fetch` 再手动处理冲突。

### **✅ 适合 `git pull` 的情况**
- **快速同步**：确定远程代码可直接合并（如个人项目）。
- **简单更新**：本地无未提交更改时，直接拉取最新代码。

---

## **4. 风险与注意事项**
### **⚠️ `git pull` 的风险**
- **自动合并冲突**：如果远程代码与本地修改冲突，可能直接进入冲突状态。
- **历史污染**：默认的 `merge` 策略会产生多余的合并提交（可通过 `--rebase` 避免）。

### **🎯 最佳实践**
1. **先 `fetch`，再手动合并**：
   ```bash
   git fetch
   git merge origin/main  # 或 git rebase origin/main
   ```
2. **使用 `git pull --rebase`**：
   ```bash
   git pull --rebase  # 线性历史，避免合并提交
   ```
3. **检查差异后再操作**：
   ```bash
   git fetch
   git diff main origin/main  # 查看差异
   ```

---

## **5. 底层原理**
- **`git fetch`**：更新 `.git/refs/remotes/origin/` 下的引用文件。
- **`git pull`**：调用 `git merge` 或 `git rebase`，修改 `.git/HEAD` 和工作目录文件。

---

## **6. 总结**
| **需求**                | **推荐命令**       | **理由**                               |
|-------------------------|-------------------|----------------------------------------|
| 仅查看远程更新          | `git fetch`       | 安全，不修改工作目录                   |
| 快速同步代码（无冲突）  | `git pull`        | 一键完成拉取和合并                     |
| 需要干净的历史          | `git pull --rebase` | 避免合并提交，保持线性历史             |
| 复杂协作环境            | `git fetch` + 手动处理 | 更可控，避免自动合并冲突               |

**口诀**：
🔹 `fetch` 是“只下载”，`pull` 是“下载并合并”。
🔹 不确定时先 `fetch`，安全第一！ 🛡️