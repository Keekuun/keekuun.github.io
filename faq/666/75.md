## 75. 前端如何做页面主题色切换

在前端实现 **页面主题色切换** 是一个常见的需求，通常用于支持 **深色模式/浅色模式** 或 **用户自定义主题**。以下是完整的实现方案，涵盖技术选型、代码示例和最佳实践：

---

## **1. 核心实现方案**
### **(1) CSS 变量 + JavaScript 动态切换**
#### **✅ 定义主题变量**
在全局 CSS 中定义主题相关的变量：
```css
:root {
  --primary-color: #3498db; /* 默认主题色 */
  --bg-color: #ffffff;
  --text-color: #333333;
}

[data-theme="dark"] {
  --primary-color: #9b59b6;
  --bg-color: #222222;
  --text-color: #ffffff;
}
```

#### **✅ 应用变量**
在页面中使用这些变量：
```css
body {
  background-color: var(--bg-color);
  color: var(--text-color);
}
.button {
  background-color: var(--primary-color);
}
```

#### **✅ 动态切换主题**
通过 JavaScript 修改 `data-theme` 属性：
```typescript
function toggleTheme() {
  const currentTheme = document.documentElement.getAttribute('data-theme');
  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', newTheme);
  localStorage.setItem('theme', newTheme); // 持久化存储
}

// 初始化时读取存储的主题
const savedTheme = localStorage.getItem('theme');
if (savedTheme) {
  document.documentElement.setAttribute('data-theme', savedTheme);
}
```

---

### **(2) CSS 预处理器（Sass/Less）**
如果项目使用 Sass/Less，可以通过变量和条件逻辑生成多套主题：
```scss
$themes: (
  light: (
    primary-color: #3498db,
    bg-color: #ffffff,
  ),
  dark: (
    primary-color: #9b59b6,
    bg-color: #222222,
  ),
);

@mixin theme($name) {
  $theme: map-get($themes, $name);
  [data-theme="#{$name}"] & {
    background-color: map-get($theme, bg-color);
    color: map-get($theme, text-color);
  }
}

.button {
  @include theme('light');
  @include theme('dark');
}
```

---

### **(3) 使用前端框架（React/Vue）**
#### **✅ React 示例**
```tsx
import React, { useState, useEffect } from 'react';

const ThemeSwitcher = () => {
  const [theme, setTheme] = useState<'light' | 'dark'>('light');

  useEffect(() => {
    const savedTheme = localStorage.getItem('theme') as 'light' | 'dark';
    if (savedTheme) setTheme(savedTheme);
  }, []);

  const toggleTheme = () => {
    const newTheme = theme === 'light' ? 'dark' : 'light';
    setTheme(newTheme);
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
  };

  return (
    <button onClick={toggleTheme}>
      Switch to {theme === 'light' ? 'Dark' : 'Light'} Mode
    </button>
  );
};
```

#### **✅ Vue 示例**
```vue
<template>
  <button @click="toggleTheme">
    Switch to {{ theme === 'light' ? 'Dark' : 'Light' }} Mode
  </button>
</template>

<script>
export default {
  data() {
    return {
      theme: 'light',
    };
  },
  mounted() {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) this.theme = savedTheme;
  },
  methods: {
    toggleTheme() {
      this.theme = this.theme === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', this.theme);
      localStorage.setItem('theme', this.theme);
    },
  },
};
</script>
```

---

## **2. 高级优化**
### **(1) 跟随系统主题**
监听用户系统的主题偏好（通过 `prefers-color-scheme`）：
```typescript
const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
if (prefersDark.matches) {
  document.documentElement.setAttribute('data-theme', 'dark');
}

// 动态响应系统主题变化
prefersDark.addEventListener('change', (e) => {
  document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light');
});
```

### **(2) 平滑过渡动画**
通过 CSS 过渡效果避免颜色切换生硬：
```css
body {
  transition: background-color 0.3s, color 0.3s;
}
```

### **(3) 主题色生成工具**
动态生成主题色（如基于用户选择的颜色）：
```typescript
function generateThemeColors(baseColor: string) {
  // 使用颜色库（如 chroma.js）生成衍生颜色
  return {
    primary: baseColor,
    secondary: chroma(baseColor).darken(0.5).hex(),
  };
}
```

---

## **3. 兼容性与注意事项**
- **浏览器支持**：CSS 变量兼容 IE11 以外的所有现代浏览器。
- **性能**：避免在 CSS 变量中嵌套过多计算。
- **无障碍**：确保主题切换不影响可读性（对比度符合 WCAG 标准）。

---

## **4. 工具推荐**
| **工具**          | **用途**                          |
|-------------------|----------------------------------|
| **CSS Variables** | 基础主题切换方案                  |
| **Sass/Less**     | 预处理器支持多主题                |
| **chroma.js**     | 动态生成颜色                      |
| **styled-components** | React 中动态主题支持       |

---

## **5. 总结**
- **简单场景**：CSS 变量 + JavaScript 切换（推荐）。
- **复杂场景**：Sass/Less + 框架状态管理。
- **动态主题**：结合颜色生成库（如 `chroma.js`）。

实现效果示例：
🌞 **浅色模式** → 🌙 **深色模式** → 🎨 **自定义主题**

通过以上方法，你可以轻松实现灵活、高性能的主题切换功能！ 🎨