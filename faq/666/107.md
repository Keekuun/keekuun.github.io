## 107. å¸¸è§çš„ç™»å½•é‰´æƒæ–¹å¼æœ‰å“ªäº›ï¼Ÿ

åœ¨ Web å’Œåº”ç”¨å¼€å‘ä¸­ï¼Œå¸¸è§çš„ç™»å½•é‰´æƒæ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼Œæ¯ç§æ–¹å¼éƒ½æœ‰å…¶é€‚ç”¨åœºæ™¯å’Œä¼˜ç¼ºç‚¹ï¼š

---

### ğŸ”‘ **1. åŸºäº Session çš„é‰´æƒ**
- **åŸç†**ï¼šæœåŠ¡å™¨åœ¨ç”¨æˆ·ç™»å½•ååˆ›å»º Session å¹¶å­˜å‚¨ï¼Œå®¢æˆ·ç«¯é€šè¿‡ Cookie æºå¸¦ Session IDã€‚
- **é€‚ç”¨åœºæ™¯**ï¼šä¼ ç»Ÿçš„ Web åº”ç”¨ï¼ˆå¦‚ç”µå•†ç½‘ç«™ï¼‰ã€‚
- **ä¼˜ç‚¹**ï¼š
    - å®ç°ç®€å•ï¼Œå…¼å®¹æ€§å¥½ã€‚
    - æœåŠ¡å™¨å®Œå…¨æ§åˆ¶ Session ç”Ÿå‘½å‘¨æœŸã€‚
- **ç¼ºç‚¹**ï¼š
    - ä¸é€‚ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆéœ€å…±äº« Session å­˜å‚¨ï¼‰ã€‚
    - ä¾èµ– Cookieï¼Œå¯èƒ½å— CSRF æ”»å‡»ã€‚

#### ğŸ“œ ä»£ç ç¤ºä¾‹ï¼ˆExpress.jsï¼‰ï¼š
```typescript
import express from 'express';
import session from 'express-session';

const app = express();
app.use(session({
    secret: 'your-secret-key',
    resave: false,
    saveUninitialized: true,
}));

app.post('/login', (req, res) => {
    req.session.user = { id: 123, name: 'Alice' }; // å­˜å‚¨ç”¨æˆ·ä¿¡æ¯
    res.send('ç™»å½•æˆåŠŸï¼');
});

app.get('/profile', (req, res) => {
    if (!req.session.user) return res.status(401).send('æœªç™»å½•');
    res.send(`æ¬¢è¿, ${req.session.user.name}`);
});
```

---

### ğŸ”‘ **2. åŸºäº Token çš„é‰´æƒï¼ˆå¦‚ JWTï¼‰**
- **åŸç†**ï¼šæœåŠ¡å™¨ç”Ÿæˆ Tokenï¼ˆå¦‚ JWTï¼‰å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ Tokenã€‚
- **é€‚ç”¨åœºæ™¯**ï¼šå‰åç«¯åˆ†ç¦»ã€ç§»åŠ¨ç«¯ã€API æœåŠ¡ã€‚
- **ä¼˜ç‚¹**ï¼š
    - æ— çŠ¶æ€ï¼Œé€‚åˆåˆ†å¸ƒå¼ç³»ç»Ÿã€‚
    - æ”¯æŒè·¨åŸŸã€‚
- **ç¼ºç‚¹**ï¼š
    - Token ä¸€æ—¦æ³„éœ²æ— æ³•ç›´æ¥æ’¤é”€ï¼ˆéœ€ç»“åˆé»‘åå•æˆ–çŸ­æœ‰æ•ˆæœŸï¼‰ã€‚

#### ğŸ“œ ä»£ç ç¤ºä¾‹ï¼ˆJWTï¼‰ï¼š
```typescript
import jwt from 'jsonwebtoken';

const secret = 'your-secret-key';

// ç”Ÿæˆ Token
const token = jwt.sign({ userId: 123 }, secret, { expiresIn: '1h' });
console.log('Token:', token);

// éªŒè¯ Token
jwt.verify(token, secret, (err, decoded) => {
    if (err) console.error('Token æ— æ•ˆ');
    else console.log('ç”¨æˆ· ID:', decoded.userId);
});
```

---

### ğŸ”‘ **3. OAuth2.0 / OpenID Connect**
- **åŸç†**ï¼šé€šè¿‡æˆæƒæœåŠ¡å™¨é¢å‘ä»¤ç‰Œï¼ˆå¦‚ Access Tokenã€ID Tokenï¼‰ï¼Œç¬¬ä¸‰æ–¹åº”ç”¨ä½¿ç”¨ä»¤ç‰Œè®¿é—®èµ„æºã€‚
- **é€‚ç”¨åœºæ™¯**ï¼šç¤¾äº¤ç™»å½•ï¼ˆå¦‚å¾®ä¿¡ã€Google ç™»å½•ï¼‰ã€API æˆæƒã€‚
- **ä¼˜ç‚¹**ï¼š
    - ç”¨æˆ·æ— éœ€æš´éœ²å¯†ç ç»™ç¬¬ä¸‰æ–¹ã€‚
    - æ”¯æŒæƒé™ç»†åˆ†ï¼ˆScopeï¼‰ã€‚
- **ç¼ºç‚¹**ï¼š
    - å®ç°å¤æ‚ã€‚
    - ä¾èµ–ç¬¬ä¸‰æ–¹æœåŠ¡ã€‚

#### ğŸ“œ ä»£ç ç¤ºä¾‹ï¼ˆOAuth2.0ï¼‰ï¼š
```typescript
// å‚è§é—®é¢˜ 105 çš„ç¤ºä¾‹ä»£ç 
```

---

### ğŸ”‘ **4. SSOï¼ˆå•ç‚¹ç™»å½•ï¼‰**
- **åŸç†**ï¼šç”¨æˆ·ç™»å½•ä¸€æ¬¡åï¼Œå¯è®¿é—®å¤šä¸ªå…³è”ç³»ç»Ÿï¼ˆå¦‚ä¼ä¸šå†…ç½‘ï¼‰ã€‚
- **å®ç°æ–¹å¼**ï¼šSAMLã€OAuth2.0ã€CAS åè®®ç­‰ã€‚
- **ä¼˜ç‚¹**ï¼š
    - æå‡ç”¨æˆ·ä½“éªŒã€‚
    - é›†ä¸­ç®¡ç†æƒé™ã€‚
- **ç¼ºç‚¹**ï¼š
    - éƒ¨ç½²å’Œç»´æŠ¤æˆæœ¬é«˜ã€‚

#### ğŸ“œ ä»£ç ç¤ºä¾‹ï¼ˆSAMLï¼‰ï¼š
éœ€ä½¿ç”¨åº“å¦‚ `saml2-js`ï¼Œæ­¤å¤„ç•¥ã€‚

---

### ğŸ”‘ **5. åŸºäºå¯†ç å“ˆå¸Œçš„é‰´æƒ**
- **åŸç†**ï¼šç”¨æˆ·å¯†ç åŠ ç›å“ˆå¸Œåå­˜å‚¨ï¼Œç™»å½•æ—¶éªŒè¯å“ˆå¸Œå€¼ã€‚
- **é€‚ç”¨åœºæ™¯**ï¼šæ‰€æœ‰éœ€è¦å¯†ç å­˜å‚¨çš„ç³»ç»Ÿã€‚
- **ä¼˜ç‚¹**ï¼š
    - é¿å…æ˜æ–‡å­˜å‚¨å¯†ç ã€‚
- **ç¼ºç‚¹**ï¼š
    - éœ€é˜²èŒƒå½©è™¹è¡¨æ”»å‡»ã€‚

#### ğŸ“œ ä»£ç ç¤ºä¾‹ï¼ˆBcryptï¼‰ï¼š
```typescript
import bcrypt from 'bcrypt';

const saltRounds = 10;
const password = 'user-password';

// å“ˆå¸Œå¯†ç 
bcrypt.hash(password, saltRounds, (err, hash) => {
    console.log('å“ˆå¸Œå¯†ç :', hash);
});

// éªŒè¯å¯†ç 
bcrypt.compare(password, hash, (err, result) => {
    console.log('å¯†ç åŒ¹é…:', result);
});
```

---

### ğŸ”‘ **6. åŒå› ç´ è®¤è¯ï¼ˆ2FAï¼‰**
- **åŸç†**ï¼šç»“åˆå¯†ç  + åŠ¨æ€éªŒè¯ç ï¼ˆå¦‚çŸ­ä¿¡ã€TOTPï¼‰ã€‚
- **é€‚ç”¨åœºæ™¯**ï¼šé«˜å®‰å…¨æ€§éœ€æ±‚ï¼ˆå¦‚é“¶è¡Œã€ä¼ä¸šç³»ç»Ÿï¼‰ã€‚
- **ä¼˜ç‚¹**ï¼š
    - æ˜¾è‘—æå‡å®‰å…¨æ€§ã€‚
- **ç¼ºç‚¹**ï¼š
    - å¢åŠ ç”¨æˆ·æ“ä½œæ­¥éª¤ã€‚

#### ğŸ“œ ä»£ç ç¤ºä¾‹ï¼ˆTOTPï¼‰ï¼š
```typescript
import speakeasy from 'speakeasy';

// ç”Ÿæˆå¯†é’¥
const secret = speakeasy.generateSecret();
console.log('TOTP å¯†é’¥:', secret.base32);

// ç”ŸæˆéªŒè¯ç 
const token = speakeasy.totp({
    secret: secret.base32,
    encoding: 'base32',
});
console.log('åŠ¨æ€éªŒè¯ç :', token);

// éªŒè¯
const isValid = speakeasy.totp.verify({
    secret: secret.base32,
    encoding: 'base32',
    token: userInput,
});
console.log('éªŒè¯ç»“æœ:', isValid);
```

---

### ğŸ¯ **å¦‚ä½•é€‰æ‹©é‰´æƒæ–¹å¼ï¼Ÿ**
| **åœºæ™¯**               | **æ¨èæ–¹å¼**               |
|------------------------|---------------------------|
| ä¼ ç»Ÿ Web åº”ç”¨          | Session + Cookie          |
| å‰åç«¯åˆ†ç¦»/API         | JWT                       |
| ç¤¾äº¤ç™»å½•               | OAuth2.0 / OpenID Connect |
| ä¼ä¸šå†…ç½‘               | SSOï¼ˆå¦‚ SAMLï¼‰            |
| é«˜å®‰å…¨æ€§éœ€æ±‚           | 2FA + å¯†ç å“ˆå¸Œ            |

---

### âš ï¸ **å®‰å…¨æ³¨æ„äº‹é¡¹**
1. å§‹ç»ˆä½¿ç”¨ HTTPSã€‚
2. æ•æ„Ÿæ•°æ®ï¼ˆå¦‚å¯†ç ï¼‰å¿…é¡»åŠ ç›å“ˆå¸Œã€‚
3. Token è®¾ç½®åˆç†æœ‰æ•ˆæœŸã€‚
4. é˜²èŒƒ CSRFã€XSS ç­‰æ”»å‡»ã€‚

é€‰æ‹©åˆé€‚çš„é‰´æƒæ–¹å¼å¯ä»¥å¹³è¡¡å®‰å…¨æ€§ã€ç”¨æˆ·ä½“éªŒå’Œå¼€å‘æˆæœ¬ï¼ ğŸš€