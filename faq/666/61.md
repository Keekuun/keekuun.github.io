## 61. web 网页如何禁止别人移除水印

在网页上禁止他人移除水印是一个常见的需求，但需要注意的是，**没有绝对安全的方法**可以完全阻止用户移除水印（例如通过浏览器开发者工具、截图后编辑等方式）。不过，可以通过以下技术手段增加移除水印的难度，提高保护效果。

---

## **1. 前端技术方案**

### **(1) 使用 Canvas 或 SVG 绘制水印**
将水印直接绘制到图片或页面背景上，而不是简单的 DOM 元素覆盖，这样能增加移除的难度。

#### **示例代码（Canvas 水印）**
```typescript
function addWatermarkToImage(imageUrl: string, watermarkText: string): Promise<string> {
  return new Promise((resolve) => {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d')!;
    const img = new Image();

    img.crossOrigin = 'Anonymous'; // 解决跨域问题
    img.onload = () => {
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.drawImage(img, 0, 0);
      ctx.font = '20px Arial';
      ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
      ctx.fillText(watermarkText, 10, 30);
      resolve(canvas.toDataURL('image/png'));
    };
    img.src = imageUrl;
  });
}
```

#### **示例代码（SVG 背景水印）**
```typescript
function createSvgWatermark(text: string): string {
  return `
    <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">
      <text x="10" y="20" font-family="Arial" font-size="16" fill="rgba(0,0,0,0.1)" transform="rotate(-45)">
        ${text}
      </text>
    </svg>
  `;
}

// 应用到页面背景
document.body.style.backgroundImage = `url("data:image/svg+xml;utf8,${encodeURIComponent(createSvgWatermark('Watermark'))}")`;
```

✅ **优点**：
- 水印与图片/背景融合，难以通过简单的 CSS 或 JS 移除。
- 截图时水印仍然存在。

❌ **缺点**：
- 仍然可以通过开发者工具修改或截图后编辑。

---

### **(2) 使用 CSS `pointer-events: none` 防止选中**
防止用户通过开发者工具直接删除水印 DOM 元素。

```typescript
const watermark = document.createElement('div');
watermark.innerHTML = 'Watermark';
watermark.style.position = 'fixed';
watermark.style.bottom = '10px';
watermark.style.right = '10px';
watermark.style.opacity = '0.5';
watermark.style.pointerEvents = 'none'; // 防止点击选中
document.body.appendChild(watermark);
```

✅ **优点**：
- 防止用户通过鼠标选中或删除水印。

❌ **缺点**：
- 仍然可以通过开发者工具删除。

---

### **(3) 动态生成水印**
使用 JavaScript 动态生成水印，并监听 DOM 变化，防止删除。

```typescript
function createDynamicWatermark(text: string) {
  const watermark = document.createElement('div');
  watermark.innerHTML = text;
  watermark.style.position = 'fixed';
  watermark.style.top = '0';
  watermark.style.left = '0';
  watermark.style.width = '100%';
  watermark.style.height = '100%';
  watermark.style.pointerEvents = 'none';
  watermark.style.zIndex = '9999';
  document.body.appendChild(watermark);

  // 监听 DOM 变化，防止删除
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (!document.body.contains(watermark)) {
        document.body.appendChild(watermark);
      }
    });
  });
  observer.observe(document.body, { childList: true });
}

createDynamicWatermark('Watermark');
```

✅ **优点**：
- 即使删除水印，也会自动恢复。

❌ **缺点**：
- 仍然可以通过禁用 JavaScript 或修改 DOM 绕过。

---

## **2. 后端技术方案**
如果水印涉及敏感内容，建议在后端处理，避免前端被绕过。

### **(1) 服务器端添加水印**
在图片上传时，服务器自动添加水印（如使用 `sharp` 或 `ImageMagick`）。

#### **示例（Node.js + `sharp`）**
```typescript
import sharp from 'sharp';

async function addWatermark(inputPath: string, outputPath: string, text: string) {
  await sharp(inputPath)
    .composite([
      {
        input: {
          text: {
            text: `<span foreground="white">${text}</span>`,
            rgba: true,
            dpi: 300,
          },
        },
        gravity: 'southeast', // 水印位置
      },
    ])
    .toFile(outputPath);
}

addWatermark('input.jpg', 'output.jpg', 'Watermark');
```

✅ **优点**：
- 水印直接嵌入图片，无法通过前端移除。

❌ **缺点**：
- 需要服务器支持。

---

### **(2) 使用 DRM（数字版权管理）**
如果内容非常敏感，可以使用 DRM 技术（如 **Widevine** 或 **FairPlay**）保护视频或图片。

✅ **优点**：
- 高度安全，防止截图、录屏。

❌ **缺点**：
- 实现复杂，仅适用于特定场景。

---

## **3. 法律手段**
即使技术手段无法完全阻止水印移除，可以通过法律手段保护版权：
- 在网站 **用户协议** 中明确禁止移除水印。
- 使用 **数字签名** 或 **区块链存证** 证明内容归属。

---

## **总结**
| 方法 | 安全性 | 适用场景 |
|------|--------|----------|
| **Canvas/SVG 水印** | ⭐⭐⭐ | 图片、网页背景 |
| **CSS `pointer-events: none`** | ⭐⭐ | 简单网页水印 |
| **动态生成 + DOM 监听** | ⭐⭐⭐ | 防止直接删除 |
| **服务器端水印** | ⭐⭐⭐⭐ | 图片上传场景 |
| **DRM** | ⭐⭐⭐⭐⭐ | 高敏感内容 |

### **推荐方案**
1. **普通网页**：使用 **Canvas/SVG 水印 + DOM 监听**。
2. **图片内容**：**服务器端水印**（最可靠）。
3. **高敏感内容**：**DRM + 法律保护**。

即使采用这些方法，仍然无法 100% 防止水印被移除，但可以大幅提高移除难度，保护版权。 🚀