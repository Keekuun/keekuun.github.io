## 61. web ç½‘é¡µå¦‚ä½•ç¦æ­¢åˆ«äººç§»é™¤æ°´å°

åœ¨ç½‘é¡µä¸Šç¦æ­¢ä»–äººç§»é™¤æ°´å°æ˜¯ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ**æ²¡æœ‰ç»å¯¹å®‰å…¨çš„æ–¹æ³•**å¯ä»¥å®Œå…¨é˜»æ­¢ç”¨æˆ·ç§»é™¤æ°´å°ï¼ˆä¾‹å¦‚é€šè¿‡æµè§ˆå™¨å¼€å‘è€…å·¥å…·ã€æˆªå›¾åç¼–è¾‘ç­‰æ–¹å¼ï¼‰ã€‚ä¸è¿‡ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æŠ€æœ¯æ‰‹æ®µå¢åŠ ç§»é™¤æ°´å°çš„éš¾åº¦ï¼Œæé«˜ä¿æŠ¤æ•ˆæœã€‚

---

## **1. å‰ç«¯æŠ€æœ¯æ–¹æ¡ˆ**

### **(1) ä½¿ç”¨ Canvas æˆ– SVG ç»˜åˆ¶æ°´å°**
å°†æ°´å°ç›´æ¥ç»˜åˆ¶åˆ°å›¾ç‰‡æˆ–é¡µé¢èƒŒæ™¯ä¸Šï¼Œè€Œä¸æ˜¯ç®€å•çš„ DOM å…ƒç´ è¦†ç›–ï¼Œè¿™æ ·èƒ½å¢åŠ ç§»é™¤çš„éš¾åº¦ã€‚

#### **ç¤ºä¾‹ä»£ç ï¼ˆCanvas æ°´å°ï¼‰**
```typescript
function addWatermarkToImage(imageUrl: string, watermarkText: string): Promise<string> {
  return new Promise((resolve) => {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d')!;
    const img = new Image();

    img.crossOrigin = 'Anonymous'; // è§£å†³è·¨åŸŸé—®é¢˜
    img.onload = () => {
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.drawImage(img, 0, 0);
      ctx.font = '20px Arial';
      ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
      ctx.fillText(watermarkText, 10, 30);
      resolve(canvas.toDataURL('image/png'));
    };
    img.src = imageUrl;
  });
}
```

#### **ç¤ºä¾‹ä»£ç ï¼ˆSVG èƒŒæ™¯æ°´å°ï¼‰**
```typescript
function createSvgWatermark(text: string): string {
  return `
    <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">
      <text x="10" y="20" font-family="Arial" font-size="16" fill="rgba(0,0,0,0.1)" transform="rotate(-45)">
        ${text}
      </text>
    </svg>
  `;
}

// åº”ç”¨åˆ°é¡µé¢èƒŒæ™¯
document.body.style.backgroundImage = `url("data:image/svg+xml;utf8,${encodeURIComponent(createSvgWatermark('Watermark'))}")`;
```

âœ… **ä¼˜ç‚¹**ï¼š
- æ°´å°ä¸å›¾ç‰‡/èƒŒæ™¯èåˆï¼Œéš¾ä»¥é€šè¿‡ç®€å•çš„ CSS æˆ– JS ç§»é™¤ã€‚
- æˆªå›¾æ—¶æ°´å°ä»ç„¶å­˜åœ¨ã€‚

âŒ **ç¼ºç‚¹**ï¼š
- ä»ç„¶å¯ä»¥é€šè¿‡å¼€å‘è€…å·¥å…·ä¿®æ”¹æˆ–æˆªå›¾åç¼–è¾‘ã€‚

---

### **(2) ä½¿ç”¨ CSS `pointer-events: none` é˜²æ­¢é€‰ä¸­**
é˜²æ­¢ç”¨æˆ·é€šè¿‡å¼€å‘è€…å·¥å…·ç›´æ¥åˆ é™¤æ°´å° DOM å…ƒç´ ã€‚

```typescript
const watermark = document.createElement('div');
watermark.innerHTML = 'Watermark';
watermark.style.position = 'fixed';
watermark.style.bottom = '10px';
watermark.style.right = '10px';
watermark.style.opacity = '0.5';
watermark.style.pointerEvents = 'none'; // é˜²æ­¢ç‚¹å‡»é€‰ä¸­
document.body.appendChild(watermark);
```

âœ… **ä¼˜ç‚¹**ï¼š
- é˜²æ­¢ç”¨æˆ·é€šè¿‡é¼ æ ‡é€‰ä¸­æˆ–åˆ é™¤æ°´å°ã€‚

âŒ **ç¼ºç‚¹**ï¼š
- ä»ç„¶å¯ä»¥é€šè¿‡å¼€å‘è€…å·¥å…·åˆ é™¤ã€‚

---

### **(3) åŠ¨æ€ç”Ÿæˆæ°´å°**
ä½¿ç”¨ JavaScript åŠ¨æ€ç”Ÿæˆæ°´å°ï¼Œå¹¶ç›‘å¬ DOM å˜åŒ–ï¼Œé˜²æ­¢åˆ é™¤ã€‚

```typescript
function createDynamicWatermark(text: string) {
  const watermark = document.createElement('div');
  watermark.innerHTML = text;
  watermark.style.position = 'fixed';
  watermark.style.top = '0';
  watermark.style.left = '0';
  watermark.style.width = '100%';
  watermark.style.height = '100%';
  watermark.style.pointerEvents = 'none';
  watermark.style.zIndex = '9999';
  document.body.appendChild(watermark);

  // ç›‘å¬ DOM å˜åŒ–ï¼Œé˜²æ­¢åˆ é™¤
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (!document.body.contains(watermark)) {
        document.body.appendChild(watermark);
      }
    });
  });
  observer.observe(document.body, { childList: true });
}

createDynamicWatermark('Watermark');
```

âœ… **ä¼˜ç‚¹**ï¼š
- å³ä½¿åˆ é™¤æ°´å°ï¼Œä¹Ÿä¼šè‡ªåŠ¨æ¢å¤ã€‚

âŒ **ç¼ºç‚¹**ï¼š
- ä»ç„¶å¯ä»¥é€šè¿‡ç¦ç”¨ JavaScript æˆ–ä¿®æ”¹ DOM ç»•è¿‡ã€‚

---

## **2. åç«¯æŠ€æœ¯æ–¹æ¡ˆ**
å¦‚æœæ°´å°æ¶‰åŠæ•æ„Ÿå†…å®¹ï¼Œå»ºè®®åœ¨åç«¯å¤„ç†ï¼Œé¿å…å‰ç«¯è¢«ç»•è¿‡ã€‚

### **(1) æœåŠ¡å™¨ç«¯æ·»åŠ æ°´å°**
åœ¨å›¾ç‰‡ä¸Šä¼ æ—¶ï¼ŒæœåŠ¡å™¨è‡ªåŠ¨æ·»åŠ æ°´å°ï¼ˆå¦‚ä½¿ç”¨ `sharp` æˆ– `ImageMagick`ï¼‰ã€‚

#### **ç¤ºä¾‹ï¼ˆNode.js + `sharp`ï¼‰**
```typescript
import sharp from 'sharp';

async function addWatermark(inputPath: string, outputPath: string, text: string) {
  await sharp(inputPath)
    .composite([
      {
        input: {
          text: {
            text: `<span foreground="white">${text}</span>`,
            rgba: true,
            dpi: 300,
          },
        },
        gravity: 'southeast', // æ°´å°ä½ç½®
      },
    ])
    .toFile(outputPath);
}

addWatermark('input.jpg', 'output.jpg', 'Watermark');
```

âœ… **ä¼˜ç‚¹**ï¼š
- æ°´å°ç›´æ¥åµŒå…¥å›¾ç‰‡ï¼Œæ— æ³•é€šè¿‡å‰ç«¯ç§»é™¤ã€‚

âŒ **ç¼ºç‚¹**ï¼š
- éœ€è¦æœåŠ¡å™¨æ”¯æŒã€‚

---

### **(2) ä½¿ç”¨ DRMï¼ˆæ•°å­—ç‰ˆæƒç®¡ç†ï¼‰**
å¦‚æœå†…å®¹éå¸¸æ•æ„Ÿï¼Œå¯ä»¥ä½¿ç”¨ DRM æŠ€æœ¯ï¼ˆå¦‚ **Widevine** æˆ– **FairPlay**ï¼‰ä¿æŠ¤è§†é¢‘æˆ–å›¾ç‰‡ã€‚

âœ… **ä¼˜ç‚¹**ï¼š
- é«˜åº¦å®‰å…¨ï¼Œé˜²æ­¢æˆªå›¾ã€å½•å±ã€‚

âŒ **ç¼ºç‚¹**ï¼š
- å®ç°å¤æ‚ï¼Œä»…é€‚ç”¨äºç‰¹å®šåœºæ™¯ã€‚

---

## **3. æ³•å¾‹æ‰‹æ®µ**
å³ä½¿æŠ€æœ¯æ‰‹æ®µæ— æ³•å®Œå…¨é˜»æ­¢æ°´å°ç§»é™¤ï¼Œå¯ä»¥é€šè¿‡æ³•å¾‹æ‰‹æ®µä¿æŠ¤ç‰ˆæƒï¼š
- åœ¨ç½‘ç«™ **ç”¨æˆ·åè®®** ä¸­æ˜ç¡®ç¦æ­¢ç§»é™¤æ°´å°ã€‚
- ä½¿ç”¨ **æ•°å­—ç­¾å** æˆ– **åŒºå—é“¾å­˜è¯** è¯æ˜å†…å®¹å½’å±ã€‚

---

## **æ€»ç»“**
| æ–¹æ³• | å®‰å…¨æ€§ | é€‚ç”¨åœºæ™¯ |
|------|--------|----------|
| **Canvas/SVG æ°´å°** | â­â­â­ | å›¾ç‰‡ã€ç½‘é¡µèƒŒæ™¯ |
| **CSS `pointer-events: none`** | â­â­ | ç®€å•ç½‘é¡µæ°´å° |
| **åŠ¨æ€ç”Ÿæˆ + DOM ç›‘å¬** | â­â­â­ | é˜²æ­¢ç›´æ¥åˆ é™¤ |
| **æœåŠ¡å™¨ç«¯æ°´å°** | â­â­â­â­ | å›¾ç‰‡ä¸Šä¼ åœºæ™¯ |
| **DRM** | â­â­â­â­â­ | é«˜æ•æ„Ÿå†…å®¹ |

### **æ¨èæ–¹æ¡ˆ**
1. **æ™®é€šç½‘é¡µ**ï¼šä½¿ç”¨ **Canvas/SVG æ°´å° + DOM ç›‘å¬**ã€‚
2. **å›¾ç‰‡å†…å®¹**ï¼š**æœåŠ¡å™¨ç«¯æ°´å°**ï¼ˆæœ€å¯é ï¼‰ã€‚
3. **é«˜æ•æ„Ÿå†…å®¹**ï¼š**DRM + æ³•å¾‹ä¿æŠ¤**ã€‚

å³ä½¿é‡‡ç”¨è¿™äº›æ–¹æ³•ï¼Œä»ç„¶æ— æ³• 100% é˜²æ­¢æ°´å°è¢«ç§»é™¤ï¼Œä½†å¯ä»¥å¤§å¹…æé«˜ç§»é™¤éš¾åº¦ï¼Œä¿æŠ¤ç‰ˆæƒã€‚ ğŸš€