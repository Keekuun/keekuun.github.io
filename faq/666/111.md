## 111. å‰ç«¯å¦‚ä½•è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´ timeout

åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è®¾ç½®è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼ˆ`timeout`ï¼‰ï¼Œå…·ä½“å–å†³äºä½ ä½¿ç”¨çš„æŠ€æœ¯æ ˆæˆ–å·¥å…·ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„æ–¹æ³•ï¼š

---

### 1. **ä½¿ç”¨åŸç”Ÿ `XMLHttpRequest`**
```typescript
const xhr = new XMLHttpRequest();
xhr.open('GET', 'https://api.example.com/data', true);

// è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰
xhr.timeout = 5000; // 5ç§’

xhr.onload = () => {
  if (xhr.status === 200) {
    console.log('è¯·æ±‚æˆåŠŸ:', xhr.responseText);
  }
};

xhr.ontimeout = () => {
  console.error('è¯·æ±‚è¶…æ—¶');
};

xhr.onerror = () => {
  console.error('è¯·æ±‚å¤±è´¥');
};

xhr.send();
```

---

### 2. **ä½¿ç”¨ `fetch` API**
`fetch` API æœ¬èº«ä¸ç›´æ¥æ”¯æŒè¶…æ—¶è®¾ç½®ï¼Œä½†å¯ä»¥é€šè¿‡ `Promise.race` å’Œ `AbortController` å®ç°è¶…æ—¶åŠŸèƒ½ï¼š
```typescript
const fetchWithTimeout = async (url: string, options: RequestInit, timeout: number) => {
  const controller = new AbortController();
  const timeoutId = setTimeout(() => {
    controller.abort();
    console.error('è¯·æ±‚è¶…æ—¶');
  }, timeout);

  try {
    const response = await fetch(url, {
      ...options,
      signal: controller.signal,
    });
    clearTimeout(timeoutId);
    return response;
  } catch (error) {
    if (error.name === 'AbortError') {
      throw new Error('è¯·æ±‚è¶…æ—¶');
    }
    throw error;
  }
};

// ä½¿ç”¨ç¤ºä¾‹
fetchWithTimeout('https://api.example.com/data', {}, 5000)
  .then((response) => response.json())
  .then((data) => console.log('è¯·æ±‚æˆåŠŸ:', data))
  .catch((error) => console.error('è¯·æ±‚å¤±è´¥:', error.message));
```

---

### 3. **ä½¿ç”¨ `Axios`**
å¦‚æœä½ ä½¿ç”¨ `Axios`ï¼Œå¯ä»¥é€šè¿‡ `timeout` é…ç½®é¡¹ç›´æ¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼š
```typescript
import axios from 'axios';

axios.get('https://api.example.com/data', {
  timeout: 5000, // 5ç§’
})
  .then((response) => {
    console.log('è¯·æ±‚æˆåŠŸ:', response.data);
  })
  .catch((error) => {
    if (error.code === 'ECONNABORTED') {
      console.error('è¯·æ±‚è¶…æ—¶');
    } else {
      console.error('è¯·æ±‚å¤±è´¥:', error.message);
    }
  });
```

---

### 4. **ä½¿ç”¨ `jQuery`**
å¦‚æœä½ ä½¿ç”¨ `jQuery`ï¼Œå¯ä»¥é€šè¿‡ `timeout` é€‰é¡¹è®¾ç½®è¶…æ—¶æ—¶é—´ï¼š
```typescript
$.ajax({
  url: 'https://api.example.com/data',
  method: 'GET',
  timeout: 5000, // 5ç§’
  success: (data) => {
    console.log('è¯·æ±‚æˆåŠŸ:', data);
  },
  error: (xhr, status, error) => {
    if (status === 'timeout') {
      console.error('è¯·æ±‚è¶…æ—¶');
    } else {
      console.error('è¯·æ±‚å¤±è´¥:', error);
    }
  },
});
```

---

### 5. **ä½¿ç”¨ `WebSocket`**
å¦‚æœæ˜¯ `WebSocket` è¯·æ±‚ï¼Œå¯ä»¥é€šè¿‡ `setTimeout` æ‰‹åŠ¨å®ç°è¶…æ—¶é€»è¾‘ï¼š
```typescript
const socket = new WebSocket('wss://api.example.com/ws');

const timeoutId = setTimeout(() => {
  socket.close();
  console.error('WebSocket è¿æ¥è¶…æ—¶');
}, 5000);

socket.onopen = () => {
  clearTimeout(timeoutId);
  console.log('WebSocket è¿æ¥æˆåŠŸ');
};

socket.onerror = () => {
  clearTimeout(timeoutId);
  console.error('WebSocket è¿æ¥å¤±è´¥');
};
```

---

### æ€»ç»“
- **åŸç”Ÿ `XMLHttpRequest`**ï¼šç›´æ¥è®¾ç½® `timeout` å±æ€§ã€‚
- **`fetch` API**ï¼šç»“åˆ `AbortController` å’Œ `Promise.race` å®ç°è¶…æ—¶ã€‚
- **`Axios`**ï¼šé€šè¿‡ `timeout` é…ç½®é¡¹è®¾ç½®ã€‚
- **`jQuery`**ï¼šé€šè¿‡ `timeout` é€‰é¡¹è®¾ç½®ã€‚
- **`WebSocket`**ï¼šæ‰‹åŠ¨å®ç°è¶…æ—¶é€»è¾‘ã€‚

æ ¹æ®ä½ çš„é¡¹ç›®éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹æ³•ï¼ ğŸš€