## 111. 前端如何设置请求超时时间 timeout

在前端开发中，可以通过多种方式设置请求的超时时间（`timeout`），具体取决于你使用的技术栈或工具。以下是几种常见的方法：

---

### 1. **使用原生 `XMLHttpRequest`**
```typescript
const xhr = new XMLHttpRequest();
xhr.open('GET', 'https://api.example.com/data', true);

// 设置超时时间（单位：毫秒）
xhr.timeout = 5000; // 5秒

xhr.onload = () => {
  if (xhr.status === 200) {
    console.log('请求成功:', xhr.responseText);
  }
};

xhr.ontimeout = () => {
  console.error('请求超时');
};

xhr.onerror = () => {
  console.error('请求失败');
};

xhr.send();
```

---

### 2. **使用 `fetch` API**
`fetch` API 本身不直接支持超时设置，但可以通过 `Promise.race` 和 `AbortController` 实现超时功能：
```typescript
const fetchWithTimeout = async (url: string, options: RequestInit, timeout: number) => {
  const controller = new AbortController();
  const timeoutId = setTimeout(() => {
    controller.abort();
    console.error('请求超时');
  }, timeout);

  try {
    const response = await fetch(url, {
      ...options,
      signal: controller.signal,
    });
    clearTimeout(timeoutId);
    return response;
  } catch (error) {
    if (error.name === 'AbortError') {
      throw new Error('请求超时');
    }
    throw error;
  }
};

// 使用示例
fetchWithTimeout('https://api.example.com/data', {}, 5000)
  .then((response) => response.json())
  .then((data) => console.log('请求成功:', data))
  .catch((error) => console.error('请求失败:', error.message));
```

---

### 3. **使用 `Axios`**
如果你使用 `Axios`，可以通过 `timeout` 配置项直接设置超时时间：
```typescript
import axios from 'axios';

axios.get('https://api.example.com/data', {
  timeout: 5000, // 5秒
})
  .then((response) => {
    console.log('请求成功:', response.data);
  })
  .catch((error) => {
    if (error.code === 'ECONNABORTED') {
      console.error('请求超时');
    } else {
      console.error('请求失败:', error.message);
    }
  });
```

---

### 4. **使用 `jQuery`**
如果你使用 `jQuery`，可以通过 `timeout` 选项设置超时时间：
```typescript
$.ajax({
  url: 'https://api.example.com/data',
  method: 'GET',
  timeout: 5000, // 5秒
  success: (data) => {
    console.log('请求成功:', data);
  },
  error: (xhr, status, error) => {
    if (status === 'timeout') {
      console.error('请求超时');
    } else {
      console.error('请求失败:', error);
    }
  },
});
```

---

### 5. **使用 `WebSocket`**
如果是 `WebSocket` 请求，可以通过 `setTimeout` 手动实现超时逻辑：
```typescript
const socket = new WebSocket('wss://api.example.com/ws');

const timeoutId = setTimeout(() => {
  socket.close();
  console.error('WebSocket 连接超时');
}, 5000);

socket.onopen = () => {
  clearTimeout(timeoutId);
  console.log('WebSocket 连接成功');
};

socket.onerror = () => {
  clearTimeout(timeoutId);
  console.error('WebSocket 连接失败');
};
```

---

### 总结
- **原生 `XMLHttpRequest`**：直接设置 `timeout` 属性。
- **`fetch` API**：结合 `AbortController` 和 `Promise.race` 实现超时。
- **`Axios`**：通过 `timeout` 配置项设置。
- **`jQuery`**：通过 `timeout` 选项设置。
- **`WebSocket`**：手动实现超时逻辑。

根据你的项目需求选择合适的方法！ 🚀