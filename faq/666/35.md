## 35. H5 如何解决移动端适配问题

移动端适配是H5开发中的核心问题，涉及到不同设备、屏幕尺寸和分辨率的兼容性。以下是一些常用的适配方案和技巧:

## 一、视口基础配置

### 1. 标准视口设置
```html
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
```

### 2. 各属性说明
- `width=device-width`：视口宽度等于设备宽度
- `initial-scale=1.0`：初始缩放比例为1
- `user-scalable=no`：禁止用户缩放（根据需求决定）
- `viewport-fit=cover`：全屏显示（针对刘海屏）

## 二、主流适配方案

### 1. REM布局方案（推荐）
```javascript
// 设置根字体大小（基于375设计稿）
document.documentElement.style.fontSize = 
  document.documentElement.clientWidth / 3.75 + 'px';

// 监听窗口变化
window.addEventListener('resize', () => {
  document.documentElement.style.fontSize = 
    document.documentElement.clientWidth / 3.75 + 'px';
});
```

**PostCSS配置**（自动转换px为rem）：
```javascript
// postcss.config.js
module.exports = {
  plugins: {
    'postcss-pxtorem': {
      rootValue: 16,  // 1rem = 16px
      propList: ['*'],
      selectorBlackList: [/^html$/] // 不处理html标签
    }
  }
}
```

### 2. VW/VH方案（CSS3原生方案）
```css
/* 基于375设计稿 */
.container {
  width: 26.667vw; /* 100px -> 100/375*100vw */
  height: 13.333vh;
  font-size: 3.2vw; /* 12px -> 12/375*100vw */
}
```

**PostCSS配置**：
```javascript
module.exports = {
  plugins: {
    'postcss-px-to-viewport': {
      viewportWidth: 375,   // 设计稿宽度
      unitPrecision: 5,     // 转换精度
      viewportUnit: 'vw',   // 转换单位
      selectorBlackList: [] // 不转换的选择器
    }
  }
}
```

## 三、特殊场景处理

### 1. 1px边框问题
```css
.border-1px {
  position: relative;
}
.border-1px::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: #ddd;
  transform: scaleY(0.5);
  transform-origin: 0 0;
}
```

### 2. 安全区域适配（iPhone X+）
```css
.safe-area {
  padding-bottom: constant(safe-area-inset-bottom); /* iOS < 11.2 */
  padding-bottom: env(safe-area-inset-bottom); /* iOS >= 11.2 */
}
```

### 3. 图片模糊问题
```html
<!-- 使用2倍/3倍图 -->
<img src="image@2x.png" srcset="image@2x.png 2x, image@3x.png 3x">
```

## 四、响应式布局方案

### 1. 媒体查询断点
```css
/* 小型设备 (手机) */
@media (max-width: 576px) { ... }

/* 中型设备 (平板) */
@media (min-width: 577px) and (max-width: 768px) { ... }

/* 大型设备 (桌面) */
@media (min-width: 769px) { ... }
```

### 2. Flex弹性布局
```css
.container {
  display: flex;
  flex-wrap: wrap;
}
.item {
  flex: 0 0 50%; /* 两列布局 */
}
```

### 3. Grid网格布局
```css
.grid-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 10px;
}
```

## 五、移动端专属优化

### 1. 点击延迟解决
```javascript
// 引入fastclick库
import FastClick from 'fastclick';
FastClick.attach(document.body);
```

### 2. 禁止长按菜单
```css
* {
  -webkit-touch-callout: none; /* 禁止长按链接与图片弹出菜单 */
  -webkit-user-select: none;   /* 禁止选中文本 */
}
```

### 3. 滚动优化
```css
.container {
  -webkit-overflow-scrolling: touch; /* 启用弹性滚动 */
  overscroll-behavior: contain;     /* 防止滚动穿透 */
}
```

## 六、调试与验证

### 1. Chrome设备模拟
1. 打开开发者工具(Ctrl+Shift+I)
2. 切换设备工具栏(Ctrl+Shift+M)
3. 选择特定设备或自定义分辨率

### 2. 真机调试
```javascript
// 使用vConsole
import VConsole from 'vconsole';
new VConsole();
```

### 3. 多设备测试工具
- BrowserStack
- CrossBrowserTesting
- 微信开发者工具

## 七、性能优化建议

1. **资源加载**：
   ```html
   <!-- 预加载关键资源 -->
   <link rel="preload" href="critical.css" as="style">
   ```

2. **图片懒加载**：
   ```html
   <img data-src="image.jpg" class="lazyload">
   ```

3. **代码分割**：
   ```javascript
   // 动态加载非关键组件
   const Modal = () => import('./Modal.vue');
   ```

## 八、框架集成方案

### 1. Vue适配方案
```javascript
// main.js
import 'lib-flexible'  // 自动设置rem基准值
```

### 2. React适配方案
```javascript
// 使用react-device-detect
import { isMobile } from 'react-device-detect';
function Component() {
  return isMobile ? <MobileView /> : <DesktopView />;
}
```

### 3. 第三方解决方案
- [amfe-flexible](https://github.com/amfe/lib-flexible)
- [hotcss](https://github.com/imochen/hotcss)
- [vw-layout](https://www.npmjs.com/package/vw-layout)

通过以上方案的综合运用，可以完美解决H5页面在移动端的适配问题，实现多设备、多分辨率的统一显示效果。实际项目中建议根据具体情况选择合适的方案组合。
