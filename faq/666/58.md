## 58. 为什么 SPA 应用都会提供一个 hash 路由，好处是什么？

在单页应用（SPA）中，**Hash 路由**（如 `https://example.com/#/user/profile`）和 **History 路由**（如 `https://example.com/user/profile`）是两种主要的路由实现方式。虽然现代 SPA 框架（如 React Router、Vue Router）默认推荐使用 History 路由，但 Hash 路由仍然被广泛支持，尤其是在特定场景下具有不可替代的优势。以下是 Hash 路由的核心优势及其技术原理：

---

### 🌟 **Hash 路由的核心优势**
#### 1. **无需服务器配置** 🛠️
- **问题**：History 路由需要服务器端配置（如 Nginx 的 `try_files`），否则直接访问 `/user/profile` 会返回 404。
- **Hash 路由解决方案**：
  URL 中 `#` 后的内容（即 hash）不会被发送到服务器，服务器始终返回 `index.html`，路由解析完全由前端 JavaScript 处理。
  ✅ **适用于静态托管服务（GitHub Pages、Netlify等）**。

#### 2. **完美兼容老旧浏览器** ️🔄
- **问题**：History API（`pushState`/`replaceState`）需要 IE10+，而 hash 路由仅依赖 `window.location.hash`。
- **Hash 路由解决方案**：
  使用 `onhashchange` 事件（IE8+ 支持）监听路由变化。
  ✅ **适合需要兼容 IE9 及以下的项目**。

#### 3. **避免 CSR 应用的 SEO 陷阱** 📊
- **误解**：Hash 路由对 SEO 不友好（Google 已能抓取 hash 内容，但其他搜索引擎可能不行）。
- **真相**：
  对于纯 CSR 应用，无论 History 还是 Hash 路由，SEO 都需要额外处理（如预渲染、SSR）。Hash 路由至少能保证功能正常。
  ✅ **在未做 SEO 优化的纯前端项目中，Hash 更稳定**。

#### 4. **规避子路径部署的麻烦** 🏗️
- **问题**：当 SPA 部署在非根路径（如 `https://example.com/my-app/`）时，History 路由需要配置 `basename`，而 hash 路由天然支持。
- **示例**：
  ```bash
  # History 路由需配置
  https://example.com/my-app/user/profile  # 需服务器映射
  # Hash 路由无压力
  https://example.com/my-app/#/user/profile
  ```

#### 5. **更简单的锚点集成** ⚓
- **优势**：Hash 路由天然支持页面内锚点跳转（如 `#section1`），与路由系统无冲突。
- **对比**：History 路由需特殊处理锚点（如 React 的 `react-router-hash-link`）。

---

### ⚡ **技术实现对比**
| 特性                | Hash 路由                          | History 路由                     |
|---------------------|-----------------------------------|----------------------------------|
| URL 格式            | `example.com/#/path`              | `example.com/path`              |
| 服务器要求          | 无特殊配置                        | 需配置 Fallback 到 `index.html`  |
| 兼容性              | IE8+                              | IE10+                           |
| SEO                 | 需额外处理（与 History 相同）      | 需额外处理                      |
| 锚点冲突            | 无                                | 需特殊处理                      |
| 部署子路径          | 直接支持                          | 需配置 `basename`               |

---

### 📦 **现代框架中的 Hash 路由**
#### Vue Router
```javascript
const router = new VueRouter({
  mode: 'hash', // 默认是 'history'
  routes: [...]
})
```

#### React Router
```javascript
<BrowserRouter>         {/* 使用 History API */}
<HashRouter>            {/* 使用 Hash 路由 */}
```

#### Angular Router
```javascript
@NgModule({
  imports: [RouterModule.forRoot(routes, { useHash: true })]
})
```

---

### 🛠️ **何时选择 Hash 路由？**
1. **无法控制服务器配置**（如静态托管服务、CDN 部署）。
2. **需要兼容 IE9 及以下浏览器**。
3. **快速原型开发**，避免复杂的部署配置。
4. **微前端子应用**，避免主应用和子应用的路由冲突。

---

### ⚠️ **Hash 路由的局限性**
1. **URL 美观度**：`#` 在 URL 中显得不够简洁。
2. **服务端统计**：Hash 部分不会被发送到服务器，影响基于 URL 的统计。
3. **SSR 不友好**：难以实现服务端渲染的同构路由。

---

### 🔄 **迁移建议**
如果项目初期使用了 Hash 路由，后续想迁移到 History 路由：
1. **服务器配置**：确保所有路径返回 `index.html`。
   ```nginx
   # Nginx 配置
   location / {
     try_files $uri $uri/ /index.html;
   }
   ```
2. **重定向旧链接**：
   设置 301 重定向，将 `/#/path` 跳转到 `/path`。
3. **更新框架配置**：
   修改路由模式为 `history`。

---

### 🌐 **实际案例**
1. **GitHub Pages**：所有 SPA 项目默认使用 Hash 路由（无法配置服务器）。
2. **老版 AngularJS 应用**：广泛依赖 hashbang 路由（如 `#!/home`）。
3. **企业内部系统**：兼容老旧浏览器的首选方案。

---

总结来说，**Hash 路由是 SPA 应用在特定场景下的“安全网”**，它简化了部署和兼容性问题，尽管在美观性和功能上有一定妥协，但在许多实际项目中仍然是不可或缺的选项。