## 119. [ä½ä»£ç ] ä»£ç å¹³å°ä¸€èˆ¬æ¸²æŸ“æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ

ä½ä»£ç å¹³å°çš„æ¸²æŸ“è®¾è®¡æ˜¯å…¶æ ¸å¿ƒèƒ½åŠ›ä¹‹ä¸€ï¼Œæ—¨åœ¨é€šè¿‡å¯è§†åŒ–é…ç½®å¿«é€Ÿç”Ÿæˆå¯è¿è¡Œçš„é¡µé¢æˆ–åº”ç”¨ã€‚ä»¥ä¸‹æ˜¯ä½ä»£ç å¹³å°æ¸²æŸ“è®¾è®¡çš„è¯¦ç»†åŸç†ã€æŠ€æœ¯æ–¹æ¡ˆå’Œä¼˜åŒ–ç­–ç•¥ï¼ˆé™„å…³é”®ä»£ç ç¤ºä¾‹ï¼‰ï¼š

---

## ğŸŒŸ **æ ¸å¿ƒè®¾è®¡ç›®æ ‡**
1. **å¯è§†åŒ–ä¸å®æ—¶æ€§**ï¼šé…ç½®å³æ‰€è§ï¼Œä¿®æ”¹åç«‹å³ç”Ÿæ•ˆã€‚
2. **é«˜æ€§èƒ½æ¸²æŸ“**ï¼šæ”¯æŒå¤æ‚é¡µé¢çš„å¿«é€ŸåŠ è½½ã€‚
3. **æ‰©å±•æ€§**ï¼šå…è®¸è‡ªå®šä¹‰ç»„ä»¶å’Œé€»è¾‘ã€‚
4. **è·¨å¹³å°è¾“å‡º**ï¼šç”Ÿæˆ Webã€ç§»åŠ¨ç«¯æˆ–å¤šç«¯ä»£ç ã€‚

---

## ğŸ›  **æ¸²æŸ“æ¶æ„è®¾è®¡**
### ğŸ“Œ **1. åˆ†å±‚æ¶æ„**
```mermaid
graph TD
    A[Schema å±‚] -->|JSON æè¿°| B[æ¸²æŸ“å¼•æ“]
    B -->|è§£æ| C[è™šæ‹Ÿ DOM]
    C -->|æ˜ å°„| D[çœŸå® DOM]
    D -->|äº¤äº’| E[è¿è¡Œæ—¶é€»è¾‘]
```

---

### ğŸ“Œ **2. å…³é”®æ¨¡å—å®ç°**
#### âœ… **ï¼ˆ1ï¼‰Schema è®¾è®¡**
**æè¿° UI å’Œé€»è¾‘çš„ JSON ç»“æ„**ï¼š
```typescript
interface ComponentSchema {
  id: string;
  type: "button" | "table" | "custom";
  props: Record<string, any>;
  children?: ComponentSchema[];
  events?: {
    onClick?: { action: "submit" | "navigate"; payload: any };
  };
}
```

**ç¤ºä¾‹ Schema**ï¼š
```json
{
  "type": "container",
  "children": [
    {
      "type": "button",
      "props": { "text": "æäº¤", "color": "blue" },
      "events": { "onClick": { "action": "submit" } }
    }
  ]
}
```

---

#### âœ… **ï¼ˆ2ï¼‰æ¸²æŸ“å¼•æ“**
**æ ¸å¿ƒæµç¨‹**ï¼š
```typescript
class RenderEngine {
  render(schema: ComponentSchema, parentEl: HTMLElement) {
    const component = this._createComponent(schema);
    parentEl.appendChild(component);
  }

  private _createComponent(schema: ComponentSchema): HTMLElement {
    const el = document.createElement(this._getTagName(schema.type));
    this._applyProps(el, schema.props);
    this._bindEvents(el, schema.events);
    schema.children?.forEach(child => this.render(child, el));
    return el;
  }
}
```

---

#### âœ… **ï¼ˆ3ï¼‰åŠ¨æ€æ•°æ®ç»‘å®š**
**å®ç°å“åº”å¼æ›´æ–°**ï¼š
```typescript
function observeData(data: object, onUpdate: (key: string) => void) {
  return new Proxy(data, {
    set(target, key, value) {
      target[key] = value;
      onUpdate(key as string);
      return true;
    },
  });
}

// ä½¿ç”¨ç¤ºä¾‹
const state = observeData({ count: 0 }, (key) => {
  console.log(`æ•°æ®å˜åŒ–: ${key}=${state[key]}`);
});
```

---

#### âœ… **ï¼ˆ4ï¼‰è·¨å¹³å°æ¸²æŸ“**
**æŠ½è±¡æ¸²æŸ“æ¥å£**ï¼š
```typescript
interface PlatformRenderer {
  renderButton(props: ButtonProps): void;
  renderText(props: TextProps): void;
}

class WebRenderer implements PlatformRenderer {
  renderButton(props) {
    return `<button class="btn">${props.text}</button>`;
  }
}

class MobileRenderer implements PlatformRenderer {
  renderButton(props) {
    return `<android-button android:text="${props.text}" />`;
  }
}
```

---

## ğŸš€ **æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**
### âœ… **1. æ‡’åŠ è½½ä¸æŒ‰éœ€æ¸²æŸ“**
```typescript
// åŠ¨æ€åŠ è½½ç»„ä»¶
const componentMap = {
  button: () => import('./components/Button'),
  table: () => import('./components/Table'),
};

async function renderComponent(type: string) {
  const module = await componentMap[type]();
  return module.default;
}
```

### âœ… **2. è™šæ‹Ÿ DOM Diff**
```typescript
function diff(oldVNode, newVNode) {
  // æ¯”è¾ƒå·®å¼‚ååªæ›´æ–°å˜åŒ–éƒ¨åˆ†
  if (oldVNode.props.color !== newVNode.props.color) {
    patch(oldVNode.el, 'color', newVNode.props.color);
  }
}
```

### âœ… **3. ç¼“å­˜ç­–ç•¥**
- **Schema ç¼“å­˜**ï¼šå¯¹è§£æåçš„ JSON è¿›è¡Œå“ˆå¸Œç¼“å­˜ã€‚
- **ç»„ä»¶å®ä¾‹å¤ç”¨**ï¼šé€šè¿‡ `key` æ ‡è¯†ç›¸åŒç»„ä»¶ã€‚

---

## ğŸ”§ **æ‰©å±•æ€§è®¾è®¡**
### âœ… **1. è‡ªå®šä¹‰ç»„ä»¶æ³¨å†Œ**
```typescript
class ComponentRegistry {
  private components = new Map<string, ComponentDefinition>();

  register(type: string, definition: ComponentDefinition) {
    this.components.set(type, definition);
  }

  get(type: string) {
    return this.components.get(type);
  }
}

// ä½¿ç”¨ç¤ºä¾‹
registry.register('custom-chart', {
  render: (props) => `<div class="chart">${props.data}</div>`,
});
```

### âœ… **2. é€»è¾‘æ‰©å±•ï¼ˆDSLï¼‰**
**æ”¯æŒè¡¨è¾¾å¼æ±‚å€¼**ï¼š
```typescript
function evalExpression(expr: string, context: object) {
  return new Function('ctx', `return ${expr}`)(context);
}

// ç¤ºä¾‹ï¼š{{ ctx.count > 0 ? 'positive' : 'negative' }}
```

---

## ğŸ›¡ï¸ **ç¨³å®šæ€§ä¿éšœ**
| **é—®é¢˜**          | **è§£å†³æ–¹æ¡ˆ**                              |
|-------------------|-----------------------------------------|
| Schema è§£æå¤±è´¥   | ä¸¥æ ¼æ ¡éªŒ + é™çº§é»˜è®¤ç»„ä»¶                  |
| å¾ªç¯ä¾èµ–          | æ£€æµ‹ç»„ä»¶å¼•ç”¨å…³ç³»å¹¶å‘Šè­¦                   |
| æ€§èƒ½ç“¶é¢ˆ          | ç›‘æ§æ¸²æŸ“è€—æ—¶ï¼Œæ‹†åˆ†å¤§ç»„ä»¶                 |

---

## ğŸ“¦ **å®Œæ•´å·¥ä½œæµç¤ºä¾‹**
1. **ç”¨æˆ·æ‹–æ‹½ç»„ä»¶** â†’ ç”Ÿæˆ Schema JSONã€‚
2. **å¼•æ“è§£æ Schema** â†’ åˆ›å»ºè™šæ‹Ÿ DOMã€‚
3. **æ•°æ®ç»‘å®š** â†’ å“åº”å¼æ›´æ–°è§†å›¾ã€‚
4. **å‘å¸ƒ** â†’ ç”Ÿæˆå¤šç«¯ä»£ç æˆ–ç›´æ¥è¿è¡Œã€‚

```typescript
// ç¤ºä¾‹ï¼šä» Schema åˆ°æ¸²æŸ“
const schema = fetchSchema();
const engine = new RenderEngine();
engine.render(schema, document.getElementById('app'));

// åŠ¨æ€æ›´æ–°
watch(schema, (newSchema) => {
  engine.rerender(newSchema);
});
```

---

## ğŸ¯ **è®¾è®¡éªŒè¯**
1. **åŠŸèƒ½æµ‹è¯•**ï¼šè¦†ç›–ç»„ä»¶æ¸²æŸ“ã€äº‹ä»¶ç»‘å®šã€æ•°æ®æ›´æ–°ã€‚
2. **æ€§èƒ½æµ‹è¯•**ï¼šæ¨¡æ‹Ÿ 1000+ ç»„ä»¶æ¸²æŸ“è€—æ—¶ï¼ˆç›®æ ‡ < 1sï¼‰ã€‚
3. **å…¼å®¹æ€§æµ‹è¯•**ï¼šå¤šç«¯è¾“å‡ºä¸€è‡´æ€§æ ¡éªŒã€‚

---

é€šè¿‡ä»¥ä¸Šè®¾è®¡ï¼Œä½ä»£ç å¹³å°å¯å®ç°ï¼š
âœ… **å¿«é€Ÿæ¸²æŸ“** - æ”¯æŒåƒçº§ç»„ä»¶ç§’çº§åŠ è½½
âœ… **çµæ´»æ‰©å±•** - è‡ªå®šä¹‰ç»„ä»¶å’Œé€»è¾‘
âœ… **ç¨³å®šè¾“å‡º** - å¤šç«¯ä»£ç ç”Ÿæˆæˆ–ç›´æ¥è¿è¡Œ

é€‚ç”¨äºä¼ä¸šçº§ä¸­åå°ã€è¥é”€é¡µé¢æ­å»ºç­‰åœºæ™¯ï¼ ğŸš€