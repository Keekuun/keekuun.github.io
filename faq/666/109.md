## 109. vite 和 webpack 在热更新上有啥区别？

Vite 和 Webpack 在热更新（HMR，Hot Module Replacement）的实现上有显著区别，主要体现在**速度**、**实现原理**和**开发体验**上。以下是它们的核心差异：

---

### 🚀 **1. 热更新速度**
| **工具** | **速度** | **原因** |
|----------|----------|----------|
| **Vite** | ⚡ **极快** | 基于原生 ESM，按需编译，无需打包。 |
| **Webpack** | 🐢 **较慢** | 基于打包器，全量构建和更新。 |

- **Vite**：仅重新编译变动的文件，直接通过浏览器原生 ESM 加载，几乎无延迟。
- **Webpack**：需要重新构建变动的模块及其依赖，速度受项目规模影响较大。

---

### 🔧 **2. 实现原理**
| **工具** | **原理** | **流程** |
|----------|----------|----------|
| **Vite** | 🌐 **原生 ESM + 即时编译** | 1. 浏览器直接请求源码（ESM）。<br>2. 服务端按需编译并返回。<br>3. HMR 通过 WebSocket 推送变更。 |
| **Webpack** | 📦 **打包器 + HMR Runtime** | 1. 启动时全量打包。<br>2. 通过 `webpack-dev-server` 注入 HMR Runtime。<br>3. 增量更新模块。 |

#### **Vite 的 HMR 流程**
1. 浏览器加载未打包的 ESM 模块。
2. 文件修改后，Vite 仅编译该文件并通过 WebSocket 通知浏览器。
3. 浏览器直接替换对应模块（无刷新）。

#### **Webpack 的 HMR 流程**
1. 修改文件后，Webpack 重新构建变动的模块及其依赖。
2. 通过 `hot.accept` 通知客户端更新。
3. 客户端替换模块并执行相关回调（可能触发页面刷新）。

---

### 📜 **3. 代码示例对比**
#### **Vite 的 HMR 支持**
Vite 默认支持主流框架（如 Vue、React）的 HMR，无需额外配置：
```javascript
// 修改组件时，Vite 自动触发 HMR
import { useState } from 'react';

function App() {
    const [count, setCount] = useState(0);
    return <button onClick={() => setCount(count + 1)}>Count: {count}</button>;
}
```

#### **Webpack 的 HMR 配置**
Webpack 需要手动配置 `hot: true` 和模块更新逻辑：
```javascript
// webpack.config.js
module.exports = {
    devServer: {
        hot: true,
    },
};

// 客户端代码需手动处理 HMR
if (module.hot) {
    module.hot.accept('./App', () => {
        render(<App />, document.getElementById('root'));
    });
}
```

---

### 🛠 **4. 开发体验**
| **特性**       | **Vite**                          | **Webpack**                      |
|----------------|-----------------------------------|----------------------------------|
| **启动时间**   | ⚡ 毫秒级（无需打包）             | 🐢 秒级（依赖项目规模）          |
| **更新速度**   | ⚡ 即时（单文件编译）              | 🐢 较慢（依赖构建链）            |
| **配置复杂度** | 🌟 简单（开箱即用）               | 🔧 复杂（需手动配置 HMR）        |
| **生态支持**   | 🧩 逐渐完善（现代框架优先）       | 🏗 成熟（支持所有场景）          |

---

### 🌟 **5. 如何选择？**
- **选 Vite**：
    - 追求极速启动和热更新。
    - 项目基于现代框架（Vue/React/Svelte）。
    - 无需复杂定制化构建。
- **选 Webpack**：
    - 需要兼容旧浏览器或复杂构建流程。
    - 项目依赖 Webpack 生态（如 Babel 插件、Loader）。

---

### ⚠️ **注意事项**
1. **Vite 的局限性**：
    - 对 CommonJS 模块支持较弱。
    - 生产环境仍需打包（使用 Rollup）。
2. **Webpack 的优化**：
    - 可通过 `cache` 和 `persistent cache` 提升 HMR 速度。

---

### 📊 **总结**
| **工具** | **热更新优势**               | **适用场景**               |
|----------|------------------------------|--------------------------|
| Vite     | ⚡ 快、简单、原生 ESM         | 现代框架、快速开发       |
| Webpack  | 🏗 灵活、生态成熟、兼容性强   | 复杂项目、传统浏览器支持 |

两者各有优劣，根据项目需求选择即可！ 🎉