## 68. Eslint 代码检查的过程是啥？

`ESLint` 是一个用于 **静态代码分析** 的工具，通过预定义的规则检查 JavaScript/TypeScript 代码中的潜在问题。以下是它的核心工作流程和原理详解：

---

## **1. 核心检查流程**
### **(1) 解析（Parsing）**
- **将代码转换为抽象语法树（AST）**：
  ESLint 使用解析器（如 `Espree`、`@typescript-eslint/parser`）将源代码解析为 AST，生成一棵结构化语法树。
  ```javascript
  // 示例代码
  const foo = 1;
  ```
  对应的 AST 片段：
  ```json
  {
    "type": "VariableDeclaration",
    "declarations": [{
      "type": "VariableDeclarator",
      "id": { "type": "Identifier", "name": "foo" },
      "init": { "type": "Literal", "value": 1 }
    }]
  }
  ```

### **(2) 遍历（Traversal）**
- **访问 AST 节点**：
  ESLint 通过 **深度优先遍历** 访问 AST 的每个节点，检查是否符合规则。
    - 例如：检查变量是否未使用（`no-unused-vars` 规则）。

### **(3) 规则检查（Linting）**
- **应用规则集**：
  每条规则是一个函数，接收当前节点和上下文，返回错误或警告。
  ```javascript
  // 示例规则：禁止使用 console
  module.exports = {
    create(context) {
      return {
        CallExpression(node) {
          if (node.callee.object?.name === 'console') {
            context.report({ node, message: 'Unexpected console statement' });
          }
        }
      };
    }
  };
  ```

### **(4) 报告（Reporting）**
- **输出问题**：
  将检查结果分类为错误（Error）或警告（Warning），并显示位置和修复建议。
  ```
  /src/index.js
    1:5  error  'foo' is assigned but never used  no-unused-vars
  ```

---

## **2. 关键组成部分**
### **(1) 配置文件（.eslintrc）**
定义检查规则和解析器配置：
```json
{
  "parser": "@typescript-eslint/parser",
  "rules": {
    "no-unused-vars": "error",
    "semi": ["error", "always"]
  }
}
```

### **(2) 插件（Plugins）**
扩展 ESLint 的能力：
- **添加规则**：如 `eslint-plugin-react` 提供 React 相关规则。
- **支持新语法**：如 `@typescript-eslint` 支持 TypeScript。

### **(3) 共享配置（Shareable Configs）**
直接复用预设规则集：
```json
{
  "extends": ["airbnb", "prettier"]
}
```

### **(4) 解析器（Parser）**
- 默认解析器：`Espree`（基于 Acorn）。
- 其他解析器：
    - `@typescript-eslint/parser`：解析 TypeScript。
    - `babel-eslint`：支持实验性语法。

---

## **3. 执行方式**
### **(1) 命令行**
```bash
eslint src/**/*.js --fix  # 检查并自动修复
```

### **(2) 编辑器集成**
- **VS Code**：通过 `ESLint` 插件实时检查。
- **WebStorm**：内置支持。

### **(3) 构建工具集成**
- **Webpack**：`eslint-webpack-plugin`。
- **Vite**：`vite-plugin-eslint`。

---

## **4. 性能优化**
### **(1) 增量检查**
只检查修改过的文件：
```bash
eslint --cache
```

### **(2) 忽略文件**
通过 `.eslintignore` 排除不需要检查的文件：
```
node_modules/
dist/
```

### **(3) 并行检查**
使用 `--max-warnings` 和 `--no-inline-config` 减少开销。

---

## **5. 与 Prettier 的协作**
- **分工**：
    - ESLint 负责代码质量（如未使用的变量）。
    - Prettier 负责代码风格（如缩进、引号）。
- **集成配置**：
  ```json
  {
    "extends": ["prettier"],
    "plugins": ["prettier"],
    "rules": {
      "prettier/prettier": "error"
    }
  }
  ```

---

## **6. 示例：从零配置 ESLint**
### **(1) 安装依赖**
```bash
npm install eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin --save-dev
```

### **(2) 配置文件（.eslintrc.js）**
```javascript
module.exports = {
  parser: "@typescript-eslint/parser",
  plugins: ["@typescript-eslint"],
  extends: ["eslint:recommended", "plugin:@typescript-eslint/recommended"],
  rules: {
    "@typescript-eslint/no-unused-vars": "error"
  }
};
```

### **(3) 运行检查**
```bash
eslint src/**/*.ts --fix
```

---

## **7. 总结**
- **核心流程**：解析 → 遍历 → 规则检查 → 报告。
- **关键配置**：规则、插件、解析器、共享配置。
- **优化方向**：增量检查、并行处理、编辑器集成。

通过 ESLint，可以系统化地提升代码质量和团队协作效率！ 🛠️