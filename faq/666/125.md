## 125. 在你的项目中，使用过哪些 webpack loader，说一下它们的作用

在 **React + TypeScript** 项目中，Webpack Loader 用于处理不同类型的文件（如转译、压缩、静态资源转换等）。以下是我常用的 Loader 及其作用，结合代码示例和优化场景说明：

---

## 🌟 **核心 Loader 分类**
| **类型**         | **典型 Loader**               | **作用**                           |
|------------------|-------------------------------|-----------------------------------|
| **JavaScript**   | `babel-loader`               | 转译 ES6+/TS 为浏览器兼容代码       |
| **样式处理**     | `css-loader` + `sass-loader` | 解析 CSS/SCSS 并处理依赖            |
| **静态资源**     | `file-loader`                | 处理图片/字体等文件路径             |
| **代码校验**     | `eslint-loader`              | 实时检查 JavaScript/TS 语法        |
| **性能优化**     | `thread-loader`              | 多线程加速构建                      |

---

## 🛠 **详细 Loader 解析**
### 📌 **1. JavaScript/TypeScript 处理**
#### ✅ **`babel-loader`**
**作用**：将 ES6+/TypeScript 代码转译为 ES5，支持新特性（如装饰器、可选链）。
**配置示例**：
```javascript
// webpack.config.js
module: {
  rules: [
    {
      test: /\.(js|jsx|ts|tsx)$/,
      exclude: /node_modules/,
      use: {
        loader: 'babel-loader',
        options: {
          presets: [
            '@babel/preset-env',
            '@babel/preset-react',
            '@babel/preset-typescript'
          ],
          plugins: ['@babel/plugin-proposal-class-properties']
        }
      }
    }
  ]
}
```
**关键点**：
- 通过 `@babel/preset-typescript` 直接处理 TS 文件，无需单独 `ts-loader`。
- 支持 `React` JSX 语法转换。

---

#### ✅ **`ts-loader`**（备选）
**作用**：专用于 TypeScript 的类型检查和转译，通常与 `babel-loader` 配合使用。
```javascript
rules: [
  {
    test: /\.tsx?$/,
    use: [
      'babel-loader',
      {
        loader: 'ts-loader',
        options: {
          transpileOnly: true // 禁用类型检查（提升速度）
        }
      }
    ]
  }
]
```
**适用场景**：需要严格类型检查时，结合 `fork-ts-checker-webpack-plugin` 在后台运行类型检查。

---

### 📌 **2. 样式处理**
#### ✅ **`css-loader` + `style-loader`**
**作用**：解析 `@import` 和 `url()` 依赖，并将 CSS 注入到 DOM。
```javascript
rules: [
  {
    test: /\.css$/,
    use: ['style-loader', 'css-loader']
  }
]
```
**生产环境优化**：替换 `style-loader` 为 `MiniCssExtractPlugin.loader` 生成独立 CSS 文件。

---

#### ✅ **`sass-loader`**
**作用**：将 SCSS/SASS 编译为 CSS，依赖 `node-sass` 或 `dart-sass`。
```javascript
rules: [
  {
    test: /\.scss$/,
    use: [
      'style-loader',
      'css-loader',
      {
        loader: 'sass-loader',
        options: {
          implementation: require('sass') // 使用 dart-sass
        }
      }
    ]
  }
]
```

---

### 📌 **3. 静态资源处理**
#### ✅ **`file-loader`**
**作用**：处理图片/字体文件，返回最终路径。
```javascript
rules: [
  {
    test: /\.(png|jpe?g|gif|woff2?)$/,
    use: {
      loader: 'file-loader',
      options: {
        name: '[name].[hash:8].[ext]',
        outputPath: 'assets' // 输出到 dist/assets
      }
    }
  }
]
```

---

#### ✅ **`url-loader`**
**作用**：小文件转为 Base64 内联，减少 HTTP 请求。
```javascript
rules: [
  {
    test: /\.(png|jpe?g)$/,
    use: {
      loader: 'url-loader',
      options: {
        limit: 8192, // 小于 8KB 的文件转为 Base64
        fallback: 'file-loader' // 超过限制时降级处理
      }
    }
  }
]
```

---

### 📌 **4. 代码校验与优化**
#### ✅ **`eslint-loader`**
**作用**：实时校验代码规范（需配合 `.eslintrc` 配置）。
```javascript
rules: [
  {
    test: /\.(js|jsx|ts|tsx)$/,
    enforce: 'pre', // 优先执行
    use: ['eslint-loader'],
    exclude: /node_modules/
  }
]
```
**注意**：已废弃，推荐使用 `ESLintWebpackPlugin`（Webpack 5+）。

---

#### ✅ **`thread-loader`**
**作用**：将耗时的 Loader（如 Babel）放在多线程中执行。
```javascript
rules: [
  {
    test: /\.js$/,
    use: [
      'thread-loader', // 放在其他 Loader 之前
      'babel-loader'
    ]
  }
]
```
**性能提升**：构建时间减少 30%~50%（实测数据）。

---

### 📌 **5. 其他实用 Loader**
#### ✅ **`svg-sprite-loader`**
**作用**：将 SVG 图标合并为雪碧图，减少请求。
```javascript
rules: [
  {
    test: /\.svg$/,
    use: [
      {
        loader: 'svg-sprite-loader',
        options: {
          symbolId: 'icon-[name]' // 使用 <use xlink:href="#icon-name">
        }
      }
    ]
  }
]
```

---

#### ✅ **`raw-loader`**
**作用**：将文件内容作为字符串导入（如 HTML 模板）。
```javascript
rules: [
  {
    test: /\.html$/,
    use: 'raw-loader'
  }
]
```

---

## 🎯 **Loader 最佳实践**
### ✅ **1. 开发 vs 生产差异化配置**
```javascript
// webpack.dev.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader']
      }
    ]
  }
};

// webpack.prod.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [MiniCssExtractPlugin.loader, 'css-loader']
      }
    ]
  }
};
```

---

### ✅ **2. 性能优化组合**
```javascript
// 多线程 + 缓存
rules: [
  {
    test: /\.jsx?$/,
    use: [
      {
        loader: 'thread-loader',
        options: {
          workers: 4
        }
      },
      {
        loader: 'babel-loader',
        options: {
          cacheDirectory: true // 启用缓存
        }
      }
    ]
  }
]
```

---

### ✅ **3. 解决常见问题**
#### **问题**：`node_modules` 下的库未转译
**方案**：显式包含需要转译的库
```javascript
{
  test: /\.js$/,
  include: [
    path.resolve(__dirname, 'src'),
    path.resolve(__dirname, 'node_modules/some-lib') // 特殊处理
  ],
  use: ['babel-loader']
}
```

---

## 📦 **完整配置参考**
```javascript
// webpack.config.js
module.exports = {
  module: {
    rules: [
      // JavaScript/TypeScript
      {
        test: /\.(js|jsx|ts|tsx)$/,
        exclude: /node_modules/,
        use: ['babel-loader']
      },
      // 样式
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader']
      },
      {
        test: /\.scss$/,
        use: ['style-loader', 'css-loader', 'sass-loader']
      },
      // 静态资源
      {
        test: /\.(png|jpe?g|gif)$/,
        use: {
          loader: 'url-loader',
          options: { limit: 8192 }
        }
      },
      // SVG 雪碧图
      {
        test: /\.svg$/,
        use: ['svg-sprite-loader']
      }
    ]
  }
};
```

通过合理配置 Loader，可以实现：
✅ **代码兼容性**（ES5 支持）
✅ **开发效率**（热更新 + 实时校验）
✅ **性能优化**（多线程 + 缓存）
✅ **资源管理**（图片压缩、CSS 提取）