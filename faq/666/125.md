## 125. åœ¨ä½ çš„é¡¹ç›®ä¸­ï¼Œä½¿ç”¨è¿‡å“ªäº› webpack loaderï¼Œè¯´ä¸€ä¸‹å®ƒä»¬çš„ä½œç”¨

åœ¨ **React + TypeScript** é¡¹ç›®ä¸­ï¼ŒWebpack Loader ç”¨äºå¤„ç†ä¸åŒç±»å‹çš„æ–‡ä»¶ï¼ˆå¦‚è½¬è¯‘ã€å‹ç¼©ã€é™æ€èµ„æºè½¬æ¢ç­‰ï¼‰ã€‚ä»¥ä¸‹æ˜¯æˆ‘å¸¸ç”¨çš„ Loader åŠå…¶ä½œç”¨ï¼Œç»“åˆä»£ç ç¤ºä¾‹å’Œä¼˜åŒ–åœºæ™¯è¯´æ˜ï¼š

---

## ğŸŒŸ **æ ¸å¿ƒ Loader åˆ†ç±»**
| **ç±»å‹**         | **å…¸å‹ Loader**               | **ä½œç”¨**                           |
|------------------|-------------------------------|-----------------------------------|
| **JavaScript**   | `babel-loader`               | è½¬è¯‘ ES6+/TS ä¸ºæµè§ˆå™¨å…¼å®¹ä»£ç        |
| **æ ·å¼å¤„ç†**     | `css-loader` + `sass-loader` | è§£æ CSS/SCSS å¹¶å¤„ç†ä¾èµ–            |
| **é™æ€èµ„æº**     | `file-loader`                | å¤„ç†å›¾ç‰‡/å­—ä½“ç­‰æ–‡ä»¶è·¯å¾„             |
| **ä»£ç æ ¡éªŒ**     | `eslint-loader`              | å®æ—¶æ£€æŸ¥ JavaScript/TS è¯­æ³•        |
| **æ€§èƒ½ä¼˜åŒ–**     | `thread-loader`              | å¤šçº¿ç¨‹åŠ é€Ÿæ„å»º                      |

---

## ğŸ›  **è¯¦ç»† Loader è§£æ**
### ğŸ“Œ **1. JavaScript/TypeScript å¤„ç†**
#### âœ… **`babel-loader`**
**ä½œç”¨**ï¼šå°† ES6+/TypeScript ä»£ç è½¬è¯‘ä¸º ES5ï¼Œæ”¯æŒæ–°ç‰¹æ€§ï¼ˆå¦‚è£…é¥°å™¨ã€å¯é€‰é“¾ï¼‰ã€‚
**é…ç½®ç¤ºä¾‹**ï¼š
```javascript
// webpack.config.js
module: {
  rules: [
    {
      test: /\.(js|jsx|ts|tsx)$/,
      exclude: /node_modules/,
      use: {
        loader: 'babel-loader',
        options: {
          presets: [
            '@babel/preset-env',
            '@babel/preset-react',
            '@babel/preset-typescript'
          ],
          plugins: ['@babel/plugin-proposal-class-properties']
        }
      }
    }
  ]
}
```
**å…³é”®ç‚¹**ï¼š
- é€šè¿‡ `@babel/preset-typescript` ç›´æ¥å¤„ç† TS æ–‡ä»¶ï¼Œæ— éœ€å•ç‹¬ `ts-loader`ã€‚
- æ”¯æŒ `React` JSX è¯­æ³•è½¬æ¢ã€‚

---

#### âœ… **`ts-loader`**ï¼ˆå¤‡é€‰ï¼‰
**ä½œç”¨**ï¼šä¸“ç”¨äº TypeScript çš„ç±»å‹æ£€æŸ¥å’Œè½¬è¯‘ï¼Œé€šå¸¸ä¸ `babel-loader` é…åˆä½¿ç”¨ã€‚
```javascript
rules: [
  {
    test: /\.tsx?$/,
    use: [
      'babel-loader',
      {
        loader: 'ts-loader',
        options: {
          transpileOnly: true // ç¦ç”¨ç±»å‹æ£€æŸ¥ï¼ˆæå‡é€Ÿåº¦ï¼‰
        }
      }
    ]
  }
]
```
**é€‚ç”¨åœºæ™¯**ï¼šéœ€è¦ä¸¥æ ¼ç±»å‹æ£€æŸ¥æ—¶ï¼Œç»“åˆ `fork-ts-checker-webpack-plugin` åœ¨åå°è¿è¡Œç±»å‹æ£€æŸ¥ã€‚

---

### ğŸ“Œ **2. æ ·å¼å¤„ç†**
#### âœ… **`css-loader` + `style-loader`**
**ä½œç”¨**ï¼šè§£æ `@import` å’Œ `url()` ä¾èµ–ï¼Œå¹¶å°† CSS æ³¨å…¥åˆ° DOMã€‚
```javascript
rules: [
  {
    test: /\.css$/,
    use: ['style-loader', 'css-loader']
  }
]
```
**ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–**ï¼šæ›¿æ¢ `style-loader` ä¸º `MiniCssExtractPlugin.loader` ç”Ÿæˆç‹¬ç«‹ CSS æ–‡ä»¶ã€‚

---

#### âœ… **`sass-loader`**
**ä½œç”¨**ï¼šå°† SCSS/SASS ç¼–è¯‘ä¸º CSSï¼Œä¾èµ– `node-sass` æˆ– `dart-sass`ã€‚
```javascript
rules: [
  {
    test: /\.scss$/,
    use: [
      'style-loader',
      'css-loader',
      {
        loader: 'sass-loader',
        options: {
          implementation: require('sass') // ä½¿ç”¨ dart-sass
        }
      }
    ]
  }
]
```

---

### ğŸ“Œ **3. é™æ€èµ„æºå¤„ç†**
#### âœ… **`file-loader`**
**ä½œç”¨**ï¼šå¤„ç†å›¾ç‰‡/å­—ä½“æ–‡ä»¶ï¼Œè¿”å›æœ€ç»ˆè·¯å¾„ã€‚
```javascript
rules: [
  {
    test: /\.(png|jpe?g|gif|woff2?)$/,
    use: {
      loader: 'file-loader',
      options: {
        name: '[name].[hash:8].[ext]',
        outputPath: 'assets' // è¾“å‡ºåˆ° dist/assets
      }
    }
  }
]
```

---

#### âœ… **`url-loader`**
**ä½œç”¨**ï¼šå°æ–‡ä»¶è½¬ä¸º Base64 å†…è”ï¼Œå‡å°‘ HTTP è¯·æ±‚ã€‚
```javascript
rules: [
  {
    test: /\.(png|jpe?g)$/,
    use: {
      loader: 'url-loader',
      options: {
        limit: 8192, // å°äº 8KB çš„æ–‡ä»¶è½¬ä¸º Base64
        fallback: 'file-loader' // è¶…è¿‡é™åˆ¶æ—¶é™çº§å¤„ç†
      }
    }
  }
]
```

---

### ğŸ“Œ **4. ä»£ç æ ¡éªŒä¸ä¼˜åŒ–**
#### âœ… **`eslint-loader`**
**ä½œç”¨**ï¼šå®æ—¶æ ¡éªŒä»£ç è§„èŒƒï¼ˆéœ€é…åˆ `.eslintrc` é…ç½®ï¼‰ã€‚
```javascript
rules: [
  {
    test: /\.(js|jsx|ts|tsx)$/,
    enforce: 'pre', // ä¼˜å…ˆæ‰§è¡Œ
    use: ['eslint-loader'],
    exclude: /node_modules/
  }
]
```
**æ³¨æ„**ï¼šå·²åºŸå¼ƒï¼Œæ¨èä½¿ç”¨ `ESLintWebpackPlugin`ï¼ˆWebpack 5+ï¼‰ã€‚

---

#### âœ… **`thread-loader`**
**ä½œç”¨**ï¼šå°†è€—æ—¶çš„ Loaderï¼ˆå¦‚ Babelï¼‰æ”¾åœ¨å¤šçº¿ç¨‹ä¸­æ‰§è¡Œã€‚
```javascript
rules: [
  {
    test: /\.js$/,
    use: [
      'thread-loader', // æ”¾åœ¨å…¶ä»– Loader ä¹‹å‰
      'babel-loader'
    ]
  }
]
```
**æ€§èƒ½æå‡**ï¼šæ„å»ºæ—¶é—´å‡å°‘ 30%~50%ï¼ˆå®æµ‹æ•°æ®ï¼‰ã€‚

---

### ğŸ“Œ **5. å…¶ä»–å®ç”¨ Loader**
#### âœ… **`svg-sprite-loader`**
**ä½œç”¨**ï¼šå°† SVG å›¾æ ‡åˆå¹¶ä¸ºé›ªç¢§å›¾ï¼Œå‡å°‘è¯·æ±‚ã€‚
```javascript
rules: [
  {
    test: /\.svg$/,
    use: [
      {
        loader: 'svg-sprite-loader',
        options: {
          symbolId: 'icon-[name]' // ä½¿ç”¨ <use xlink:href="#icon-name">
        }
      }
    ]
  }
]
```

---

#### âœ… **`raw-loader`**
**ä½œç”¨**ï¼šå°†æ–‡ä»¶å†…å®¹ä½œä¸ºå­—ç¬¦ä¸²å¯¼å…¥ï¼ˆå¦‚ HTML æ¨¡æ¿ï¼‰ã€‚
```javascript
rules: [
  {
    test: /\.html$/,
    use: 'raw-loader'
  }
]
```

---

## ğŸ¯ **Loader æœ€ä½³å®è·µ**
### âœ… **1. å¼€å‘ vs ç”Ÿäº§å·®å¼‚åŒ–é…ç½®**
```javascript
// webpack.dev.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader']
      }
    ]
  }
};

// webpack.prod.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [MiniCssExtractPlugin.loader, 'css-loader']
      }
    ]
  }
};
```

---

### âœ… **2. æ€§èƒ½ä¼˜åŒ–ç»„åˆ**
```javascript
// å¤šçº¿ç¨‹ + ç¼“å­˜
rules: [
  {
    test: /\.jsx?$/,
    use: [
      {
        loader: 'thread-loader',
        options: {
          workers: 4
        }
      },
      {
        loader: 'babel-loader',
        options: {
          cacheDirectory: true // å¯ç”¨ç¼“å­˜
        }
      }
    ]
  }
]
```

---

### âœ… **3. è§£å†³å¸¸è§é—®é¢˜**
#### **é—®é¢˜**ï¼š`node_modules` ä¸‹çš„åº“æœªè½¬è¯‘
**æ–¹æ¡ˆ**ï¼šæ˜¾å¼åŒ…å«éœ€è¦è½¬è¯‘çš„åº“
```javascript
{
  test: /\.js$/,
  include: [
    path.resolve(__dirname, 'src'),
    path.resolve(__dirname, 'node_modules/some-lib') // ç‰¹æ®Šå¤„ç†
  ],
  use: ['babel-loader']
}
```

---

## ğŸ“¦ **å®Œæ•´é…ç½®å‚è€ƒ**
```javascript
// webpack.config.js
module.exports = {
  module: {
    rules: [
      // JavaScript/TypeScript
      {
        test: /\.(js|jsx|ts|tsx)$/,
        exclude: /node_modules/,
        use: ['babel-loader']
      },
      // æ ·å¼
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader']
      },
      {
        test: /\.scss$/,
        use: ['style-loader', 'css-loader', 'sass-loader']
      },
      // é™æ€èµ„æº
      {
        test: /\.(png|jpe?g|gif)$/,
        use: {
          loader: 'url-loader',
          options: { limit: 8192 }
        }
      },
      // SVG é›ªç¢§å›¾
      {
        test: /\.svg$/,
        use: ['svg-sprite-loader']
      }
    ]
  }
};
```

é€šè¿‡åˆç†é…ç½® Loaderï¼Œå¯ä»¥å®ç°ï¼š
âœ… **ä»£ç å…¼å®¹æ€§**ï¼ˆES5 æ”¯æŒï¼‰
âœ… **å¼€å‘æ•ˆç‡**ï¼ˆçƒ­æ›´æ–° + å®æ—¶æ ¡éªŒï¼‰
âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼ˆå¤šçº¿ç¨‹ + ç¼“å­˜ï¼‰
âœ… **èµ„æºç®¡ç†**ï¼ˆå›¾ç‰‡å‹ç¼©ã€CSS æå–ï¼‰