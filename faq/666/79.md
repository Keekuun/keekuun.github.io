## 79. 用 JS 写一个 cookies 解析函数，输出结果为一个对象

以下是一个用 JavaScript 编写的 `cookies` 解析函数，它将 `document.cookie` 字符串解析为一个对象，方便读取和操作 Cookie 数据。代码使用 TypeScript 类型增强可读性。

---

### **1. 实现代码**
```typescript
/**
 * 解析当前页面的 cookies，返回一个键值对对象
 * @returns {Record<string, string>} Cookie 对象
 */
function parseCookies(): Record<string, string> {
  // 获取当前页面的所有 cookies
  const cookiesString = document.cookie;

  // 如果 cookies 为空，返回空对象
  if (!cookiesString) {
    return {};
  }

  // 分割 cookies 字符串为键值对数组
  const cookiePairs = cookiesString.split('; ');

  // 转换为对象
  const cookies: Record<string, string> = {};

  for (const pair of cookiePairs) {
    // 分割键值对
    const [key, value] = pair.split('=');

    // 解码并存储（因为 cookie 值可能是 URL 编码的）
    cookies[decodeURIComponent(key)] = decodeURIComponent(value);
  }

  return cookies;
}

// 使用示例
const cookies = parseCookies();
console.log(cookies); // 输出：{ "key1": "value1", "key2": "value2", ... }
```

---

### **2. 功能说明**
1. **输入**：`document.cookie` 字符串（如 `"name=John; age=30; city=New%20York"`）。
2. **输出**：解析后的对象（如 `{ name: "John", age: "30", city: "New York" }`）。
3. **特性**：
    - 自动解码 URL 编码的键和值（如 `%20` → 空格）。
    - 处理多个 Cookie 分割符（`;`）。
    - 空 Cookie 字符串时返回空对象。

---

### **3. 测试用例**
```typescript
// 设置测试 cookies
document.cookie = "username=Alice";
document.cookie = "token=abc123";
document.cookie = "language=en%20US";

// 解析并打印
console.log(parseCookies());
// 输出：{ username: "Alice", token: "abc123", language: "en US" }
```

---

### **4. 注意事项**
1. **安全性**：
    - 避免存储敏感信息（如密码）在 Cookie 中。
    - 使用 `HttpOnly` 和 `Secure` 标志增强安全性。
2. **编码问题**：
    - 如果 Cookie 值包含特殊字符（如 `=` 或 `;`），确保在设置时进行 `encodeURIComponent`。
3. **浏览器兼容性**：
    - 所有现代浏览器均支持 `document.cookie` 和 `decodeURIComponent`。

---

### **5. 进阶扩展**
如果需要支持更复杂的 Cookie 操作（如设置过期时间、域名限制等），可以封装一个完整的 Cookie 工具库：

```typescript
/**
 * 设置 Cookie
 * @param key - Cookie 键名
 * @param value - Cookie 值
 * @param options - 可选配置（过期时间、域名等）
 */
function setCookie(
  key: string,
  value: string,
  options: { expires?: Date; domain?: string; path?: string; secure?: boolean } = {}
): void {
  let cookieString = `${encodeURIComponent(key)}=${encodeURIComponent(value)}`;

  if (options.expires) {
    cookieString += `; expires=${options.expires.toUTCString()}`;
  }
  if (options.domain) {
    cookieString += `; domain=${options.domain}`;
  }
  if (options.path) {
    cookieString += `; path=${options.path}`;
  }
  if (options.secure) {
    cookieString += '; secure';
  }

  document.cookie = cookieString;
}

// 使用示例
setCookie("theme", "dark", { expires: new Date(Date.now() + 86400000), path: "/" });
```

---

通过这个函数，你可以轻松解析和操作 Cookie，提升开发效率！ 🍪🚀