## 124. åœ¨ä½ çš„é¡¹ç›®ä¸­ï¼Œä½¿ç”¨è¿‡å“ªäº› webpack pluginï¼Œè¯´ä¸€ä¸‹å®ƒä»¬çš„ä½œç”¨

åœ¨é¡¹ç›®ä¸­ï¼ŒWebpack æ’ä»¶ï¼ˆPluginsï¼‰ç”¨äºæ‰©å±•æ„å»ºæµç¨‹ã€ä¼˜åŒ–è¾“å‡ºèµ„æºæˆ–æ³¨å…¥è‡ªå®šä¹‰è¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯æˆ‘åœ¨ **React + TypeScript** é¡¹ç›®ä¸­å¸¸ç”¨çš„ Webpack æ’ä»¶åŠå…¶ä½œç”¨ï¼Œç»“åˆå…·ä½“åœºæ™¯å’Œä»£ç ç¤ºä¾‹è¯´æ˜ï¼š

---

## ğŸŒŸ **æ ¸å¿ƒæ’ä»¶åˆ†ç±»**
| **ç±»å‹**         | **å…¸å‹æ’ä»¶**                     | **ä½œç”¨**                           |
|------------------|----------------------------------|-----------------------------------|
| **åŸºç¡€åŠŸèƒ½**     | `HtmlWebpackPlugin`             | ç”Ÿæˆ HTML å¹¶è‡ªåŠ¨æ³¨å…¥èµ„æº           |
| **ä»£ç ä¼˜åŒ–**     | `TerserPlugin`                  | å‹ç¼© JS ä»£ç                        |
| **ç¯å¢ƒç®¡ç†**     | `DefinePlugin`                  | æ³¨å…¥å…¨å±€å¸¸é‡                       |
| **æ€§èƒ½æå‡**     | `BundleAnalyzerPlugin`          | åˆ†æåŒ…ä½“ç§¯                         |
| **èµ„æºå¤„ç†**     | `CopyWebpackPlugin`             | å¤åˆ¶é™æ€æ–‡ä»¶åˆ°è¾“å‡ºç›®å½•             |

---

## ğŸ›  **è¯¦ç»†æ’ä»¶è§£æ**
### ğŸ“Œ **1. åŸºç¡€åŠŸèƒ½æ’ä»¶**
#### âœ… **`HtmlWebpackPlugin`**
**ä½œç”¨**ï¼šè‡ªåŠ¨ç”Ÿæˆ `index.html` å¹¶æ³¨å…¥æ‰“åŒ…åçš„ JS/CSS èµ„æºã€‚
**é€‚ç”¨åœºæ™¯**ï¼šSPA æˆ–å¤šé¡µé¢åº”ç”¨çš„ HTML ç®¡ç†ã€‚
```javascript
// webpack.config.js
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  plugins: [
    new HtmlWebpackPlugin({
      template: './public/index.html', // è‡ªå®šä¹‰æ¨¡æ¿
      favicon: './public/favicon.ico', // è‡ªåŠ¨æ·»åŠ  favicon
      minify: true // ç”Ÿäº§ç¯å¢ƒå‹ç¼© HTML
    })
  ]
};
```

---

#### âœ… **`CleanWebpackPlugin`**
**ä½œç”¨**ï¼šåœ¨æ¯æ¬¡æ„å»ºå‰æ¸…ç† `dist` ç›®å½•ï¼Œé¿å…æ—§æ–‡ä»¶æ®‹ç•™ã€‚
**é€‚ç”¨åœºæ™¯**ï¼šç”Ÿäº§ç¯å¢ƒæ„å»ºå‰æ¸…ç†å†å²æ–‡ä»¶ã€‚
```javascript
const { CleanWebpackPlugin } = require('clean-webpack-plugin');

plugins: [
  new CleanWebpackPlugin()
]
```

---

### ğŸ“Œ **2. ä»£ç ä¼˜åŒ–æ’ä»¶**
#### âœ… **`TerserPlugin`**
**ä½œç”¨**ï¼šå‹ç¼© JavaScript ä»£ç ï¼Œç§»é™¤æ³¨é‡Šå’Œ console è¯­å¥ã€‚
**é€‚ç”¨åœºæ™¯**ï¼šç”Ÿäº§ç¯å¢ƒä¼˜åŒ–ä»£ç ä½“ç§¯ã€‚
```javascript
const TerserPlugin = require('terser-webpack-plugin');

module.exports = {
  optimization: {
    minimizer: [
      new TerserPlugin({
        parallel: true, // å¤šçº¿ç¨‹å‹ç¼©
        terserOptions: {
          compress: { drop_console: true } // ç§»é™¤ console
        }
      })
    ]
  }
};
```

---

#### âœ… **`CssMinimizerPlugin`**
**ä½œç”¨**ï¼šå‹ç¼© CSS æ–‡ä»¶ï¼Œé…åˆ `mini-css-extract-plugin` ä½¿ç”¨ã€‚
```javascript
const CssMinimizerPlugin = require('css-minimizer-webpack-plugin');

plugins: [
  new MiniCssExtractPlugin(),
  new CssMinimizerPlugin()
]
```

---

### ğŸ“Œ **3. ç¯å¢ƒç®¡ç†æ’ä»¶**
#### âœ… **`DefinePlugin`**
**ä½œç”¨**ï¼šå®šä¹‰å…¨å±€å¸¸é‡ï¼ˆå¦‚ç¯å¢ƒå˜é‡ï¼‰ï¼Œä»£ç ä¸­ç›´æ¥ä½¿ç”¨ã€‚
**é€‚ç”¨åœºæ™¯**ï¼šåŒºåˆ†å¼€å‘/ç”Ÿäº§ç¯å¢ƒé€»è¾‘ã€‚
```javascript
const webpack = require('webpack');

plugins: [
  new webpack.DefinePlugin({
    'process.env.NODE_ENV': JSON.stringify('production'),
    'API_BASE_URL': JSON.stringify('https://api.example.com')
  })
]
```
**ä»£ç ä¸­ä½¿ç”¨**ï¼š
```typescript
if (process.env.NODE_ENV === 'production') {
  console.log('Running in production mode');
}
```

---

### ğŸ“Œ **4. æ€§èƒ½åˆ†ææ’ä»¶**
#### âœ… **`BundleAnalyzerPlugin`**
**ä½œç”¨**ï¼šå¯è§†åŒ–åˆ†ææ‰“åŒ…ä½“ç§¯ï¼Œä¼˜åŒ–ä¾èµ–å¼•ç”¨ã€‚
**é€‚ç”¨åœºæ™¯**ï¼šæ’æŸ¥å†—ä½™ä¾èµ–æˆ–è¿‡å¤§çš„ç¬¬ä¸‰æ–¹åº“ã€‚
```javascript
const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin;

plugins: [
  new BundleAnalyzerPlugin({
    analyzerMode: 'static', // ç”Ÿæˆ report.html
    openAnalyzer: false    // ä¸è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  })
]
```
![Bundle Analyzer æŠ¥å‘Šç¤ºä¾‹](https://example.com/bundle-report.png)

---

### ğŸ“Œ **5. èµ„æºå¤„ç†æ’ä»¶**
#### âœ… **`CopyWebpackPlugin`**
**ä½œç”¨**ï¼šå¤åˆ¶é™æ€èµ„æºï¼ˆå¦‚ PDFã€å­—ä½“ï¼‰åˆ°è¾“å‡ºç›®å½•ã€‚
**é€‚ç”¨åœºæ™¯**ï¼šæ— éœ€ Webpack å¤„ç†çš„æ–‡ä»¶ç›´æ¥å¤åˆ¶ã€‚
```javascript
const CopyWebpackPlugin = require('copy-webpack-plugin');

plugins: [
  new CopyWebpackPlugin({
    patterns: [
      { from: 'public/assets', to: 'assets' } // å¤åˆ¶æ•´ä¸ªç›®å½•
    ]
  })
]
```

---

#### âœ… **`MiniCssExtractPlugin`**
**ä½œç”¨**ï¼šå°† CSS æå–ä¸ºç‹¬ç«‹æ–‡ä»¶ï¼ˆè€Œé style æ ‡ç­¾ï¼‰ã€‚
**é€‚ç”¨åœºæ™¯**ï¼šç”Ÿäº§ç¯å¢ƒä¼˜åŒ– CSS åŠ è½½ã€‚
```javascript
const MiniCssExtractPlugin = require('mini-css-extract-plugin');

plugins: [
  new MiniCssExtractPlugin({
    filename: 'css/[name].[contenthash:8].css'
  })
],
module: {
  rules: [
    {
      test: /\.css$/,
      use: [MiniCssExtractPlugin.loader, 'css-loader'] // æ›¿æ¢ style-loader
    }
  ]
}
```

---

### ğŸ“Œ **6. é«˜çº§ä¼˜åŒ–æ’ä»¶**
#### âœ… **`DllPlugin` + `DllReferencePlugin`**
**ä½œç”¨**ï¼šé¢„ç¼–è¯‘ä¸å¸¸å˜åŠ¨çš„ä¾èµ–ï¼ˆå¦‚ Reactã€Lodashï¼‰ï¼Œæå‡æ„å»ºé€Ÿåº¦ã€‚
**é€‚ç”¨åœºæ™¯**ï¼šå¤§å‹é¡¹ç›®ä¼˜åŒ–å¼€å‘é˜¶æ®µæ„å»ºã€‚
```javascript
// webpack.vendor.js
const webpack = require('webpack');
module.exports = {
  plugins: [
    new webpack.DllPlugin({
      name: '[name]_dll',
      path: path.join(__dirname, 'vendor-manifest.json')
    })
  ]
};

// ä¸»é…ç½®ä¸­å¼•ç”¨
new webpack.DllReferencePlugin({
  manifest: require('./vendor-manifest.json')
})
```

---

#### âœ… **`CircularDependencyPlugin`**
**ä½œç”¨**ï¼šæ£€æµ‹å¾ªç¯å¼•ç”¨ï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯ã€‚
**é€‚ç”¨åœºæ™¯**ï¼šå¤æ‚é¡¹ç›®ç»´æŠ¤æ¨¡å—å…³ç³»ã€‚
```javascript
const CircularDependencyPlugin = require('circular-dependency-plugin');

plugins: [
  new CircularDependencyPlugin({
    exclude: /node_modules/,
    failOnError: true // å‘ç°å¾ªç¯å¼•ç”¨æ—¶æŠ¥é”™
  })
]
```

---

## ğŸ¯ **æ’ä»¶é€‰å‹å»ºè®®**
1. **å¼€å‘ç¯å¢ƒ**ï¼š
    - `HotModuleReplacementPlugin`ï¼ˆHMR çƒ­æ›´æ–°ï¼‰
    - `ESLintPlugin`ï¼ˆå®æ—¶æ ¡éªŒï¼‰

2. **ç”Ÿäº§ç¯å¢ƒ**ï¼š
    - `CompressionPlugin`ï¼ˆç”Ÿæˆ gzip æ–‡ä»¶ï¼‰
    - `PurgeCSSPlugin`ï¼ˆç§»é™¤æœªä½¿ç”¨çš„ CSSï¼‰

3. **é€šç”¨ä¼˜åŒ–**ï¼š
    - `SplitChunksPlugin`ï¼ˆä»£ç åˆ†å‰²ï¼‰
    - `IgnorePlugin`ï¼ˆå¿½ç•¥æ— ç”¨æ¨¡å—ï¼Œå¦‚ moment.js çš„ localeï¼‰

---

## ğŸ“¦ **å®Œæ•´é…ç½®ç¤ºä¾‹**
```javascript
// webpack.prod.js
const { merge } = require('webpack-merge');
const baseConfig = require('./webpack.base');

module.exports = merge(baseConfig, {
  plugins: [
    new CleanWebpackPlugin(),
    new MiniCssExtractPlugin(),
    new TerserPlugin(),
    new BundleAnalyzerPlugin()
  ]
});
```

é€šè¿‡åˆç†ç»„åˆæ’ä»¶ï¼Œå¯ä»¥å®ç°ï¼š
âœ… **æ„å»ºé€Ÿåº¦æå‡ 50%+**ï¼ˆDLL é¢„ç¼–è¯‘ + å¤šçº¿ç¨‹ï¼‰
âœ… **äº§å‡ºä½“ç§¯å‡å°‘ 30%+**ï¼ˆä»£ç å‹ç¼© + Tree Shakingï¼‰
âœ… **å¼€å‘ä½“éªŒä¼˜åŒ–**ï¼ˆHMR + å®æ—¶é”™è¯¯æ£€æµ‹ï¼‰