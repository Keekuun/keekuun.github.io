## 128. [React] 如何实现转场动画？

在 React 中实现转场动画（Transition Animation）可以通过多种方式，以下是几种常见的实现方法，结合代码示例和最佳实践：

---

## 🌟 方法 1：使用 `react-transition-group`（官方推荐）

`react-transition-group` 是一个轻量级的动画库，专门为 React 设计，支持组件进入和离开时的动画效果。

### 安装
```bash
npm install react-transition-group
```

### 示例代码
```tsx
import React, { useState } from "react";
import { CSSTransition } from "react-transition-group";
import "./styles.css"; // 动画样式

const TransitionDemo = () => {
  const [show, setShow] = useState(false);

  return (
    <div>
      <button onClick={() => setShow(!show)}>
        {show ? "Hide" : "Show"} Element
      </button>

      <CSSTransition
        in={show}
        timeout={300} // 动画持续时间（毫秒）
        classNames="fade" // CSS 类名前缀
        unmountOnExit // 动画结束后卸载组件
      >
        <div className="box">Hello, Animation!</div>
      </CSSTransition>
    </div>
  );
};

export default TransitionDemo;
```

### 配套 CSS（`styles.css`）
```css
.fade-enter {
  opacity: 0;
}
.fade-enter-active {
  opacity: 1;
  transition: opacity 300ms;
}
.fade-exit {
  opacity: 1;
}
.fade-exit-active {
  opacity: 0;
  transition: opacity 300ms;
}
```

---

## 🌟 方法 2：使用 CSS-in-JS（如 `styled-components` 或 `emotion`）

通过动态样式实现动画效果，适合喜欢 CSS-in-JS 的开发者。

### 安装
```bash
npm install styled-components
```

### 示例代码
```tsx
import React, { useState } from "react";
import styled, { css } from "styled-components";

const FadeBox = styled.div<{ show: boolean }>`
  opacity: 0;
  transition: opacity 0.3s ease-in-out;

  ${({ show }) =>
    show &&
    css`
      opacity: 1;
    `}
`;

const TransitionDemo = () => {
  const [show, setShow] = useState(false);

  return (
    <div>
      <button onClick={() => setShow(!show)}>
        {show ? "Hide" : "Show"} Element
      </button>
      <FadeBox show={show}>Hello, Animation!</FadeBox>
    </div>
  );
};

export default TransitionDemo;
```

---

## 🌟 方法 3：使用 `Framer Motion`（高级动画库）

`Framer Motion` 是一个功能强大的动画库，支持复杂的动画效果和手势交互。

### 安装
```bash
npm install framer-motion
```

### 示例代码
```tsx
import React, { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";

const TransitionDemo = () => {
  const [show, setShow] = useState(false);

  return (
    <div>
      <button onClick={() => setShow(!show)}>
        {show ? "Hide" : "Show"} Element
      </button>

      <AnimatePresence>
        {show && (
          <motion.div
            initial={{ opacity: 0, y: -20 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: 20 }}
            transition={{ duration: 0.3 }}
          >
            Hello, Animation!
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
};

export default TransitionDemo;
```

---

## 🌟 方法 4：使用原生 CSS + React 状态

通过动态类名控制动画效果，适合简单的场景。

### 示例代码
```tsx
import React, { useState } from "react";
import "./styles.css";

const TransitionDemo = () => {
  const [show, setShow] = useState(false);

  return (
    <div>
      <button onClick={() => setShow(!show)}>
        {show ? "Hide" : "Show"} Element
      </button>
      <div className={`box ${show ? "fade-in" : "fade-out"}`}>
        Hello, Animation!
      </div>
    </div>
  );
};

export default TransitionDemo;
```

### 配套 CSS（`styles.css`）
```css
.box {
  opacity: 0;
  transition: opacity 0.3s;
}
.fade-in {
  opacity: 1;
}
.fade-out {
  opacity: 0;
}
```

---

## 📌 选择建议

| 方法 | 适用场景 | 优点 | 缺点 |
|------|----------|------|------|
| `react-transition-group` | 组件进入/退出动画 | 轻量级，官方推荐 | 需要额外 CSS |
| CSS-in-JS | 动态样式控制 | 代码内聚，适合组件化 | 学习成本 |
| `Framer Motion` | 复杂动画/交互 | 功能强大，API 友好 | 体积较大 |
| 原生 CSS | 简单动画 | 无依赖 | 扩展性差 |

---

## 🚀 进阶技巧

1. **路由转场动画**
   结合 `react-router` 和 `react-transition-group` 实现页面切换动画：
   ```tsx
   <CSSTransition in={location.key} timeout={300} classNames="page" unmountOnExit>
     <Routes location={location}>
       <Route path="/" element={<Home />} />
     </Routes>
   </CSSTransition>
   ```

2. **列表动画**
   使用 `TransitionGroup` 实现列表项的动画效果：
   ```tsx
   <TransitionGroup>
     {items.map(item => (
       <CSSTransition key={item.id} timeout={300} classNames="item">
         <div>{item.text}</div>
       </CSSTransition>
     ))}
   </TransitionGroup>
   ```

---

## 🧠 常见问题

### ❓ 动画不生效？
- 检查 `in` 属性是否正确绑定到状态。
- 确认 CSS 类名拼写正确（如 `fade-enter-active`）。
- 确保 `unmountOnExit` 或 `AnimatePresence` 已配置。

### ❓ 如何优化性能？
- 避免在动画中使用 `box-shadow` 或 `filter` 等高性能消耗属性。
- 使用 `will-change: opacity;` 提示浏览器优化。

---

如果需要更具体的场景（如路由动画、列表动画），可以告诉我，我会提供更详细的代码示例！ 🎉