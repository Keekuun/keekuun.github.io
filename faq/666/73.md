## 73. documentFragment api æ˜¯ä»€ä¹ˆï¼Œæœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ

`DocumentFragment` æ˜¯ DOM ä¸­çš„ä¸€ä¸ªè½»é‡çº§å®¹å™¨ï¼Œç”¨äº **æ‰¹é‡æ“ä½œ DOM èŠ‚ç‚¹** è€Œä¸ç›´æ¥è§¦å‘é‡æ’ï¼ˆReflowï¼‰æˆ–é‡ç»˜ï¼ˆRepaintï¼‰ã€‚å®ƒå¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦é¢‘ç¹æ“ä½œ DOM çš„åœºæ™¯ä¸­ã€‚

---

## **1. æ ¸å¿ƒæ¦‚å¿µ**
- **æœ¬è´¨**ï¼šæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„æ–‡æ¡£ç‰‡æ®µï¼Œä¸å±äºä¸» DOM æ ‘ã€‚
- **ç‰¹ç‚¹**ï¼š
    - åœ¨å†…å­˜ä¸­æ“ä½œèŠ‚ç‚¹ï¼Œä¸ä¼šè§¦å‘é¡µé¢æ¸²æŸ“ã€‚
    - æ‰¹é‡æ’å…¥æ—¶åªéœ€ä¸€æ¬¡é‡æ’ï¼ˆç›¸æ¯”é€ä¸ªæ’å…¥èŠ‚ç‚¹ï¼‰ã€‚
- **ç”Ÿå‘½å‘¨æœŸ**ï¼šèŠ‚ç‚¹æ’å…¥ä¸» DOM åï¼Œ`DocumentFragment` ä¼šè‡ªåŠ¨æ¸…ç©ºã€‚

---

## **2. åŸºæœ¬ç”¨æ³•**
```typescript
// åˆ›å»º DocumentFragment
const fragment = document.createDocumentFragment();

// æ·»åŠ å¤šä¸ªèŠ‚ç‚¹åˆ° Fragment
for (let i = 0; i < 100; i++) {
  const div = document.createElement('div');
  div.textContent = `Item ${i}`;
  fragment.appendChild(div); // ä¸ä¼šè§¦å‘é‡æ’
}

// ä¸€æ¬¡æ€§æ’å…¥ä¸» DOM
document.getElementById('container')!.appendChild(fragment); // ä»…ä¸€æ¬¡é‡æ’
```

---

## **3. ä½¿ç”¨åœºæ™¯**
### **(1) æ‰¹é‡æ’å…¥å¤§é‡ DOM èŠ‚ç‚¹**
```typescript
// ä½æ•ˆå†™æ³•ï¼šæ¯æ¬¡æ’å…¥éƒ½è§¦å‘é‡æ’
for (let i = 0; i < 1000; i++) {
  document.body.appendChild(createElement()); // 1000 æ¬¡é‡æ’ï¼
}

// é«˜æ•ˆå†™æ³•ï¼šé€šè¿‡ DocumentFragment
const fragment = document.createDocumentFragment();
for (let i = 0; i < 1000; i++) {
  fragment.appendChild(createElement());
}
document.body.appendChild(fragment); // ä»… 1 æ¬¡é‡æ’
```

### **(2) åŠ¨æ€æ¸²æŸ“åˆ—è¡¨**
```typescript
function renderList(items: string[]) {
  const fragment = document.createDocumentFragment();
  items.forEach(item => {
    const li = document.createElement('li');
    li.textContent = item;
    fragment.appendChild(li);
  });
  document.getElementById('list')!.appendChild(fragment);
}
```

### **(3) å…‹éš†æˆ–ç§»åŠ¨ DOM å­æ ‘**
```typescript
const sourceElement = document.getElementById('source')!;
const fragment = document.createDocumentFragment();

// ç§»åŠ¨å­æ ‘åˆ° Fragment
while (sourceElement.firstChild) {
  fragment.appendChild(sourceElement.firstChild);
}

// æ’å…¥åˆ°æ–°ä½ç½®
document.getElementById('target')!.appendChild(fragment);
```

### **(4) æ¨¡æ¿æ¸²æŸ“ï¼ˆé…åˆ `<template>` æ ‡ç­¾ï¼‰**
```html
<template id="tpl">
  <div class="item">Template Content</div>
</template>

<script>
  const template = document.getElementById('tpl')!;
  const fragment = template.content.cloneNode(true); // å…‹éš†æ¨¡æ¿å†…å®¹
  document.body.appendChild(fragment);
</script>
```

---

## **4. æ€§èƒ½å¯¹æ¯”**
| **æ“ä½œæ–¹å¼**          | **é‡æ’æ¬¡æ•°** | **é€‚ç”¨åœºæ™¯**               |
|-----------------------|-------------|---------------------------|
| ç›´æ¥æ’å…¥ DOM          | N æ¬¡        | å°‘é‡èŠ‚ç‚¹æ“ä½œ               |
| `DocumentFragment`    | 1 æ¬¡        | æ‰¹é‡èŠ‚ç‚¹æ“ä½œï¼ˆæ¨èï¼‰        |

---

## **5. æ³¨æ„äº‹é¡¹**
1. **å†…å­˜ç®¡ç†**ï¼š`DocumentFragment` åœ¨æ’å…¥ä¸» DOM åä¼šæ¸…ç©ºï¼Œæ— éœ€æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ã€‚
2. **äº‹ä»¶å§”æ‰˜**ï¼šç”±äº Fragment ä¸åœ¨ DOM æ ‘ä¸­ï¼Œéœ€åœ¨ä¸» DOM ä¸Šç›‘å¬äº‹ä»¶ï¼ˆæˆ–æ’å…¥åå†ç»‘å®šï¼‰ã€‚
3. **å…¼å®¹æ€§**ï¼šæ‰€æœ‰ç°ä»£æµè§ˆå™¨å‡æ”¯æŒï¼ŒåŒ…æ‹¬ IE 9+ã€‚

---

## **6. ä¸å…¶ä»–æŠ€æœ¯çš„ç»“åˆ**
### **(1) é…åˆ `requestAnimationFrame`**
```typescript
const fragment = document.createDocumentFragment();
// åœ¨åŠ¨ç”»å¸§ä¸­æ‰¹é‡æ“ä½œ
requestAnimationFrame(() => {
  document.body.appendChild(fragment);
});
```

### **(2) è™šæ‹Ÿ DOM çš„åº•å±‚å®ç°**
- ç±»ä¼¼ React/Vue çš„è™šæ‹Ÿ DOM æœºåˆ¶ï¼Œå…ˆåœ¨å†…å­˜ä¸­æ„å»ºèŠ‚ç‚¹æ ‘ï¼Œå†ä¸€æ¬¡æ€§æ›´æ–°åˆ°çœŸå® DOMã€‚

---

## **7. æ€»ç»“**
- **ä¼˜åŠ¿**ï¼šå‡å°‘é‡æ’æ¬¡æ•°ï¼Œæå‡æ€§èƒ½ï¼Œå°¤å…¶é€‚åˆåŠ¨æ€æ¸²æŸ“ã€åˆ—è¡¨æ›´æ–°ç­‰åœºæ™¯ã€‚
- **åŸåˆ™**ï¼š**â€œå…ˆç»„è£…ï¼Œå†æ’å…¥â€**ï¼Œé¿å…é¢‘ç¹æ“ä½œä¸» DOM æ ‘ã€‚
- **ç±»æ¯”**ï¼šå¯ä»¥å°†å…¶è§†ä¸º DOM æ“ä½œçš„â€œç¼“å†²åŒºâ€ã€‚

åˆç†ä½¿ç”¨ `DocumentFragment`ï¼Œèƒ½è®©ä½ çš„åº”ç”¨æ›´æµç•…ï¼ ğŸš€