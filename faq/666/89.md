## 89. 如何从 0 到 1 搭建前端基建

从 0 到 1 搭建前端基建是一个系统性工程，需要从技术选型、工程化、规范制定、性能优化等多个维度进行设计。以下是完整的步骤和关键点：

---

## **1. 明确基建目标**
在开始之前，明确基建的核心目标：
- **提效**：减少重复劳动，提升开发体验。
- **规范**：统一代码风格、协作流程。
- **质量**：保障代码健壮性和性能。
- **可扩展**：支持未来业务和技术迭代。

---

## **2. 技术选型**
### **(1) 前端框架**
- **React**：生态丰富，适合复杂应用。
- **Vue**：上手简单，适合快速迭代。
- **Svelte**：高性能，适合轻量级项目。

### **(2) 构建工具**
- **Webpack**：生态成熟，适合复杂场景。
- **Vite**：开发体验极佳，适合现代项目。
- **Rollup**：适合库开发。

### **(3) 语言**
- **TypeScript**：强类型，减少运行时错误。
- **JavaScript**：快速原型开发。

### **(4) CSS 方案**
- **Tailwind CSS**：原子化，快速开发。
- **CSS Modules**：组件级作用域。
- **Sass/Less**：预处理增强。

---

## **3. 工程化配置**
### **(1) 初始化项目**
```bash
# 使用脚手架（如 Create React App、Vite）
npx create-react-app my-app --template typescript
# 或
npm init vite@latest my-app --template react-ts
```

### **(2) 目录结构规范**
```markdown
src/
├── assets/          # 静态资源
├── components/      # 公共组件
├── pages/           # 页面
├── utils/           # 工具函数
├── styles/          # 全局样式
├── store/           # 状态管理
├── router/          # 路由配置
├── api/             # 接口封装
└── types/           # TypeScript 类型定义
```

### **(3) 代码规范**
- **ESLint**：代码质量检查。
  ```bash
  npm install eslint --save-dev
  npx eslint --init
  ```
- **Prettier**：代码格式化。
  ```bash
  npm install prettier eslint-config-prettier --save-dev
  ```
- **Husky + lint-staged**：Git 提交时自动检查。
  ```bash
  npm install husky lint-staged --save-dev
  ```

### **(4) 构建优化**
- **分包策略**：通过 `SplitChunksPlugin` 拆分公共代码。
  ```javascript
  // webpack.config.js
  optimization: {
    splitChunks: {
      chunks: 'all',
    },
  },
  ```
- **Tree Shaking**：移除未引用代码（需配合 ES Module）。
- **缓存**：利用 `[contenthash]` 优化文件名。

---

## **4. 基础能力封装**
### **(1) 请求库封装（Axios）**
```typescript
// src/api/request.ts
import axios from 'axios';

const instance = axios.create({
  baseURL: 'https://api.example.com',
  timeout: 10000,
});

// 请求拦截
instance.interceptors.request.use((config) => {
  config.headers.Authorization = 'Bearer token';
  return config;
});

// 响应拦截
instance.interceptors.response.use(
  (response) => response.data,
  (error) => Promise.reject(error),
);

export default instance;
```

### **(2) 路由管理（React Router）**
```typescript
// src/router/index.tsx
import { createBrowserRouter } from 'react-router-dom';
import Home from '../pages/Home';
import About from '../pages/About';

const router = createBrowserRouter([
  { path: '/', element: <Home /> },
  { path: '/about', element: <About /> },
]);

export default router;
```

### **(3) 状态管理（Redux/Zustand）**
```typescript
// src/store/counterStore.ts (Zustand 示例)
import { create } from 'zustand';

interface CounterState {
  count: number;
  increment: () => void;
  decrement: () => void;
}

const useCounterStore = create<CounterState>((set) => ({
  count: 0,
  increment: () => set((state) => ({ count: state.count + 1 })),
  decrement: () => set((state) => ({ count: state.count - 1 })),
}));

export default useCounterStore;
```

---

## **5. 开发环境增强**
### **(1) Mock 数据**
- **Mock.js**：拦截 Ajax 请求。
  ```bash
  npm install mockjs --save-dev
  ```
- **MSW (Mock Service Worker)**：更真实的 API Mock。
  ```bash
  npm install msw --save-dev
  ```

### **(2) 本地代理**
通过 Webpack 或 Vite 配置代理，解决跨域问题：
```javascript
// vite.config.ts
export default defineConfig({
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true,
      },
    },
  },
});
```

---

## **6. 质量保障**
### **(1) 单元测试**
- **Jest**：测试框架。
  ```bash
  npm install jest @types/jest ts-jest --save-dev
  ```
- **React Testing Library**：组件测试。
  ```bash
  npm install @testing-library/react @testing-library/jest-dom --save-dev
  ```

### **(2) CI/CD**
- **GitHub Actions**：自动化构建和部署。
  ```yaml
  # .github/workflows/deploy.yml
  name: Deploy
  on: [push]
  jobs:
    build:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v3
        - run: npm install
        - run: npm run build
        - run: npm run deploy
  ```

---

## **7. 性能优化**
### **(1) 代码分割**
- 动态导入组件：
  ```typescript
  const LazyComponent = React.lazy(() => import('./LazyComponent'));
  ```
- 路由懒加载：
  ```typescript
  const Home = React.lazy(() => import('../pages/Home'));
  ```

### **(2) 静态资源优化**
- **CDN 加速**：托管静态资源。
- **图片压缩**：使用 `sharp` 或 `imagemin`。

---

## **8. 监控与日志**
### **(1) 错误监控**
- **Sentry**：捕获前端错误。
  ```bash
  npm install @sentry/react @sentry/tracing --save
  ```

### **(2) 性能监控**
- **Lighthouse**：自动化性能评分。
- **Web Vitals**：核心指标监控。

---

## **9. 文档与协作**
- **Storybook**：组件文档化。
  ```bash
  npx storybook init
  ```
- **Git 规范**：约定提交格式（如 Angular Commit Message）。

---

## **10. 持续迭代**
- **技术雷达**：定期评估新技术（如 Rust 替代 Webpack）。
- **团队培训**：分享会、Code Review。

---

## **总结**
| **阶段**       | **关键任务**                                                                 |
|----------------|-----------------------------------------------------------------------------|
| **技术选型**   | 框架、构建工具、语言、CSS 方案。                                             |
| **工程化**     | 目录规范、代码检查、构建优化。                                               |
| **基础能力**   | 请求库、路由、状态管理。                                                     |
| **开发体验**   | Mock 数据、本地代理、热更新。                                                |
| **质量保障**   | 单元测试、CI/CD、错误监控。                                                  |
| **性能优化**   | 代码分割、CDN、懒加载。                                                      |
| **文档协作**   | Storybook、Git 规范。                                                       |

通过以上步骤，你可以系统化地搭建一个高效、健壮的前端基建！ 🚀