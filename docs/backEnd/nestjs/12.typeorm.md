---
title: nestjs TypeORM å®è·µ
date: 2025-4-21
categories:
  - åç«¯
  - nestjs
tags:
  - nestjs
  - node
  - TypeORM
  - æ•°æ®åº“
---

## `createQueryBuilder` vs `findOneBy`
`createQueryBuilder` å’Œ `findOneBy` éƒ½æ˜¯ `TypeORM` ä¸­ç”¨äºæŸ¥è¯¢æ•°æ®çš„æ–¹æ³•ï¼Œä½†å®ƒä»¬çš„ä½¿ç”¨åœºæ™¯å’Œæ¨èç¨‹åº¦æœ‰æ‰€ä¸åŒã€‚

`createQueryBuilder` ç›¸æ¯” `findOneBy` æœ‰ä¸€äº›**ç‹¬ç‰¹çš„ä¼˜åŠ¿å’Œé€‚ç”¨åœºæ™¯**ï¼Œè™½ç„¶åœ¨ç®€å•æŸ¥è¯¢æ—¶æ¨èä½¿ç”¨ `findOneBy`ï¼Œä½†åœ¨ä¸€äº›å¤æ‚åœºæ™¯ä¸­ï¼Œ`createQueryBuilder` æ˜¯ä¸å¯æ›¿ä»£çš„ã€‚

---

### âœ… `createQueryBuilder` çš„ä¼˜åŠ¿

| ä¼˜åŠ¿ | æè¿° |
|------|------|
| ğŸ” **æ”¯æŒå¤æ‚æŸ¥è¯¢æ¡ä»¶** | å¯ä»¥æ„å»ºå¤šæ¡ä»¶ã€æ¨¡ç³ŠåŒ¹é…ã€èŒƒå›´æŸ¥è¯¢ç­‰å¤æ‚é€»è¾‘ï¼Œä¾‹å¦‚ï¼š`where("user.name LIKE :name", { name: '%Tom%' })` |
| ğŸ§© **æ”¯æŒ JOIN æ“ä½œï¼ˆå…³è”è¡¨æŸ¥è¯¢ï¼‰** | èƒ½å¤Ÿè½»æ¾åœ°è¿›è¡Œè·¨è¡¨è”æŸ¥ï¼Œå¦‚ `leftJoinAndSelect('article.author', 'author')` |
| ğŸ“ˆ **åˆ†é¡µæŸ¥è¯¢æ”¯æŒ** | å¯é…åˆ `.skip()` å’Œ `.take()` å®ç°åˆ†é¡µåŠŸèƒ½ |
| âš™ï¸ **åŠ¨æ€æŸ¥è¯¢æ„é€ ** | å¯æ ¹æ®ä¸šåŠ¡é€»è¾‘åŠ¨æ€æ·»åŠ æŸ¥è¯¢æ¡ä»¶ï¼Œéå¸¸é€‚åˆå¤æ‚çš„ä¸šåŠ¡åœºæ™¯ |
| ğŸ”„ **å­æŸ¥è¯¢æ”¯æŒ** | æ”¯æŒåµŒå¥—å­æŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼š`.where(qb => qb.where('id IN ' + qb.subQuery().select(...)))` |
| ğŸ§ª **å¯è°ƒè¯•æ€§æ›´å¼º** | æŸ¥è¯¢è¯­å¥å¯ä»¥æ‰“å°å‡ºæ¥ï¼Œä¾¿äºè°ƒè¯•ï¼Œä¾‹å¦‚ï¼š`.getSql()` æˆ– `.printSql()` |

---

### ğŸ§  ç¤ºä¾‹å¯¹æ¯”

#### 1. ä½¿ç”¨ `findOneBy`ï¼ˆç®€å•æŸ¥è¯¢ï¼‰
<script src="https://gist.github.com/Keekuun/2904c0c989f0f4653a759860e94ea63b.js"></script>

```ts
const article = await this.articleRepository.findOneBy({ id });
```

#### 2. ä½¿ç”¨ `createQueryBuilder`ï¼ˆå¤æ‚æŸ¥è¯¢ï¼‰
<script src="https://gist.github.com/Keekuun/b1407489424433be974fbfe7ef712aa9.js"></script>

##### å¤šæ¡ä»¶æŸ¥è¯¢
```ts
const article = await this.articleRepository.createQueryBuilder('article')
  .where('article.title = :title', { title: 'TypeORM å…¥é—¨' })
  .andWhere('article.author = :author', { author: 'å¼ ä¸‰' })
  .getOne();
```


##### å…³è”æŸ¥è¯¢
```ts
const article = await this.articleRepository.createQueryBuilder('article')
  .leftJoinAndSelect('article.author', 'author')
  .where('article.id = :id', { id })
  .getOne();
```


##### åˆ†é¡µæŸ¥è¯¢
```ts
const [articles, count] = await this.articleRepository.createQueryBuilder('article')
  .skip(10)
  .take(20)
  .getManyAndCount();
```

### âœ… æ€»ç»“

| åœºæ™¯ | æ¨èæ–¹æ³• |
|------|----------|
| ç®€å•å­—æ®µæŸ¥è¯¢ï¼ˆå¦‚ `id`, `email` ç­‰ï¼‰ | âœ… `findOneBy({id})` |
| å¤šæ¡ä»¶ã€JOINã€åˆ†é¡µã€å­æŸ¥è¯¢ç­‰å¤æ‚æŸ¥è¯¢ | âœ… `createQueryBuilder()` |
