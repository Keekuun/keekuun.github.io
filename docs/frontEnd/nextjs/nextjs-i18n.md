---
title: Next.js 国际化（i18n）的最佳实践
sidebar: auto
date: 2025-06-20
categories: 
- Next.js
- 前端
tags: 
- Next.js
- i18n
---

在 Next.js 中实现国际化，核心要解决三个问题：

1.  **路由 (Routing)**：如何通过 URL 来区分不同的语言？（例如 `example.com/en/about` vs `example.com/fr/about`）
2.  **内容翻译 (Translation Management)**：如何管理和加载不同语言的文案？
3.  **渲染 (Rendering)**：如何在服务端组件（RSC）和客户端组件中高效地获取并渲染翻译内容？

我们将围绕 Next.js **App Router** (版本 13.4+ 的推荐方式) 展开，并使用目前社区中最推荐的库 `next-intl` 来实现。

---

### 最佳实践总结

| 方面 | 推荐方案 | 为什么？ |
| :--- | :--- | :--- |
| **核心库** | **`next-intl`** | 专为 Next.js App Router 设计，深度集成，完美支持服务端组件，类型安全，提供完整的路由和翻译解决方案。 |
| **路由策略** | **子路径路由 (Sub-path Routing)** | 例如 `/en/products`、`/zh/products`。这是对 SEO 最友好的方式，清晰地将不同语言版本区分为独立页面，便于搜索引擎索引。 |
| **翻译文件** | **JSON 格式** | 简单、通用、易于编辑，也方便与各种翻译管理平台（如 Crowdin, Lokalise）集成。 |
| **翻译加载** | **按需加载** | `next-intl` 默认支持。每个页面只加载其需要的翻译内容，避免一次性加载所有语言包，提升性能。 |
| **组件渲染** | **优先在服务端组件中获取翻译** | 利用 `getTranslations` 在服务端完成翻译，减少发送到客户端的 JavaScript，提升首屏加载速度。 |

---

### 实战演练：使用 `next-intl` 构建多语言应用

下面，我们将一步步构建一个支持中英文切换的 Next.js 应用。

#### 第 1 步：项目初始化与安装依赖

首先，确保你有一个使用 App Router 的 Next.js 项目。

```bash
# 安装 next-intl
npm install next-intl
```

#### 第 2 步：配置翻译文件

我们需要为每种支持的语言创建翻译文件。

1.  在项目根目录创建 `messages` 文件夹。
2.  创建 `en.json` (英文) 和 `zh.json` (中文) 文件。

**`messages/en.json`**
```json
{
  "HomePage": {
    "title": "Welcome to Next.js!",
    "description": "This is a demo for internationalization."
  },
  "Navigation": {
    "home": "Home",
    "about": "About"
  }
}
```

**`messages/zh.json`**
```json
{
  "HomePage": {
    "title": "欢迎来到 Next.js!",
    "description": "这是一个国际化多语言示例。"
  },
  "Navigation": {
    "home": "首页",
    "about": "关于"
  }
}
```

#### 第 3 步：配置 `next-intl`

这是最关键的一步，它将连接路由、中间件和翻译文件。

1.  在项目根目录创建一个 `i18n.ts` 文件。

**`i18n.ts`**
```typescript
import { getRequestConfig } from 'next-intl/server';

export default getRequestConfig(async ({ locale }) => ({
  // 动态加载对应语言的翻译文件
  // 注意：我们使用了动态导入 `()` => import() 来实现按需加载
  messages: (await import(`./messages/${locale}.json`)).default
}));
```

2.  创建中间件来处理路由和语言检测。

**`middleware.ts`**
```typescript
import createMiddleware from 'next-intl/middleware';

export default createMiddleware({
  // 支持的语言列表
  locales: ['en', 'zh'],

  // 默认语言
  defaultLocale: 'en'
});

export const config = {
  // 匹配所有不包含特定前缀的路径
  // 例如：/about, /products, 但不包括 /_next, /api, /favicon.ico
  matcher: ['/((?!api|_next/static|_next/image|favicon.ico).*)']
};
```
这个中间件会自动处理 URL，比如用户访问 `/about`，如果默认语言是 `en`，它会自动重定向到 `/en/about`。

#### 第 4 步：更新目录结构和根布局

`next-intl` 的路由策略要求我们将所有页面都放在一个动态路由 `[locale]` 下。

1.  **重命名 `app` 目录下的文件夹**：将 `app` 下的所有页面和 `layout.ts` 文件移动到 `app/[locale]/` 目录下。
    *   `app/layout.tsx` -> `app/[locale]/layout.tsx`
    *   `app/page.tsx` -> `app/[locale]/page.tsx`
    *   `app/about/page.tsx` -> `app/[locale]/about/page.tsx`

2.  **更新根布局 `app/[locale]/layout.tsx`**：

```typescript
import type { Metadata } from 'next';
import { NextIntlClientProvider, useMessages } from 'next-intl';

export const metadata: Metadata = {
  title: 'Next.js i18n Demo',
  description: 'Generated by create next app',
};

// 定义 props 类型，其中 locale 是由 Next.js 动态路由自动注入的
interface RootLayoutProps {
  children: React.ReactNode;
  params: {
    locale: string;
  };
}

export default function RootLayout({
  children,
  params: { locale }
}: RootLayoutProps) {
  // 获取当前 locale 的所有 messages
  const messages = useMessages();

  return (
    <html lang={locale}>
      <body>
        {/* 
          为了让客户端组件也能访问翻译，需要使用 NextIntlClientProvider。
          它会将 messages 和 locale 等信息通过 React Context 传递下去。
        */}
        <NextIntlClientProvider locale={locale} messages={messages}>
          {children}
        </NextIntlClientProvider>
      </body>
    </html>
  );
}
```

#### 第 5 步：在组件中使用翻译

现在，我们可以在服务端和客户端组件中优雅地使用翻译了。

**在服务端组件 (Server Component) 中使用 - 推荐！**

这是性能最高的方式，因为翻译在服务器上完成，不会增加客户端的负担。

**`app/[locale]/page.tsx`**
```typescript
import { useTranslations } from 'next-intl';

export default function HomePage() {
  // useTranslations 的参数对应 JSON 文件中的一级 key
  const t = useTranslations('HomePage');

  return (
    <main style={{ padding: '2rem' }}>
      <h1>{t('title')}</h1>
      <p>{t('description')}</p>
    </main>
  );
}
```
> **注意**：`next-intl@3` 版本之后，`useTranslations` 可以在服务端组件中直接使用，非常方便！

**在客户端组件 (Client Component) 中使用**

如果组件需要交互（例如 `onClick` 事件），则必须是客户端组件。

1.  创建一个导航组件：`components/Navigation.tsx`

**`components/Navigation.tsx`**
```typescript
'use client'; // 声明为客户端组件

import { useTranslations } from 'next-intl';
import Link from 'next/link';

export default function Navigation() {
  const t = useTranslations('Navigation');

  return (
    <nav style={{ display: 'flex', gap: '1rem', padding: '1rem 2rem', borderBottom: '1px solid #ccc' }}>
      <Link href="/">{t('home')}</Link>
      <Link href="/about">{t('about')}</Link>
    </nav>
  );
}
```

2.  在布局文件中使用这个导航组件。

**`app/[locale]/layout.tsx`** (部分代码)
```typescript
// ... imports
import Navigation from '@/components/Navigation'; // 假设你的路径别名配置好了

export default function RootLayout({
  children,
  params: { locale }
}: RootLayoutProps) {
  // ...
  return (
    <html lang={locale}>
      <body>
        <NextIntlClientProvider locale={locale} messages={messages}>
          <Navigation /> {/* 在这里添加导航栏 */}
          {children}
        </NextIntlClientProvider>
      </body>
    </html>
  );
}
```

#### 第 6 步：创建语言切换器

一个完整的 i18n 方案必须包含语言切换功能。

1.  创建一个语言切换组件 `components/LocaleSwitcher.tsx`。

**`components/LocaleSwitcher.tsx`**
```typescript
'use client';

import { useLocale } from 'next-intl';
import { useRouter, usePathname } from 'next-intl/client';
import { useTransition } from 'react';

export default function LocaleSwitcher() {
  const [isPending, startTransition] = useTransition();
  const router = useRouter();
  const pathname = usePathname();
  const locale = useLocale();

  const onSelectChange = (e: React.ChangeEvent<HTMLSelectElement>) => {
    const nextLocale = e.target.value;
    startTransition(() => {
      router.replace(pathname, { locale: nextLocale });
    });
  };

  return (
    <select
      defaultValue={locale}
      onChange={onSelectChange}
      disabled={isPending}
      style={{ padding: '0.5rem', border: '1px solid #ccc', borderRadius: '4px' }}
    >
      <option value="en">English</option>
      <option value="zh">中文</option>
    </select>
  );
}
```

2.  将它添加到你的布局或导航栏中。

**`components/Navigation.tsx`** (更新后)
```typescript
'use client';

import { useTranslations } from 'next-intl';
import Link from 'next/link';
import LocaleSwitcher from './LocaleSwitcher';

export default function Navigation() {
  const t = useTranslations('Navigation');

  return (
    <nav style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '1rem 2rem', borderBottom: '1px solid #ccc' }}>
      <div>
        <Link href="/" style={{ marginRight: '1rem' }}>{t('home')}</Link>
        <Link href="/about">{t('about')}</Link>
      </div>
      <LocaleSwitcher />
    </nav>
  );
}
```

### 总结与 SEO 优化

至此，你已经拥有了一个功能完善、遵循最佳实践的 Next.js 多语言应用。

最后，别忘了对 SEO 进行优化。搜索引擎需要知道你的页面有多个语言版本。可以通过在根布局中添加 `alternates` metadata 来实现。

**`app/[locale]/layout.tsx`** (添加 SEO 优化)
```typescript
import { getTranslations } from 'next-intl/server';

// ...

// 动态生成 metadata
export async function generateMetadata({ params: { locale } }: { params: { locale: string } }) {
  const t = await getTranslations({ locale, namespace: 'HomePage' });

  return {
    title: t('title'),
    description: t('description'),
    // 告诉搜索引擎此页面的其他语言版本
    alternates: {
      canonical: '/', // 可以根据实际路径动态生成
      languages: {
        'en-US': '/en',
        'zh-CN': '/zh',
      },
    },
  };
}

// ... rest of the layout component
```

> https://next-intl.dev/
