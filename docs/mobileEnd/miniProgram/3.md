---
title: å¾®ä¿¡å°ç¨‹åºåŸºç¡€
date: 2022-02-10
sidebar: auto
isComment: true
categories:
- ç§»åŠ¨ç«¯
tags:
- å°ç¨‹åº
---

# [ç›®å½•ç»“æ„](https://developers.weixin.qq.com/miniprogram/dev/framework/structure.html)
å°ç¨‹åºåŒ…å«ä¸€ä¸ªæè¿°æ•´ä½“ç¨‹åºçš„ app å’Œå¤šä¸ªæè¿°å„è‡ªé¡µé¢çš„ pageã€‚

```
project
|â€”pages
|   |â€”index
|   |   |â€”index.json        index é¡µé¢é…ç½®
|   |   |â€”index.js          index é¡µé¢é€»è¾‘
|   |   |â€”index.wxml        index é¡µé¢ç»“æ„ï¼ˆhtmlï¼‰ 
|   |   |â€”index.wxss        index é¡µé¢æ ·å¼
|   |__log
|   |   |â€”log.json           log é¡µé¢é…ç½®
|   |   |â€”log.js             log é¡µé¢é€»è¾‘
|   |   |â€”log.wxml           log é¡µé¢ç»“æ„ï¼ˆhtmlï¼‰ 
|   |   |â€”log.wxss           log é¡µé¢æ ·å¼
|â€”app.js                     å°ç¨‹åºé€»è¾‘ä»£ç 
|â€”app.json                   å°ç¨‹åºå…¨å±€é…ç½®
|â€”app.wxss                   å°ç¨‹åºå…¬å…±æ ·å¼è¡¨
```
> æ³¨æ„ï¼šä¸ºäº†æ–¹ä¾¿å¼€å‘è€…å‡å°‘é…ç½®é¡¹ï¼Œæè¿°é¡µé¢çš„å››ä¸ªæ–‡ä»¶å¿…é¡»å…·æœ‰ç›¸åŒçš„è·¯å¾„ä¸æ–‡ä»¶åã€‚

# å…¨å±€é…ç½®[ğŸ‘‰](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html)
å°ç¨‹åºæ ¹ç›®å½•ä¸‹çš„ `app.json` æ–‡ä»¶ç”¨æ¥å¯¹å¾®ä¿¡å°ç¨‹åºè¿›è¡Œå…¨å±€é…ç½®ã€‚æ–‡ä»¶å†…å®¹ä¸ºä¸€ä¸ª JSON å¯¹è±¡ã€‚å…·ä½“é…ç½®å‚è€ƒå®˜ç½‘[ğŸ‘‰](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html)

``````json
{
  // åŸºç¡€é¡µé¢é…ç½®
  "pages": [
    "pages/farm/index",
    "pages/comp/index",
    "pages/api/index",
    "pages/other/index"
  ],
  // åˆ†åŒ…é¡µé¢é…ç½®
  "subpackages": [
    {
      "root": "comp",
      "pages": [
        "scroll-view/index"
      ]
    }
  ],
  // é¡µé¢é…ç½®è§„åˆ™
  "preloadRule": {
    "pages/farm/index": {
      "network": "all",
      "packages": [
        "farm"
      ]
    }
  },
  // é»˜è®¤å¯åŠ¨è·¯å¾„
  "entryPagePath": "pages/farm/index",
  // å…¨å±€é»˜è®¤çª—å£è¡¨ç°ï¼ˆå¯ä»¥è¢«é¡µé¢è¡¨ç°è¦†ç›–ï¼‰
  "window": {
    "backgroundTextStyle": "light",
    "navigationBarBackgroundColor": "#f1f1f1",
    "navigationBarTitleText": "é‡‘è¿…æ•™è‚² Â· å¾®ä¿¡å°ç¨‹åº",
    "navigationBarTextStyle": "black"
  },
  // åº•éƒ¨å¯¼èˆªæ ç›®é…ç½®
  "tabBar": {
		"color": "#000",
		"selectedColor": "#0050FF",
		"list": [
			{
				"iconPath": "/static/tabbar-icons/store.png",
				"selectedIconPath": "/static/tabbar-icons/store_s.png",
				"text": "æ¡†æ¶",
				"pagePath": "pages/farm/index"
      },
      {
				"iconPath": "/static/tabbar-icons/home.png",
				"selectedIconPath": "/static/tabbar-icons/home_s.png",
				"text": "ç»„ä»¶",
				"pagePath": "pages/comp/index"
			},
			{
				"iconPath": "/static/tabbar-icons/sns.png",
				"selectedIconPath": "/static/tabbar-icons/sns_s.png",
				"text": "API",
				"pagePath": "pages/api/index"
			},
			{
				"iconPath": "/static/tabbar-icons/user.png",
				"selectedIconPath": "/static/tabbar-icons/user_s.png",
				"text": "å…¶ä»–",
				"pagePath": "pages/other/index"
			}
		]
	},
  // å°ç¨‹åºæ¥å£æƒé™é…ç½®
  "permission": {
    "scope.userLocation": {
      "desc": "ä½ çš„ä½ç½®ä¿¡æ¯å°†ç”¨äºå°ç¨‹åºä½ç½®æ¥å£çš„æ•ˆæœå±•ç¤º"
    }
  },
  // weui ç»„ä»¶åº“ç›¸å…³é…ç½®
  "style": "v2",
  "useExtendedLib": {
    "weui": true
  },
  // ç½‘ç»œè¶…æ—¶æ—¶é—´é…ç½®
  "networkTimeout": {
    "request": 10000,
    "downloadFile": 10000
  },
  // æ˜¯å¦å¼€å¯è°ƒè¯•æ¨¡å¼
  "debug": true,
  // æŒ‡æ˜ sitemap é…ç½®æ–‡ä»¶ä½ç½®
  "sitemapLocation": "sitemap.json"
}
``````

# é¡µé¢é…ç½®[ğŸ‘‰](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/page.html)
`app.json` ä¸­çš„éƒ¨åˆ†é…ç½®ï¼Œä¹Ÿæ”¯æŒå¯¹å•ä¸ªé¡µé¢è¿›è¡Œé…ç½®ï¼Œå¯ä»¥åœ¨é¡µé¢å¯¹åº”çš„` .json` æ–‡ä»¶æ¥å¯¹æœ¬é¡µé¢çš„è¡¨ç°è¿›è¡Œé…ç½®ã€‚[ğŸ‘‰](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/page.html)

é¡µé¢ä¸­é…ç½®é¡¹åœ¨å½“å‰é¡µé¢ä¼šè¦†ç›– `app.json` ä¸­ç›¸åŒçš„é…ç½®é¡¹ï¼ˆæ ·å¼ç›¸å…³çš„é…ç½®é¡¹å±äº` app.json` ä¸­çš„ `window` å±æ€§ï¼Œä½†è¿™é‡Œä¸éœ€è¦é¢å¤–æŒ‡å®š `window` å­—æ®µï¼‰ï¼Œå…·ä½“çš„å–å€¼å’Œå«ä¹‰å¯å‚è€ƒ[å…¨å±€é…ç½®æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html)ä¸­è¯´æ˜ã€‚

**é…ç½®ç¤ºä¾‹:**
```json
{
  "navigationBarBackgroundColor": "#ffffff",
  "navigationBarTextStyle": "black",
  "navigationBarTitleText": "å¾®ä¿¡æ¥å£åŠŸèƒ½æ¼”ç¤º",
  "backgroundColor": "#eeeeee",
  "backgroundTextStyle": "light"
}
```
> æ³¨ï¼šå¹¶ä¸æ˜¯æ‰€æœ‰ `app.json` ä¸­çš„é…ç½®éƒ½å¯ä»¥åœ¨é¡µé¢è¦†ç›–æˆ–å•ç‹¬æŒ‡å®šï¼Œä»…é™äºæœ¬æ–‡æ¡£åŒ…å«çš„é€‰é¡¹ã€‚
> æ³¨ï¼šiOS/Android å®¢æˆ·ç«¯ 7.0.0 ä»¥ä¸‹ç‰ˆæœ¬ï¼Œ`navigationStyle` åªåœ¨ `app.json` ä¸­ç”Ÿæ•ˆã€‚

# sitemap é…ç½®[ğŸ‘‰](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/sitemap.html)
å°ç¨‹åºæ ¹ç›®å½•ä¸‹çš„ `sitemap.json` æ–‡ä»¶ç”¨äºé…ç½®å°ç¨‹åºåŠå…¶é¡µé¢æ˜¯å¦å…è®¸è¢«å¾®ä¿¡ç´¢å¼•ï¼Œæ–‡ä»¶å†…å®¹ä¸ºä¸€ä¸ª JSON å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰` sitemap.json `ï¼Œåˆ™é»˜è®¤ä¸ºæ‰€æœ‰é¡µé¢éƒ½å…è®¸è¢«ç´¢å¼•ã€‚
```json
{
  "rules":[{
    "action": "allow",  // å‘½ä¸­è¯¥è§„åˆ™çš„é¡µé¢æ˜¯å¦èƒ½è¢«ç´¢å¼•
    "page": "path/to/page", // * è¡¨ç¤ºæ‰€æœ‰é¡µé¢ï¼Œä¸èƒ½ä½œä¸ºé€šé…ç¬¦ä½¿ç”¨
    "params": ["a", "b"],
    "matching": "exact"
  }, {
    "action": "disallow",
    "page": "path/to/page"
  }]
}
```

# æ¡†æ¶æ¥å£[ğŸ‘‰](https://developers.weixin.qq.com/miniprogram/dev/reference/api/App.html)
## 1.å°ç¨‹åºApp&ç”Ÿå‘½å‘¨æœŸå‡½æ•°
+ `App({})`æ³¨å†Œå°ç¨‹åºã€‚æ¥å—ä¸€ä¸ª Object å‚æ•°ï¼Œå…¶æŒ‡å®šå°ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸå›è°ƒç­‰ã€‚
  `App()` å¿…é¡»åœ¨ `app.js` ä¸­è°ƒç”¨ï¼Œå¿…é¡»è°ƒç”¨ä¸”åªèƒ½è°ƒç”¨ä¸€æ¬¡ã€‚ä¸ç„¶ä¼šå‡ºç°æ— æ³•é¢„æœŸçš„åæœã€‚
```ts
// app.ts
App<IAppOption>({
  globalData: {msg: 'Hello weixin mini program!'},
  onLaunch(options) {
    console.log('onLaunch', options);
    
    // å±•ç¤ºæœ¬åœ°å­˜å‚¨èƒ½åŠ›
    const logs = wx.getStorageSync('logs') || []
    logs.unshift(Date.now())
    wx.setStorageSync('logs', logs)

    // ç™»å½•
    wx.login({
      success: res => {
        console.log(res.code)
        // å‘é€ res.code åˆ°åå°æ¢å– openId, sessionKey, unionId
      },
    })
  },
  onShow(options) {
    console.log('onShow', options.path); 
  },
  onHide() {
    console.log('onHide');
  },
  onError(err) {
    console.log('onError', err);
  },
  onPageNotFound(options) {
    console.log('onPageNotFound', options);
    wx.redirectTo({url: '/'})
  },
  onUnhandledRejection(options) {
    console.log('onPageNotFound', options);
  },
  onThemeChange(options) {
    console.log('onThemeChange', options);
  }
})
```
**ç”Ÿå‘½å‘¨æœŸå‡½æ•°**

+ `onLaunch(Object object)`
  å°ç¨‹åºåˆå§‹åŒ–å®Œæˆæ—¶è§¦å‘ï¼Œå…¨å±€åªè§¦å‘ä¸€æ¬¡ã€‚å‚æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨ `wx.getLaunchOptionsSync` è·å–ã€‚

å‚æ•°ï¼šä¸ [wx.getLaunchOptionsSync](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/life-cycle/wx.getLaunchOptionsSync.html) ä¸€è‡´

+ `onShow(Object object)`
  å°ç¨‹åºå¯åŠ¨ï¼Œæˆ–ä»åå°è¿›å…¥å‰å°æ˜¾ç¤ºæ—¶è§¦å‘ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨` wx.onAppShow` ç»‘å®šç›‘å¬ã€‚

å‚æ•°ï¼šä¸ [wx.onAppShow](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onAppShow.html) ä¸€è‡´

+ `onHide()`
  å°ç¨‹åºä»å‰å°è¿›å…¥åå°æ—¶è§¦å‘ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ `wx.onAppHide` ç»‘å®šç›‘å¬ã€‚

+ `onError(String error)`
  å°ç¨‹åºå‘ç”Ÿè„šæœ¬é”™è¯¯æˆ– API è°ƒç”¨æŠ¥é”™æ—¶è§¦å‘ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ `wx.onError` ç»‘å®šç›‘å¬ã€‚

å‚æ•°ï¼šä¸ [wx.onError](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onError.html) ä¸€è‡´

+ `onPageNotFound(Object object)`
  åŸºç¡€åº“ 1.9.90 å¼€å§‹æ”¯æŒï¼Œä½ç‰ˆæœ¬éœ€åšå…¼å®¹å¤„ç†ã€‚

å°ç¨‹åºè¦æ‰“å¼€çš„é¡µé¢ä¸å­˜åœ¨æ—¶è§¦å‘ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ `wx.onPageNotFound`ç»‘å®šç›‘å¬ã€‚æ³¨æ„äº‹é¡¹è¯·å‚è€ƒ `wx.onPageNotFound`ã€‚

å‚æ•°ï¼šä¸ [wx.onPageNotFound](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onPageNotFound.html) ä¸€è‡´

ç¤ºä¾‹ä»£ç ï¼š

```js
App({
  onPageNotFound(res) {
    wx.redirectTo({
      url: 'pages/...'
    }) // å¦‚æœæ˜¯ tabbar é¡µé¢ï¼Œè¯·ä½¿ç”¨ wx.switchTab
  }
})
```
+` onUnhandledRejection(Object object)`
åŸºç¡€åº“ 2.10.0 å¼€å§‹æ”¯æŒï¼Œä½ç‰ˆæœ¬éœ€åšå…¼å®¹å¤„ç†ã€‚

å°ç¨‹åºæœ‰æœªå¤„ç†çš„ `Promise` æ‹’ç»æ—¶è§¦å‘ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ `wx.onUnhandledRejection` ç»‘å®šç›‘å¬ã€‚æ³¨æ„äº‹é¡¹è¯·å‚è€ƒ `wx.onUnhandledRejection`ã€‚

å‚æ•°ï¼šä¸ [wx.onUnhandledRejection](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onUnhandledRejection.html) ä¸€è‡´

+ `onThemeChange(Object object)`
  åŸºç¡€åº“ 2.11.0 å¼€å§‹æ”¯æŒï¼Œä½ç‰ˆæœ¬éœ€åšå…¼å®¹å¤„ç†ã€‚

ç³»ç»Ÿåˆ‡æ¢ä¸»é¢˜æ—¶è§¦å‘ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ `wx.onThemeChange` ç»‘å®šç›‘å¬ã€‚

å‚æ•°ï¼šä¸ [wx.onThemeChange](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onThemeChange.html) ä¸€è‡´

# æ•°æ®ç»‘å®š[ğŸ‘‰](https://developers.weixin.qq.com/miniprogram/dev/reference/wxml/data.html)
æ¡†æ¶çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªå“åº”çš„æ•°æ®ç»‘å®šç³»ç»Ÿï¼Œå¯ä»¥è®©æ•°æ®ä¸è§†å›¾éå¸¸ç®€å•åœ°ä¿æŒåŒæ­¥ã€‚å½“åšæ•°æ®ä¿®æ”¹çš„æ—¶å€™ï¼Œåªéœ€è¦åœ¨é€»è¾‘å±‚ä¿®æ”¹æ•°æ®ï¼Œè§†å›¾å±‚å°±ä¼šåšç›¸åº”çš„æ›´æ–°ã€‚

è§†å›¾å±‚`demo.wxml`:
```html
<view>Hello {{name}}</view>
<button bindtap="changeName">click me</button>
```

é€»è¾‘å±‚`demo.js`:
```js
// data
const helloData = {
    name: 'weixin',
}

// Register a page
Page({
    data: helloData,
    changeName() {
        this.setData({name: 'world'})
    },
```

## 1.ç®€å•ç»‘å®š
```html
<view> {{ message }} </view>
```
```js
Page({
    data: {
        message: 'hello world'
    }
})
```
## 2.ç»„ä»¶å±æ€§(éœ€è¦åœ¨åŒå¼•å·ä¹‹å†…)
```html
<view id="item-{{id}}"></view>    
```
## 3.æ§åˆ¶å±æ€§(éœ€è¦åœ¨åŒå¼•å·ä¹‹å†…` wx:if`)
```html
<view wx:if="visible"></view>
```
## 4.å…³é”®å­—(éœ€è¦åœ¨åŒå¼•å·ä¹‹å†…)
```html
<checkbox checked="{{true}}"></checkbox>
```
## 5.è¿ç®—
```html
<!-- ä¸‰å…ƒè¿ç®—ç¬¦ -->
<view hidden="{{flag ? true : false}}"></view>
<!-- ç®—æœ¯è¿ç®— -->
<view>{{ 1+ 2}}{{a + b}}</view>
<!-- é€»è¾‘åˆ¤æ–­ -->
<view wx:if="{{length > 0}}"></view>
<!-- å­—ç¬¦ä¸²è¿ç®— -->
<view>{{"hello" + name}}</view>
<!-- å±æ€§å–å€¼ -->
<view>{{object.key}} {{array[0]}}</view>
```
## 6.ç»„åˆ
ä¹Ÿå¯ä»¥åœ¨ Mustache å†…ç›´æ¥è¿›è¡Œç»„åˆï¼Œæ„æˆæ–°çš„å¯¹è±¡æˆ–è€…æ•°ç»„ã€‚
```html
<view wx:for="{{[zero, 1, 2, 3, 4]}}"> {{item}} </view>

<view wx:for="{{[1,2,3]}} ">
  {{item}}
</view>

<template is="objectCombine" data="{{for: a, bar: b}}"></template>
```
```js
Page({
    data: {
        zero: 0,
        a: 1,
        b: 2
    }
})
```
