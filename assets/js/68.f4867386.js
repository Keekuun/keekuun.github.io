(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{609:function(s,t,a){s.exports=a.p+"assets/img/node-module.a951a53d.png"},838:function(s,t,a){"use strict";a.r(t);var e=a(2),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"nodejs之module模块学习笔记"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nodejs之module模块学习笔记"}},[s._v("🌙")]),s._v(" NodeJS之module模块学习笔记")]),s._v(" "),t("p",[t("img",{attrs:{src:a(609),alt:"module"}})]),s._v(" "),t("h2",{attrs:{id:"_1-module模块简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-module模块简介"}},[s._v("🌙")]),s._v(" 1.module模块简介")]),s._v(" "),t("p",[s._v("在NodeJS中，每个文件都被视为一个独立的模块。NodeJS默认支持"),t("code",[s._v("common.js")]),s._v("规范。")]),s._v(" "),t("blockquote",[t("p",[t("a",{attrs:{href:"https://juejin.im/post/5dfef166518825126131ce0f#heading-0",target:"_blank",rel:"noopener noreferrer"}},[s._v("JavaScript模块化规范（CommonJs AMD CMD UMD ES6）"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://juejin.im/entry/5ac83dff5188255c4c1084fd",target:"_blank",rel:"noopener noreferrer"}},[s._v("结合源码分析 Node.js 模块加载与运行原理"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"_2-访问主模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-访问主模块"}},[s._v("🌙")]),s._v(" 2.访问主模块")]),s._v(" "),t("p",[s._v("当 Node.js 直接运行一个文件时， "),t("code",[s._v("require.main")]),s._v(" 会被设为它的 "),t("code",[s._v("module")]),s._v("。 这意味着可以通过 "),t("code",[s._v("require.main === module")]),s._v(" 来判断一个文件是否被直接运行：")]),s._v(" "),t("p",[s._v("对于 "),t("code",[s._v("foo.js")]),s._v(" 文件，如果通过 "),t("code",[s._v("node foo.js")]),s._v(" 运行则为 "),t("code",[s._v("true")]),s._v("，但如果通过 "),t("code",[s._v("require('./foo')")]),s._v(" 运行则为 "),t("code",[s._v("false")]),s._v("。")]),s._v(" "),t("p",[s._v("因为 "),t("code",[s._v("module")]),s._v(" 提供了一个 "),t("code",[s._v("filename")]),s._v(" 属性（通常等同于 "),t("code",[s._v("__filename")]),s._v("），所以可以通过检查 "),t("code",[s._v("require.main.filename")]),s._v(" 来获取当前应用程序的入口点。")]),s._v(" "),t("h2",{attrs:{id:"_3-缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-缓存"}},[s._v("🌙")]),s._v(" 3.缓存")]),s._v(" "),t("p",[s._v("模块是基于其解析的文件名进行缓存的。 由于调用模块的位置的不同，模块可能被解析成不同的文件名（比如从 "),t("code",[s._v("node_modules")]),s._v(" 目录加载），这样就不能保证 "),t("code",[s._v("require('foo')")]),s._v(" 总能返回完全相同的对象。")]),s._v(" "),t("p",[s._v("此外，在不区分大小写的文件系统或操作系统中，被解析成不同的文件名可以指向同一文件，但缓存仍然会将它们视为不同的模块，并多次重新加载。 例如， "),t("code",[s._v("require('./foo')")]),s._v(" 和 "),t("code",[s._v("require('./FOO')")]),s._v(" 返回两个不同的对象，而不会管 "),t("code",[s._v("./foo")]),s._v(" 和 "),t("code",[s._v("./FOO")]),s._v(" 是否是相同的文件。")]),s._v(" "),t("h2",{attrs:{id:"_4-核心模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-核心模块"}},[s._v("🌙")]),s._v(" 4.核心模块")]),s._v(" "),t("p",[t("code",[s._v("require()")]),s._v(" 总是会优先加载核心模块(核心模块定义在 Node.js 源代码的 "),t("code",[s._v("lib/")]),s._v(" 目录下)。 例如， "),t("code",[s._v("require('http')")]),s._v(" 始终返回内置的 HTTP 模块，即使有同名文件。")]),s._v(" "),t("h2",{attrs:{id:"_5-循环加载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-循环加载"}},[s._v("🌙")]),s._v(" 5.循环加载")]),s._v(" "),t("p",[s._v("当循环调用 "),t("code",[s._v("require()")]),s._v(" 时，一个模块可能在未完成执行时被返回。")]),s._v(" "),t("p",[s._v("例如以下情况:")]),s._v(" "),t("p",[t("code",[s._v("a.js")]),s._v(":")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a 开始'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nexports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("done "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./b.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'在 a 中，b.done = %j'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("done"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nexports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("done "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a 结束'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("code",[s._v("b.js")]),s._v(":")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'b 开始'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nexports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("done "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./a.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'在 b 中，a.done = %j'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("done"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nexports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("done "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'b 结束'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("code",[s._v("main.js")]),s._v(":")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'main 开始'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./a.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./b.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'在 main 中，a.done=%j，b.done=%j'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("done"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("done"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("当 "),t("code",[s._v("main.js")]),s._v(" 加载 "),t("code",[s._v("a.js")]),s._v(" 时， "),t("code",[s._v("a.js")]),s._v(" 又加载 "),t("code",[s._v("b.js")]),s._v("。 此时， "),t("code",[s._v("b.js")]),s._v(" 会尝试去加载 "),t("code",[s._v("a.js")]),s._v("。 为了防止无限的循环，会返回一个 "),t("code",[s._v("a.js")]),s._v(" 的 "),t("code",[s._v("exports")]),s._v(" 对象的 "),t("strong",[s._v("未完成的副本")]),s._v(" 给 "),t("code",[s._v("b.js")]),s._v(" 模块。 然后 "),t("code",[s._v("b.js")]),s._v(" 完成加载，并将 "),t("code",[s._v("exports")]),s._v(" 对象提供给 "),t("code",[s._v("a.js")]),s._v(" 模块。")]),s._v(" "),t("p",[s._v("当 "),t("code",[s._v("main.js")]),s._v(" 加载这两个模块时，它们都已经完成加载。 因此，该程序的输出会是：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" main.js\nmain 开始\na 开始\nb 开始\n在 b 中，a.done "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\nb 结束\n在 a 中，b.done "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\na 结束\n在 main 中，a.done"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true，b.done"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("需要仔细的规划, 以允许循环模块依赖在应用程序内正常工作.")]),s._v(" "),t("h2",{attrs:{id:"_6-文件模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-文件模块"}},[s._v("🌙")]),s._v(" 6.文件模块")]),s._v(" "),t("p",[s._v("如果按确切的文件名没有找到模块，则 Node.js 会尝试带上 "),t("code",[s._v(".js")]),s._v("、 "),t("code",[s._v(".json")]),s._v(" 或 "),t("code",[s._v(".node")]),s._v(" 拓展名再加载。")]),s._v(" "),t("p",[t("code",[s._v(".js")]),s._v(" 文件会被解析为 JavaScript 文本文件， "),t("code",[s._v(".json")]),s._v(" 文件会被解析为 JSON 文本文件。 "),t("code",[s._v(".node")]),s._v(" 文件会被解析为通过 "),t("code",[s._v("process.dlopen()")]),s._v(" 加载的编译后的插件模块。")]),s._v(" "),t("p",[s._v("以 "),t("code",[s._v("'/'")]),s._v(" 为前缀的模块是文件的绝对路径。 例如， "),t("code",[s._v("require('/home/marco/foo.js')")]),s._v(" 会加载 "),t("code",[s._v("/home/marco/foo.js")]),s._v(" 文件。")]),s._v(" "),t("p",[s._v("以 "),t("code",[s._v("'./'")]),s._v(" 为前缀的模块是相对于调用 "),t("code",[s._v("require()")]),s._v(" 的文件的。 也就是说， "),t("code",[s._v("circle.js")]),s._v(" 必须和 "),t("code",[s._v("foo.js")]),s._v(" 在同一目录下以便于 "),t("code",[s._v("require('./circle')")]),s._v(" 找到它。")]),s._v(" "),t("p",[s._v("当没有以 "),t("code",[s._v("'/'")]),s._v("、 "),t("code",[s._v("'./'")]),s._v(" 或 "),t("code",[s._v("'../'")]),s._v(" 开头来表示文件时，这个模块必须是一个核心模块或加载自 "),t("code",[s._v("node_modules")]),s._v(" 目录。")]),s._v(" "),t("p",[s._v("如果给定的路径不存在，则 "),t("code",[s._v("require()")]),s._v(" 会抛出一个 "),t("code",[s._v("code")]),s._v(" 属性为 "),t("code",[s._v("'MODULE_NOT_FOUND'")]),s._v(" 的 "),t("a",{attrs:{href:"http://nodejs.cn/s/FLTm19",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("Error")]),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("h2",{attrs:{id:"_7-从-node-modules-目录加载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-从-node-modules-目录加载"}},[s._v("🌙")]),s._v(" 7.从 node_modules 目录加载")]),s._v(" "),t("p",[s._v("如果传递给 "),t("code",[s._v("require()")]),s._v(" 的模块标识符不是一个"),t("a",{attrs:{href:"http://nodejs.cn/api/modules.html#modules_core_modules",target:"_blank",rel:"noopener noreferrer"}},[s._v("核心模块"),t("OutboundLink")],1),s._v("，也没有以 "),t("code",[s._v("'/'")]),s._v(" 、 "),t("code",[s._v("'../'")]),s._v(" 或 "),t("code",[s._v("'./'")]),s._v(" 开头，则 Node.js 会从当前模块的父目录开始，尝试从它的 "),t("code",[s._v("/node_modules")]),s._v(" 目录里加载模块。 Node.js 不会附加 "),t("code",[s._v("node_modules")]),s._v(" 到一个已经以 "),t("code",[s._v("node_modules")]),s._v(" 结尾的路径上。")]),s._v(" "),t("p",[s._v("如果还是没有找到，则移动到再上一层父目录，直到文件系统的根目录。")]),s._v(" "),t("p",[s._v("例子，如果在 "),t("code",[s._v("'/home/ry/projects/foo.js'")]),s._v(" 文件里调用了 "),t("code",[s._v("require('bar.js')")]),s._v("，则 Node.js 会按以下顺序查找：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("/home/ry/projects/node_modules/bar.js")])]),s._v(" "),t("li",[t("code",[s._v("/home/ry/node_modules/bar.js")])]),s._v(" "),t("li",[t("code",[s._v("/home/node_modules/bar.js")])]),s._v(" "),t("li",[t("code",[s._v("/node_modules/bar.js")])])]),s._v(" "),t("p",[s._v("这使得程序本地化它们的依赖，避免它们产生冲突。")]),s._v(" "),t("p",[s._v("通过在模块名后包含一个路径后缀，可以请求特定的文件或分布式的子模块。 例如， "),t("code",[s._v("require('example-module/path/to/file')")]),s._v(" 会把 "),t("code",[s._v("path/to/file")]),s._v(" 解析成相对于 "),t("code",[s._v("example-module")]),s._v(" 的位置。 后缀路径同样遵循模块的解析语法。")]),s._v(" "),t("h2",{attrs:{id:"_8-模块封装器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-模块封装器"}},[s._v("🌙")]),s._v(" 8.模块封装器")]),s._v(" "),t("p",[s._v("在执行模块代码之前，Node.js 会使用一个如下的匿名函数封装器将其封装：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("exports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" require"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __filename"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __dirname")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 模块的代码实际上在这里")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("通过这样做，Node.js 实现了以下几点：")]),s._v(" "),t("ul",[t("li",[s._v("它保持了顶层的变量（用 "),t("code",[s._v("var")]),s._v("、 "),t("code",[s._v("const")]),s._v(" 或 "),t("code",[s._v("let")]),s._v(" 定义）作用在模块范围内，而不是全局对象。")]),s._v(" "),t("li",[s._v("它有助于提供一些看似全局的但实际上是模块特定的变量，例如：\n"),t("ul",[t("li",[s._v("实现者可以用于从模块中导出值的 "),t("code",[s._v("module")]),s._v(" 和 "),t("code",[s._v("exports")]),s._v(" 对象。")]),s._v(" "),t("li",[s._v("包含模块绝对文件名和目录路径的快捷变量 "),t("code",[s._v("__filename")]),s._v(" 和 "),t("code",[s._v("__dirname")]),s._v(" 。")])])])]),s._v(" "),t("h2",{attrs:{id:"_9-模块作用域"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-模块作用域"}},[s._v("🌙")]),s._v(" 9.模块作用域")]),s._v(" "),t("h3",{attrs:{id:"_9-1-dirname和-filename当前模块的目录名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-dirname和-filename当前模块的目录名"}},[s._v("🌙")]),s._v(" 9.1 "),t("code",[s._v("__dirname")]),s._v("和"),t("code",[s._v("__filename")]),s._v("当前模块的目录名")]),s._v(" "),t("p",[s._v("与 "),t("a",{attrs:{href:"http://nodejs.cn/s/RH6qCV",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("__filename")]),t("OutboundLink")],1),s._v(" 的 "),t("a",{attrs:{href:"http://nodejs.cn/s/7t4KCq",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("path.dirname()")]),t("OutboundLink")],1),s._v(" 相同。")]),s._v(" "),t("p",[s._v("示例，从 "),t("code",[s._v("/Users/mjr")]),s._v(" 运行 "),t("code",[s._v("node example.js")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__dirname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 打印: /Users/mjr")]),s._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dirname")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__filename"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 打印: /Users/mjr")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"_9-2-exports-快捷方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-exports-快捷方式"}},[s._v("🌙")]),s._v(" 9.2 exports 快捷方式")]),s._v(" "),t("p",[t("code",[s._v("exports")]),s._v(" 变量是在模块的文件级作用域内可用的，且在"),t("strong",[s._v("模块执行之前")]),s._v("赋值给 "),t("code",[s._v("module.exports")]),s._v("。")]),s._v(" "),t("p",[s._v("它允许使用快捷方式，因此 "),t("code",[s._v("module.exports.f = ...")]),s._v(" 可以更简洁地写成 "),t("code",[s._v("exports.f = ...")]),s._v("。 但是，就像任何变量一样，如果为 "),t("code",[s._v("exports")]),s._v(" 赋予了新值，则它将不再绑定到 "),t("code",[s._v("module.exports")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hello "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 从模块的引用中导出。")]),s._v("\nexports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("hello")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 不导出，仅在模块中可用。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("当 "),t("code",[s._v("module.exports")]),s._v(" 属性被新对象完全替换时，通常也会重新赋值 "),t("code",[s._v("exports")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("exports")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Constructor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ... ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("为了说明这种行为，想象对 "),t("code",[s._v("require()")]),s._v(" 的假设实现，它与 "),t("code",[s._v("require()")]),s._v(" 的实际实现非常类似：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* ... */")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" module "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("exports")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" exports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 模块代码在这。在这个例子中，定义了一个函数。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("someFunc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" someFunc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 此时，exports 不再是一个 module.exports 的快捷方式，")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 且这个模块依然导出一个空的默认对象。")]),s._v("\n    module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" someFunc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 此时，该模块导出 someFunc，而不是默认对象。")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("h3",{attrs:{id:"_9-3-module对象"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-3-module对象"}},[s._v("🌙")]),s._v(" 9.3 "),t("code",[s._v("module")]),s._v("对象")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("module.children")]),s._v("：module[]  被该模块引用的模块对象。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("module.exports")]),s._v(": object"),t("code",[s._v("module.exports")]),s._v(" 对象由 "),t("code",[s._v("Module")]),s._v(" 系统创建。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("module.filename")]),s._v(": string模块的完全解析后的文件名。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("module.id")]),s._v(": string模块的标识符。 通常是完全解析后的文件名。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("module.loaded")]),s._v("：boolean模块是否已经加载完成，或正在加载中。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("module.parent")]),s._v(": moduls最先引用该模块的模块。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("module.paths")]),s._v(": string[]模块的搜索路径。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("module.require(id)")]),s._v(": id string, 返回: "),t("a",{attrs:{href:"http://nodejs.cn/s/6sTGdS",target:"_blank",rel:"noopener noreferrer"}},[s._v("any"),t("OutboundLink")],1),s._v(" 导出的模块内容。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("module.require()")]),s._v(" 方法提供了一种加载模块的方法，就像从原始模块调用 "),t("code",[s._v("require()")]),s._v(" 一样。")]),s._v(" "),t("p",[s._v("为了做到这个，需要获得一个 "),t("code",[s._v("module")]),s._v(" 对象的引用。 因为 "),t("code",[s._v("require()")]),s._v(" 会返回 "),t("code",[s._v("module.exports")]),s._v("，且 "),t("code",[s._v("module")]),s._v(" 通常只在一个特定的模块代码中有效，所以为了使用它，必须显式地导出。")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);