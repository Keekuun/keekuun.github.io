(window.webpackJsonp=window.webpackJsonp||[]).push([[314],{1032:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"github-actions-自动打包并发布你的应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#github-actions-自动打包并发布你的应用"}},[s._v("🌙")]),s._v(" GitHub Actions 自动打包并发布你的应用")]),s._v(" "),t("p",[s._v("在日常开发中，当我们完成一个版本的功能后，最繁琐、也最容易出错的环节莫过于手动打包、命名、上传和发布。这个过程不仅耗时，还充满了重复性劳动。我们可以利用 GitHub Actions 实现"),t("strong",[s._v("自动化发布")]),s._v("：每当你推送一个版本标签（如 "),t("code",[s._v("v1.0.0")]),s._v("），系统就会自动为你构建应用、打包产物，并创建一个带附件的 GitHub Release。")]),s._v(" "),t("p",[s._v("我们将通过两个真实的案例来学习：")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("一个 Node.js (Next.js) Web 应用")]),s._v("：使用高效的 "),t("code",[s._v("pnpm")]),s._v(" 包管理器。")]),s._v(" "),t("li",[t("strong",[s._v("一个 Flutter 移动应用")]),s._v("：构建并签名一个 Android APK。")])]),s._v(" "),t("h3",{attrs:{id:"一、核心概念-github-actions-是如何工作的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、核心概念-github-actions-是如何工作的"}},[s._v("🌙")]),s._v(" 一、核心概念：GitHub Actions 是如何工作的？")]),s._v(" "),t("p",[s._v("在我们开始编写代码之前，先理解几个关键概念：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("Workflow (工作流)")]),s._v("：自动化过程的定义文件，存放在 "),t("code",[s._v(".github/workflows/")]),s._v(" 目录下，使用 YAML 格式编写。")]),s._v(" "),t("li",[t("strong",[s._v("Event (事件)")]),s._v("：触发工作流的特定活动，比如 "),t("code",[s._v("push")]),s._v(" 代码、"),t("code",[s._v("pull_request")]),s._v("，或者我们这次要用的 "),t("code",[s._v("push")]),s._v(" 一个标签。")]),s._v(" "),t("li",[t("strong",[s._v("Job (任务)")]),s._v("：工作流由一个或多个任务组成，每个任务都在一个独立的运行器（Runner）虚拟机上执行。")]),s._v(" "),t("li",[t("strong",[s._v("Step (步骤)")]),s._v("：任务中的最小执行单元，可以是一个 shell 命令或一个可复用的"),t("strong",[s._v("Action")]),s._v("。")]),s._v(" "),t("li",[t("strong",[s._v("Action (动作)")]),s._v("：一个预先打包好的脚本，用于执行复杂或重复的操作，例如 "),t("code",[s._v("actions/checkout")]),s._v(" (检出代码) 或 "),t("code",[s._v("pnpm/action-setup")]),s._v(" (安装 pnpm)。")])]),s._v(" "),t("p",[s._v("我们的目标流程非常清晰：\n"),t("strong",[s._v("当 "),t("code",[s._v("v*")]),s._v(" 格式的标签被推送到仓库时 -> 启动一个任务 -> 检出代码 -> 设置环境 -> 安装依赖 -> 构建 -> 打包 -> 创建 Release 并上传包。")])]),s._v(" "),t("h3",{attrs:{id:"二、实战案例-1-自动化发布-node-js-应用-pnpm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、实战案例-1-自动化发布-node-js-应用-pnpm"}},[s._v("🌙")]),s._v(" 二、实战案例 1：自动化发布 Node.js 应用 (pnpm)")]),s._v(" "),t("p",[s._v("对于前端或 Node.js 项目，我们的目标是运行构建命令（如 "),t("code",[s._v("pnpm build")]),s._v("），然后将构建产物（如 "),t("code",[s._v(".next")]),s._v(" 或 "),t("code",[s._v("dist")]),s._v(" 目录）打包成 "),t("code",[s._v(".zip")]),s._v(" 和 "),t("code",[s._v(".tar.gz")]),s._v(" 文件上传。")]),s._v(" "),t("blockquote",[t("p",[t("a",{attrs:{href:"https://github.com/Keekuun/nextjs-dashboard/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("查看github nextjs demo release"),t("OutboundLink")],1)])]),s._v(" "),t("h4",{attrs:{id:"最终工作流文件-github-workflows-release-nodejs-yml"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最终工作流文件-github-workflows-release-nodejs-yml"}},[s._v("🌙")]),s._v(" 最终工作流文件 ("),t("code",[s._v(".github/workflows/release-nodejs.yml")]),s._v(")")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Build and Release Node.js App (pnpm)\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("on")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("push")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'v*'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 仅在推送 v 开头的标签时触发")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关键点：授权工作流写入内容，用于创建 Release")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://github.com/softprops/action-gh-release")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("permissions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("contents")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" write\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jobs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build-and-release")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Build and Release\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runs-on")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ubuntu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("latest "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用最新的 Ubuntu 运行器")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("steps")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 检出代码")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Checkout repository\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uses")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" actions/checkout@v4\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 安装 pnpm - 这是 pnpm 项目的关键一步")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Setup pnpm\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uses")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pnpm/action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("setup@v4\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("with")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意 如果 package.json 中存在 ")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 锁定主版本以保证稳定性")]),s._v("\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 设置 Node.js 环境，并启用 pnpm 缓存")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Setup Node.js\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uses")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" actions/setup"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node@v4\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("with")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node-version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'20'")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cache")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pnpm'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# <-- 关键！让 setup-node 知道要缓存 pnpm 的全局存储")]),s._v("\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4. 安装依赖 (使用 --frozen-lockfile 保证可复现性)")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Install dependencies\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pnpm install "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("frozen"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("lockfile\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5. 构建项目")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Build application\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pnpm run build\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 6. 打包产物 (为不同系统提供不同格式)")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Create release package (TAR.GZ)\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 .next 目录打包，并以版本号命名")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tar "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("czvf web"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" github.ref_name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".tar.gz .next\n\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Create release package (ZIP)\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" zip "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("r web"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" github.ref_name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".zip .next\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 7. 创建 GitHub Release 并上传所有包")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Create GitHub Release\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uses")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" softprops/action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("release@v2\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("with")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上传所有 .tar.gz 和 .zip 文件")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("files")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v("\n            *.tar.gz\n            *.zip")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br")])]),t("h4",{attrs:{id:"关键点解析-运维视角"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关键点解析-运维视角"}},[s._v("🌙")]),s._v(" 关键点解析 (运维视角)")]),s._v(" "),t("ul",[t("li",[t("strong",[t("code",[s._v("cache: 'pnpm'")])]),s._v(": 这是 "),t("code",[s._v("pnpm")]),s._v(" 工作流的性能核心。它告诉 GitHub Actions 去缓存 "),t("code",[s._v("pnpm")]),s._v(" 的全局内容寻址存储区，而不是项目本地的 "),t("code",[s._v("node_modules")]),s._v("。这使得依赖缓存的命中率极高，能大幅缩短安装时间。")]),s._v(" "),t("li",[t("code",[s._v("pnpm install --frozen-lockfile")]),s._v("：等同于 "),t("code",[s._v("npm ci")]),s._v("，它强制根据 "),t("code",[s._v("pnpm-lock.yaml")]),s._v(" 文件安装，确保了 CI 环境与本地开发环境的依赖完全一致，是"),t("strong",[s._v("可复现构建")]),s._v("的基石。")])]),s._v(" "),t("hr"),s._v(" "),t("h3",{attrs:{id:"三、实战案例-2-自动化发布-flutter-应用-android-apk"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三、实战案例-2-自动化发布-flutter-应用-android-apk"}},[s._v("🌙")]),s._v(" 三、实战案例 2：自动化发布 Flutter 应用 (Android APK)")]),s._v(" "),t("p",[s._v("对于移动应用，挑战升级了：我们不仅要构建，还需要"),t("strong",[s._v("安全地处理签名密钥")]),s._v("来生成一个可发布的 release 版本 APK。")]),s._v(" "),t("h4",{attrs:{id:"最终工作流文件-github-workflows-release-flutter-yml"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最终工作流文件-github-workflows-release-flutter-yml"}},[s._v("🌙")]),s._v(" 最终工作流文件 ("),t("code",[s._v(".github/workflows/release-flutter.yml")]),s._v(")")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Build & Release Flutter APK\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("on")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("push")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'v*'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("permissions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("contents")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" write\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jobs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build-and-release-android")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Build & Release Android APK\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runs-on")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ubuntu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("latest\n\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("steps")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 检出代码")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Checkout repository\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uses")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" actions/checkout@v4\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 设置 Flutter 环境 (推荐使用 .flutter-version 文件来锁定版本)")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Setup Flutter\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uses")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" subosito/flutter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("action@v2\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("with")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cache")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用 Flutter SDK 缓存")]),s._v("\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 解码并配置签名密钥 - 这是最关键的一步！")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Decode and setup Keystore\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" secrets.KEYSTORE_BASE64 "),t("span",{pre:!0,attrs:{class:"token tag"}},[s._v("!=")]),s._v(" '' "),t("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" secrets.KEY_PROPERTIES "),t("span",{pre:!0,attrs:{class:"token tag"}},[s._v("!=")]),s._v(" '' "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v('\n          echo "Setting up keystore for signing..."\n          echo "${{ secrets.KEYSTORE_BASE64 }}" | base64 --decode > android/app/upload-keystore.jks\n          echo "${{ secrets.KEY_PROPERTIES }}" > android/key.properties\n          echo "Keystore setup complete."')]),s._v("\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4. 安装依赖")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Install dependencies\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flutter pub get\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5. 构建 release 版本的 APK")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Build release APK\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flutter build apk "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("release\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 6. 重命名 APK，使其包含版本标签，便于识别")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Rename APK file\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mv build/app/outputs/flutter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("apk/app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("release.apk build/app/outputs/flutter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("apk/app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" github.ref_name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".apk\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 7. 创建 GitHub Release 并上传 APK")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Create GitHub Release and Upload APK\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uses")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" softprops/action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("release@v2\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("with")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("files")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build/app/outputs/flutter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("apk/app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" github.ref_name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".apk\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br")])]),t("h4",{attrs:{id:"关键点解析-运维视角-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关键点解析-运维视角-2"}},[s._v("🌙")]),s._v(" 关键点解析 (运维视角)")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("Secrets 管理")]),s._v(": 签名密钥是高度敏感的信息，绝不能硬编码在代码里。我们使用 "),t("strong",[s._v("GitHub Repository Secrets")]),s._v(" 来安全地存储它们 ("),t("code",[s._v("KEYSTORE_BASE64")]),s._v(" 和 "),t("code",[s._v("KEY_PROPERTIES")]),s._v(")。")]),s._v(" "),t("li",[t("strong",[s._v("在运行器中重建密钥文件")]),s._v(": "),t("code",[s._v("secrets")]),s._v(" 只是安全的变量存储。在 CI 运行时，我们必须通过 "),t("code",[s._v("run")]),s._v(" 命令将这些变量内容写回文件系统中的 "),t("code",[s._v("upload-keystore.jks")]),s._v(" 和 "),t("code",[s._v("key.properties")]),s._v(" 文件，这样 Flutter 的构建工具才能找到并使用它们进行签名。这是许多人初次配置时最容易忽略的地方。")]),s._v(" "),t("li",[t("strong",[s._v("使用 "),t("code",[s._v(".flutter-version")]),s._v(" 文件")]),s._v(": 在项目根目录创建一个 "),t("code",[s._v(".flutter-version")]),s._v(" 文件并写入 Flutter 版本号（如 "),t("code",[s._v("3.16.9")]),s._v("）。"),t("code",[s._v("subosito/flutter-action")]),s._v(" 会自动读取它，确保本地和 CI 使用完全一致的 Flutter SDK，避免环境不一致导致的构建失败。")])]),s._v(" "),t("hr"),s._v(" "),t("h3",{attrs:{id:"四、运维最佳实践与故障排查"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四、运维最佳实践与故障排查"}},[s._v("🌙")]),s._v(" 四、运维最佳实践与故障排查")]),s._v(" "),t("h4",{attrs:{id:"最佳实践"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最佳实践"}},[s._v("🌙")]),s._v(" 最佳实践")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("版本锁定 (Pinning)")]),s._v("：总是锁定你的 Actions ("),t("code",[s._v("@v4")]),s._v(", "),t("code",[s._v("@v2")]),s._v(") 和工具 ("),t("code",[s._v("node-version: '20'")]),s._v(", "),t("code",[s._v("pnpm version: 8")]),s._v(") 的主版本号。这可以防止上游工具的破坏性更新意外搞砸你的构建。")]),s._v(" "),t("li",[t("strong",[s._v("依赖锁文件")]),s._v("：始终将 "),t("code",[s._v("pnpm-lock.yaml")]),s._v(" (Node.js) 或 "),t("code",[s._v("pubspec.lock")]),s._v(" (Flutter) 文件提交到你的 Git 仓库。这是保证构建可复现性的生命线。")]),s._v(" "),t("li",[t("strong",[s._v("使用缓存")]),s._v("：无论是 "),t("code",[s._v("pnpm")]),s._v(" 还是 "),t("code",[s._v("Flutter SDK")]),s._v("，充分利用缓存可以显著提升构建速度，尤其是在大型项目中。")])]),s._v(" "),t("h4",{attrs:{id:"我的-action-为什么没有触发-故障排查清单"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#我的-action-为什么没有触发-故障排查清单"}},[s._v("🌙")]),s._v(' "我的 Action 为什么没有触发？" - 故障排查清单')]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("检查标签格式")]),s._v("：推送的标签是否以 "),t("code",[s._v("v")]),s._v(" 开头？例如 "),t("code",[s._v("v1.0.0")]),s._v("。")]),s._v(" "),t("li",[t("strong",[s._v("检查推送命令")]),s._v("：是否真的将标签推送到远程了？"),t("code",[s._v("git push")]),s._v(" 不会推送标签，你必须使用 "),t("code",[s._v("git push origin <tag_name>")]),s._v(" 或 "),t("code",[s._v("git push --tags")]),s._v("。")]),s._v(" "),t("li",[t("strong",[s._v("检查文件位置")]),s._v("：检查 workflow 文件是否在正确的位置："),t("code",[s._v(".github/workflows/your-file.yml")]),s._v("？目录和文件名都不能错。")]),s._v(" "),t("li",[t("strong",[s._v("检查默认分支")]),s._v("：检查 workflow 文件是否已经合并到了默认分支（通常是 "),t("code",[s._v("main")]),s._v("）？标签是基于某个 commit 的，如果那个 commit 的历史里没有这个 workflow 文件，它就不会被执行。")]),s._v(" "),t("li",[t("strong",[s._v("检查 Actions 是否被禁用")]),s._v("：在仓库的 "),t("code",[s._v("Settings")]),s._v(" -> "),t("code",[s._v("Actions")]),s._v(" -> "),t("code",[s._v("General")]),s._v(" 中，确认 Actions 是否被允许运行。")])]),s._v(" "),t("h3",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("🌙")]),s._v(" 总结")]),s._v(" "),t("p",[s._v("通过 GitHub Actions，我们把一个复杂、易错的手动流程，变成了一个可靠、高效、完全自动化的系统。现在，每次想发布一个新版本时，只需要专注于打好你的版本标签，然后 "),t("code",[s._v("git push")]),s._v("。一杯咖啡的时间，一个包含所有构建产物的正式 Release 就会出现在你的 GitHub 仓库中，等待交付给你的用户。")]),s._v(" "),t("blockquote",[t("p",[t("a",{attrs:{href:"https://github.com/softprops/action-gh-release",target:"_blank",rel:"noopener noreferrer"}},[s._v("github release actions"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/Keekuun/nextjs-dashboard/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("github nextjs demo release"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/Keekuun/todo_list/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("github flutter demo release"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports}}]);