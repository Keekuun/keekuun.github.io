(window.webpackJsonp=window.webpackJsonp||[]).push([[334],{1052:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("blockquote",[t("p",[s._v("åœ¨ä½¿ç”¨docker buildå‘½ä»¤çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™éœ€è¦æ ¹æ®ä¸åŒçš„è§„åˆ™æŒ‡å®šä¸åŒçš„æ„å»ºè„šæœ¬ï¼Œæ¯”å¦‚ dockerfileåˆ†ä¸ºprodæˆ–testï¼Œæˆ–è€…å°† å˜é‡ä¼ åˆ°dockerfileä¸­æ ¹æ®ä¸åŒçš„æ¡ä»¶æ‰§è¡Œä¸åŒçš„æ„å»ºå‘½ä»¤ï¼› è¿˜æ¯”å¦‚åœ¨ä¸åŒçš„æ‰“åŒ…ç¯å¢ƒä¸‹å¯èƒ½æ„å»ºå‡ºçš„äº§ç‰©ç›®å½•ä¸ä¸€æ ·ï¼Œæœ‰çš„æ˜¯distæˆ–dist/app1æˆ–dist/app2ï¼Œ é‚£ä¹ˆæœ‰å“ªäº›æ–¹å¼å¯ä»¥çµæ´»çš„å®ç°è¿™äº›å·®å¼‚åŒ–æ„å»ºå‘¢ï¼Ÿ")])]),s._v(" "),t("h3",{attrs:{id:"å‡ ç§å®ç°å·®å¼‚åŒ–æ„å»ºçš„ä¸»æµæ–¹å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‡ ç§å®ç°å·®å¼‚åŒ–æ„å»ºçš„ä¸»æµæ–¹å¼"}},[s._v("ğŸŒ™")]),s._v(" å‡ ç§å®ç°å·®å¼‚åŒ–æ„å»ºçš„ä¸»æµæ–¹å¼")]),s._v(" "),t("h4",{attrs:{id:"æ–¹å¼ä¸€-ä½¿ç”¨ä¸åŒçš„-dockerfile-æ–‡ä»¶-f-å‚æ•°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ–¹å¼ä¸€-ä½¿ç”¨ä¸åŒçš„-dockerfile-æ–‡ä»¶-f-å‚æ•°"}},[s._v("ğŸŒ™")]),s._v(" æ–¹å¼ä¸€ï¼šä½¿ç”¨ä¸åŒçš„ Dockerfile æ–‡ä»¶ ("),t("code",[s._v("-f")]),s._v(" å‚æ•°)")]),s._v(" "),t("p",[s._v("è¿™æ˜¯æœ€ç›´æ¥ã€æœ€ç®€å•çš„æ–¹å¼ã€‚ä½ å¯ä»¥ä¸ºä¸åŒçš„ç¯å¢ƒåˆ›å»ºä¸åŒçš„Dockerfileã€‚")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("Dockerfile.prod")]),s._v(" (ç”Ÿäº§ç¯å¢ƒ)")]),s._v(" "),t("li",[t("code",[s._v("Dockerfile.dev")]),s._v(" (å¼€å‘ç¯å¢ƒ)")]),s._v(" "),t("li",[t("code",[s._v("Dockerfile.test")]),s._v(" (æµ‹è¯•ç¯å¢ƒ)")])]),s._v(" "),t("p",[t("strong",[s._v("å·¥ä½œåŸç†ï¼š")]),s._v("\nåœ¨ "),t("code",[s._v("docker build")]),s._v(" å‘½ä»¤ä¸­ä½¿ç”¨ "),t("code",[s._v("-f")]),s._v(" æˆ– "),t("code",[s._v("--file")]),s._v(" å‚æ•°æ¥æ˜ç¡®æŒ‡å®šä½¿ç”¨å“ªä¸ªæ„å»ºè„šæœ¬ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("ç¤ºä¾‹ï¼š")])]),s._v(" "),t("p",[t("strong",[t("code",[s._v("Dockerfile.prod")]),s._v(":")])]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# === ç”Ÿäº§ç¯å¢ƒæ„å»ºè„šæœ¬ ===")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Stage 1: æ„å»ºå‰ç«¯åº”ç”¨")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node:18-alpine "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" builder")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" package*.json ./")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm install")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . .")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç”Ÿäº§ç¯å¢ƒæ„å»ºå‘½ä»¤")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm run build --prod")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Stage 2: éƒ¨ç½²åˆ° Nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" nginx:stable-alpine")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä»æ„å»ºé˜¶æ®µæ‹·è´äº§ç‰©ï¼Œå‡è®¾äº§ç‰©åœ¨ dist ç›®å½•")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token options"}},[t("span",{pre:!0,attrs:{class:"token property"}},[s._v("--from")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("builder")])]),s._v(" /app/dist /usr/share/nginx/html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[t("strong",[t("code",[s._v("Dockerfile.test")]),s._v(":")])]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# === æµ‹è¯•ç¯å¢ƒæ„å»ºè„šæœ¬ ===")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Stage 1: æ„å»ºå‰ç«¯åº”ç”¨")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node:18-alpine "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" builder")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" package*.json ./")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm install")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . .")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æµ‹è¯•ç¯å¢ƒæ„å»ºå‘½ä»¤ï¼Œå¯èƒ½åŒ…å«æµ‹è¯•å·¥å…·")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm run build:test")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Stage 2: éƒ¨ç½²åˆ° Nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" nginx:stable-alpine")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä»æ„å»ºé˜¶æ®µæ‹·è´äº§ç‰©ï¼Œå‡è®¾äº§ç‰©åœ¨ test-dist ç›®å½•")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token options"}},[t("span",{pre:!0,attrs:{class:"token property"}},[s._v("--from")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("builder")])]),s._v(" /app/test-dist /usr/share/nginx/html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[t("strong",[s._v("æ„å»ºå‘½ä»¤ï¼š")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ„å»ºç”Ÿäº§é•œåƒ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" my-app:prod "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" Dockerfile.prod "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ„å»ºæµ‹è¯•é•œåƒ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" my-app:test "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" Dockerfile.test "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[t("strong",[s._v("ä¼˜ç‚¹ï¼š")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("å®Œå…¨éš”ç¦»")]),s._v("ï¼šæ¯ä¸ªç¯å¢ƒçš„æ„å»ºé€»è¾‘å®Œå…¨ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("æ¸…æ™°æ˜“æ‡‚")]),s._v("ï¼šå¯¹äºå·®å¼‚å·¨å¤§çš„æ„å»ºæµç¨‹ï¼Œè¿™ç§æ–¹å¼æœ€ç›´è§‚ã€‚")])])]),s._v(" "),t("li",[t("strong",[s._v("ç¼ºç‚¹ï¼š")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("ä»£ç å†—ä½™")]),s._v("ï¼šå¦‚æœä¸¤ä¸ªæ–‡ä»¶å¤§éƒ¨åˆ†å†…å®¹éƒ½ç›¸åŒï¼ˆæ¯”å¦‚åŸºç¡€é•œåƒã€ä¾èµ–å®‰è£…æ­¥éª¤ï¼‰ï¼Œç»´æŠ¤èµ·æ¥å¾ˆéº»çƒ¦ã€‚ä¿®æ”¹ä¸€ä¸ªå…¬å…±éƒ¨åˆ†ï¼Œéœ€è¦åŒæ­¥ä¿®æ”¹æ‰€æœ‰æ–‡ä»¶ï¼Œå®¹æ˜“å‡ºé”™ã€‚")])])]),s._v(" "),t("li",[t("strong",[s._v("é€‚ç”¨åœºæ™¯")]),s._v("ï¼šå½“ä¸åŒç¯å¢ƒçš„æ„å»ºé€»è¾‘"),t("strong",[s._v("å·®å¼‚éå¸¸å¤§")]),s._v("æ—¶ï¼ˆä¾‹å¦‚ï¼ŒåŸºç¡€é•œåƒéƒ½ä¸åŒï¼Œæˆ–è€…æ„å»ºæµç¨‹å®Œå…¨ä¸ä¸€æ ·ï¼‰ã€‚")])]),s._v(" "),t("hr"),s._v(" "),t("h4",{attrs:{id:"æ–¹å¼äºŒ-ä½¿ç”¨æ„å»ºå‚æ•°-arg-å’Œ-build-arg"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ–¹å¼äºŒ-ä½¿ç”¨æ„å»ºå‚æ•°-arg-å’Œ-build-arg"}},[s._v("ğŸŒ™")]),s._v(" æ–¹å¼äºŒï¼šä½¿ç”¨æ„å»ºå‚æ•° ("),t("code",[s._v("ARG")]),s._v(" å’Œ "),t("code",[s._v("--build-arg")]),s._v(")")]),s._v(" "),t("p",[s._v("è¿™æ˜¯æœ€çµæ´»ã€æœ€æ¨èçš„æ–¹å¼ï¼Œå°¤å…¶é€‚åˆä½ æåˆ°çš„åœºæ™¯ã€‚å®ƒå…è®¸ä½ å°†å˜é‡ä» "),t("code",[s._v("docker build")]),s._v(" å‘½ä»¤ä¼ é€’åˆ° Dockerfile å†…éƒ¨ï¼Œä»è€Œå®ç°æ¡ä»¶åˆ¤æ–­ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("å·¥ä½œåŸç†ï¼š")])]),s._v(" "),t("ol",[t("li",[s._v("åœ¨ Dockerfile ä¸­ä½¿ç”¨ "),t("code",[s._v("ARG")]),s._v(" æŒ‡ä»¤å®šä¹‰ä¸€ä¸ªæ„å»ºæ—¶å˜é‡ã€‚")]),s._v(" "),t("li",[s._v("åœ¨ "),t("code",[s._v("docker build")]),s._v(" å‘½ä»¤ä¸­ä½¿ç”¨ "),t("code",[s._v("--build-arg")]),s._v(" æ¥ä¼ é€’è¿™ä¸ªå˜é‡çš„å€¼ã€‚")]),s._v(" "),t("li",[s._v("åœ¨ Dockerfile çš„ "),t("code",[s._v("RUN")]),s._v(", "),t("code",[s._v("COPY")]),s._v(" ç­‰æŒ‡ä»¤ä¸­ä½¿ç”¨è¿™ä¸ªå˜é‡ã€‚")])]),s._v(" "),t("p",[t("strong",[s._v("ç¤ºä¾‹1ï¼šæ ¹æ®å˜é‡æ‰§è¡Œä¸åŒçš„æ„å»ºå‘½ä»¤")])]),s._v(" "),t("p",[t("strong",[t("code",[s._v("Dockerfile")]),s._v(" (å•ä¸€æ–‡ä»¶):")])]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node:18-alpine "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" builder")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# å®šä¹‰ä¸€ä¸ªæ„å»ºç¯å¢ƒçš„å‚æ•°ï¼Œé»˜è®¤å€¼ä¸º "prod"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" BUILD_ENV=prod")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" package*.json ./")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm install")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . .")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ ¹æ® BUILD_ENV çš„å€¼æ‰§è¡Œä¸åŒçš„å‘½ä»¤")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" if [ "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$BUILD_ENV"')]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prod"')]),s._v(" ]; then "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n      echo "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('">>> Running production build"')]),s._v(" && npm run build; "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    else "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n      echo "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('">>> Running test build"')]),s._v(" && npm run build:test; "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    fi")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ...åç»­é˜¶æ®µ...")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[t("strong",[s._v("æ„å»ºå‘½ä»¤ï¼š")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ„å»ºç”Ÿäº§é•œåƒ (ä½¿ç”¨é»˜è®¤ ARG å€¼)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" my-app:prod "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ„å»ºæµ‹è¯•é•œåƒ (ä¼ é€’ä¸åŒçš„ ARG å€¼)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build --build-arg "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BUILD_ENV")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" my-app:test "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[t("strong",[s._v("ç¤ºä¾‹2ï¼šå¤„ç†ä¸åŒçš„äº§ç‰©ç›®å½• ("),t("code",[s._v("dist")]),s._v(", "),t("code",[s._v("dist/app1")]),s._v(", "),t("code",[s._v("dist/app2")]),s._v(")")])]),s._v(" "),t("p",[t("strong",[t("code",[s._v("Dockerfile")]),s._v(" (å•ä¸€æ–‡ä»¶):")])]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Stage 1: æ„å»º")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node:18-alpine "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" builder")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ... (npm install, etc.)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . .")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm run build # å‡è®¾è¿™ä¸ªå‘½ä»¤ä¼šç”Ÿæˆ dist/app1 æˆ– dist/app2")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Stage 2: éƒ¨ç½²")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" nginx:stable-alpine")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å®šä¹‰ä¸€ä¸ªå‚æ•°æ¥æŒ‡å®šèµ„æºè·¯å¾„ï¼Œå¹¶ç»™ä¸€ä¸ªå®‰å…¨çš„é»˜è®¤å€¼")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" ASSET_PATH=dist")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœ¨ COPY å‘½ä»¤ä¸­ä½¿ç”¨è¿™ä¸ªå˜é‡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ³¨æ„ï¼š$ASSET_PATH åé¢å¿…é¡»æœ‰æ–œæ ï¼Œè¡¨ç¤ºæ‹·è´ç›®å½•å†…å®¹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token options"}},[t("span",{pre:!0,attrs:{class:"token property"}},[s._v("--from")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("builder")])]),s._v(" /app/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ASSET_PATH}")]),s._v("/ /usr/share/nginx/html")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[t("strong",[s._v("æ„å»ºå‘½ä»¤ï¼š")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é»˜è®¤æ„å»º (äº§ç‰©åœ¨ dist ç›®å½•)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" my-app:latest "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ„å»º app1 (äº§ç‰©åœ¨ dist/app1 ç›®å½•)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build --build-arg "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ASSET_PATH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dist/app1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" my-app:app1 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ„å»º app2 (äº§ç‰©åœ¨ dist/app2 ç›®å½•)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build --build-arg "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ASSET_PATH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dist/app2 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" my-app:app2 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("ul",[t("li",[t("strong",[s._v("ä¼˜ç‚¹ï¼š")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("å•ä¸€æ–‡ä»¶")]),s._v("ï¼šç»´æŠ¤æˆæœ¬ä½ï¼Œæ‰€æœ‰é€»è¾‘é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("é«˜åº¦çµæ´»")]),s._v("ï¼šéå¸¸é€‚åˆCI/CDæµæ°´çº¿ï¼Œåªéœ€æ”¹å˜ä¼ å…¥çš„å‚æ•°å³å¯ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("é¿å…å†—ä½™")]),s._v("ï¼šæ‰€æœ‰ç¯å¢ƒå…±äº«å…¬å…±çš„æ„å»ºæ­¥éª¤ã€‚")])])]),s._v(" "),t("li",[t("strong",[s._v("ç¼ºç‚¹ï¼š")]),s._v(" "),t("ul",[t("li",[s._v("Dockerfile å†…éƒ¨å¯èƒ½ä¼šå‡ºç°ä¸€äº› "),t("code",[s._v("if/else")]),s._v(" é€»è¾‘ï¼Œç¨å¾®å¢åŠ äº†ä¸€ç‚¹å¤æ‚åº¦ã€‚")])])]),s._v(" "),t("li",[t("strong",[s._v("é€‚ç”¨åœºæ™¯")]),s._v("ï¼šç»å¤§å¤šæ•°éœ€è¦å·®å¼‚åŒ–æ„å»ºçš„åœºæ™¯ï¼Œæ˜¯äº‹å®ä¸Šçš„æ ‡å‡†åšæ³•ã€‚")])]),s._v(" "),t("hr"),s._v(" "),t("h4",{attrs:{id:"æ–¹å¼ä¸‰-åˆ©ç”¨å¤šé˜¶æ®µæ„å»ºçš„-target"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ–¹å¼ä¸‰-åˆ©ç”¨å¤šé˜¶æ®µæ„å»ºçš„-target"}},[s._v("ğŸŒ™")]),s._v(" æ–¹å¼ä¸‰ï¼šåˆ©ç”¨å¤šé˜¶æ®µæ„å»ºçš„ "),t("code",[s._v("target")])]),s._v(" "),t("p",[s._v("å¤šé˜¶æ®µæ„å»ºä¸ä»…å¯ä»¥å‡å°é•œåƒä½“ç§¯ï¼Œè¿˜å¯ä»¥ç”¨æ¥åˆ†ç¦»ä¸åŒçš„æ„å»ºç›®æ ‡ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("å·¥ä½œåŸç†ï¼š")]),s._v("\nä½ å¯ä»¥å®šä¹‰å¤šä¸ªæ„å»ºé˜¶æ®µï¼Œæ¯”å¦‚ "),t("code",[s._v("builder")]),s._v(", "),t("code",[s._v("tester")]),s._v(", "),t("code",[s._v("production")]),s._v("ã€‚ç„¶ååœ¨ "),t("code",[s._v("docker build")]),s._v(" æ—¶ä½¿ç”¨ "),t("code",[s._v("--target")]),s._v(" å‚æ•°æ¥æŒ‡å®šæ„å»ºåˆ°å“ªä¸€ä¸ªé˜¶æ®µä¸ºæ­¢ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("ç¤ºä¾‹ï¼šåˆ†ç¦»æµ‹è¯•å’Œæ„å»º")])]),s._v(" "),t("p",[t("strong",[t("code",[s._v("Dockerfile")]),s._v(":")])]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ---- åŸºç¡€æ„å»ºé˜¶æ®µ ----")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node:18-alpine "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" builder")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" package*.json ./")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm install")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . .")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ---- æµ‹è¯•é˜¶æ®µ ----")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" builder "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" tester")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿è¡Œæµ‹è¯•ï¼Œå¦‚æœæµ‹è¯•å¤±è´¥ï¼Œæ­¤é˜¶æ®µä¼šå¤±è´¥")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm test")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ---- ç”Ÿäº§é•œåƒé˜¶æ®µ ----")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" builder "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" release-builder")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿è¡Œç”Ÿäº§æ„å»º")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm run build")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ---- æœ€ç»ˆçš„ç”Ÿäº§é•œåƒ ----")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" nginx:stable-alpine "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" production")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token options"}},[t("span",{pre:!0,attrs:{class:"token property"}},[s._v("--from")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("release-builder")])]),s._v(" /app/dist/ /usr/share/nginx/html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[t("strong",[s._v("æ„å»ºå‘½ä»¤ï¼š")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. åªè¿è¡Œæµ‹è¯•ï¼Œä¸ç”Ÿæˆæœ€ç»ˆé•œåƒ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¦‚æœ npm test å¤±è´¥ï¼Œæ•´ä¸ªæ„å»ºå°±ä¼šå¤±è´¥ï¼Œéå¸¸é€‚åˆåœ¨ CI ä¸­åšä»£ç æ£€æŸ¥")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--target")]),s._v(" tester "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" my-app:test-runner "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. æ„å»ºæœ€ç»ˆçš„ç”Ÿäº§é•œåƒ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿™ä¼šè‡ªåŠ¨æ‰§è¡Œä¾èµ–çš„é˜¶æ®µ (builder -> release-builder -> production)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--target")]),s._v(" production "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" my-app:latest "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[t("strong",[s._v("ä¼˜ç‚¹ï¼š")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("é€»è¾‘æ¸…æ™°")]),s._v("ï¼šå°†æµ‹è¯•ã€æ„å»ºã€éƒ¨ç½²ç­‰ä¸åŒå…³æ³¨ç‚¹åˆ†ç¦»åˆ°ä¸åŒçš„é˜¶æ®µã€‚")]),s._v(" "),t("li",[t("strong",[s._v("CI/CD å‹å¥½")]),s._v("ï¼šå¯ä»¥å…ˆæ„å»º "),t("code",[s._v("tester")]),s._v(" é˜¶æ®µæ¥éªŒè¯ä»£ç ï¼Œé€šè¿‡åå†æ„å»º "),t("code",[s._v("production")]),s._v(" é˜¶æ®µã€‚")])])]),s._v(" "),t("li",[t("strong",[s._v("ç¼ºç‚¹ï¼š")]),s._v(" "),t("ul",[t("li",[s._v("å®ƒä¸»è¦è§£å†³çš„æ˜¯æ„å»ºæµç¨‹çš„åˆ†ç¦»ï¼Œå¯¹äºæ¡ä»¶åŒ–æ‹·è´æ–‡ä»¶ç­‰ç»†ç²’åº¦æ§åˆ¶ï¼Œä»éœ€ç»“åˆ"),t("strong",[s._v("æ–¹å¼äºŒ ("),t("code",[s._v("ARG")]),s._v(")")]),s._v(" æ¥å®ç°ã€‚")])])]),s._v(" "),t("li",[t("strong",[s._v("é€‚ç”¨åœºæ™¯")]),s._v("ï¼šå¸Œæœ›åœ¨åŒä¸€ä¸ª Dockerfile ä¸­å®šä¹‰å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€ç”Ÿäº§æ„å»ºç­‰å¤šä¸ªç‹¬ç«‹ç›®æ ‡ã€‚")])]),s._v(" "),t("hr"),s._v(" "),t("h3",{attrs:{id:"æœ€ä½³å®è·µä¸æ€»ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æœ€ä½³å®è·µä¸æ€»ç»“"}},[s._v("ğŸŒ™")]),s._v(" æœ€ä½³å®è·µä¸æ€»ç»“")]),s._v(" "),t("p",[s._v("æ¨è"),t("strong",[s._v("ç»„åˆä½¿ç”¨ "),t("code",[s._v("æ–¹å¼äºŒ (ARG)")]),s._v(" å’Œå¤šé˜¶æ®µæ„å»º")]),s._v("ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("ä¹ƒæ˜¯å½“å‰æœ€ç°ä»£åŒ–ã€æœ€çµæ´»ã€æœ€æ˜“äºç»´æŠ¤çš„æ–¹æ¡ˆã€‚")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("æ–¹æ¡ˆ")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("ä¼˜ç‚¹")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("ç¼ºç‚¹")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("æœ€ä½³é€‚ç”¨åœºæ™¯")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("1. å¤šæ–‡ä»¶ ("),t("code",[s._v("-f")]),s._v(")")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("å®Œå…¨éš”ç¦»ï¼Œé€»è¾‘æ¸…æ™°")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("ä»£ç å†—ä½™ï¼Œç»´æŠ¤å›°éš¾")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("ç¯å¢ƒå·®å¼‚å·¨å¤§ï¼Œå‡ ä¹æ— å…¬å…±éƒ¨åˆ†æ—¶")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("2. æ„å»ºå‚æ•° ("),t("code",[s._v("ARG")]),s._v(")")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("çµæ´»")]),s._v("ï¼Œ"),t("strong",[s._v("æ— å†—ä½™")]),s._v("ï¼Œ"),t("strong",[s._v("CI/CDå‹å¥½")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("éœ€åœ¨ "),t("code",[s._v("RUN")]),s._v(" ä¸­å†™å°‘é‡shellé€»è¾‘")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("95%çš„å·®å¼‚åŒ–æ„å»ºåœºæ™¯")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("3. å¤šé˜¶æ®µç›®æ ‡ ("),t("code",[s._v("--target")]),s._v(")")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("æµç¨‹åˆ†ç¦»ï¼Œé€‚åˆ CI é—¨ç¦")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("ä¸ç›´æ¥è§£å†³æ¡ä»¶åˆ¤æ–­é—®é¢˜")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("å®šä¹‰æµ‹è¯•ã€æ„å»ºç­‰ä¸åŒæ„å»ºç›®æ ‡")])])])]),s._v(" "),t("h4",{attrs:{id:"æœ€ç»ˆå»ºè®®æ–¹æ¡ˆ-ç»¼åˆç¤ºä¾‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æœ€ç»ˆå»ºè®®æ–¹æ¡ˆ-ç»¼åˆç¤ºä¾‹"}},[s._v("ğŸŒ™")]),s._v(" æœ€ç»ˆå»ºè®®æ–¹æ¡ˆ (ç»¼åˆç¤ºä¾‹)")]),s._v(" "),t("p",[s._v("åœ¨ä¸€ä¸ªåä¸º "),t("code",[s._v("Dockerfile")]),s._v(" çš„æ–‡ä»¶ä¸­ï¼Œç»“åˆå¤šé˜¶æ®µæ„å»ºå’Œ "),t("code",[s._v("ARG")]),s._v(" å‚æ•°ï¼š")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# =========================================================")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Stage 1: Builder - é€šç”¨çš„æ„å»ºç¯å¢ƒ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# =========================================================")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node:18-alpine "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" builder")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- ARG å®šä¹‰åŒº ---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å®šä¹‰æ„å»ºäº§ç‰©çš„è·¯å¾„ï¼Œé»˜è®¤æ˜¯ 'dist'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" ASSET_PATH=dist")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å®šä¹‰æ„å»ºè„šæœ¬å‘½ä»¤ï¼Œé»˜è®¤æ˜¯ 'build'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" BUILD_SCRIPT=build")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ‰“å°å‡ºæ¥æ”¶åˆ°çš„å‚æ•°ï¼Œä¾¿äºè°ƒè¯•")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('">>> Building with ASSET_PATH=${ASSET_PATH} and SCRIPT=${BUILD_SCRIPT}"')])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" package*.json ./")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm install")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . .")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ‰§è¡Œç”±å‚æ•°æŒ‡å®šçš„æ„å»ºè„šæœ¬")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm run "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BUILD_SCRIPT}")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# =========================================================")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Stage 2: Production - æœ€ç»ˆçš„ç”Ÿäº§é•œåƒ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# =========================================================")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" nginx:stable-alpine")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ARG å¿…é¡»åœ¨æ¯ä¸ªé˜¶æ®µé‡æ–°å£°æ˜æ‰èƒ½ä½¿ç”¨")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" ASSET_PATH=dist")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä» builder é˜¶æ®µæ‹·è´ç”± ASSET_PATH æŒ‡å®šçš„ç›®å½•å†…å®¹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token options"}},[t("span",{pre:!0,attrs:{class:"token property"}},[s._v("--from")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("builder")])]),s._v(" /app/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ASSET_PATH}")]),s._v("/ /usr/share/nginx/html")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("p",[t("strong",[s._v("è¿™æ ·ï¼Œä½ çš„ CI/CD æµæ°´çº¿å°±å¯ä»¥æå…¶çµæ´»åœ°æ„å»ºï¼š")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœºæ™¯A: æ ‡å‡†ç”Ÿäº§æ„å»º (äº§ç‰©åœ¨ dist)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" my-app:1.0.0 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœºæ™¯B: ä¸ºé¡¹ç›® app1 æ„å»º (äº§ç‰©åœ¨ project/app1, ä½¿ç”¨ build:app1 è„šæœ¬)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --build-arg "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ASSET_PATH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("project/app1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --build-arg "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BUILD_SCRIPT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("build:app1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" my-app-app1:1.0.0 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœºæ™¯C: ä¸ºé¡¹ç›® app2 æ„å»º (äº§ç‰©åœ¨ project/app2, ä½¿ç”¨ build:app2 è„šæœ¬)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --build-arg "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ASSET_PATH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("project/app2 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --build-arg "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BUILD_SCRIPT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("build:app2 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" my-app-app2:1.0.0 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("è¿™ä¸ªæ–¹æ¡ˆå°† Dockerfile çš„ç»´æŠ¤æˆæœ¬é™åˆ°æœ€ä½ï¼ŒåŒæ—¶å°†çµæ´»æ€§å‘æŒ¥åˆ°äº†æè‡´ï¼Œå®Œå…¨ç¬¦åˆè‡ªåŠ¨åŒ–è¿ç»´å¯¹å¥å£®æ€§å’Œå¯ç»´æŠ¤æ€§çš„è¦æ±‚ã€‚")])])}),[],!1,null,null,null);t.default=e.exports}}]);