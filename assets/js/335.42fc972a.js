(window.webpackJsonp=window.webpackJsonp||[]).push([[335],{1057:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("blockquote",[t("p",[s._v("本文深入浅出地讲解 BFCache（往返缓存 / Back/Forward Cache）。这是一个能够极大提升用户体验，特别是移动端体验的关键性能优化技术。")])]),s._v(" "),t("hr"),s._v(" "),t("h3",{attrs:{id:"从浅入深-理解-bfcache"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#从浅入深-理解-bfcache"}},[s._v("🌙")]),s._v(" 从浅入深，理解 BFCache")]),s._v(" "),t("h4",{attrs:{id:"_1-什么是-bfcache-它解决了什么问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是-bfcache-它解决了什么问题"}},[s._v("🌙")]),s._v(" 1. 什么是 BFCache？它解决了什么问题？")]),s._v(" "),t("p",[s._v("想象一个常见的场景：")]),s._v(" "),t("ul",[t("li",[s._v("你正在手机上浏览一个商品列表页（页面A）。")]),s._v(" "),t("li",[s._v("你滚动了很久，找到了一个感兴趣的商品，点击进入了商品详情页（页面B）。")]),s._v(" "),t("li",[s._v("看完后，你点击了浏览器的“后退”按钮，想回到刚才的列表页（页面A）。")])]),s._v(" "),t("p",[t("strong",[s._v("没有 BFCache 的情况：")]),s._v("\n浏览器会重新加载整个页面A。这意味着：")]),s._v(" "),t("ul",[t("li",[s._v("重新请求 HTML、CSS、JS 文件。")]),s._v(" "),t("li",[s._v("重新执行 JavaScript，重新渲染 DOM。")]),s._v(" "),t("li",[t("strong",[s._v("你之前滚到的位置丢失了！")]),s._v(" 你回到了列表页的顶部，需要重新滚动查找。")]),s._v(" "),t("li",[s._v("整个过程很慢，有明显的白屏时间，体验非常糟糕。")])]),s._v(" "),t("p",[t("strong",[s._v("有了 BFCache 的情况：")]),s._v("\n当你离开页面A时，现代浏览器会像拍“快照”一样，将整个页面的状态（包括 DOM 树、JavaScript 堆内存、滚动位置等）完整地保存在内存中。")]),s._v(" "),t("p",[s._v("当你点击“后退”按钮时，浏览器会直接从内存中恢复这个“快照”，而不是重新加载。这意味着：")]),s._v(" "),t("ul",[t("li",[s._v("页面几乎是"),t("strong",[s._v("瞬时")]),s._v("恢复。")]),s._v(" "),t("li",[t("strong",[s._v("你之前滚到的位置、填写了一半的表单数据、JS中的变量状态都完美保留。")])]),s._v(" "),t("li",[s._v("用户体验如丝般顺滑。")])]),s._v(" "),t("p",[t("strong",[s._v("核心比喻：")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("普通加载")]),s._v(" = 关掉电脑再重新开机。")]),s._v(" "),t("li",[t("strong",[s._v("BFCache")]),s._v(" = 让电脑进入“睡眠”模式，然后瞬间唤醒。")])]),s._v(" "),t("hr"),s._v(" "),t("h4",{attrs:{id:"_2-bfcache-的工作原理和生命周期事件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-bfcache-的工作原理和生命周期事件"}},[s._v("🌙")]),s._v(" 2. BFCache 的工作原理和生命周期事件")]),s._v(" "),t("p",[s._v("要利用好 BFCache，我们必须理解它引入的两个关键页面生命周期事件："),t("code",[s._v("pageshow")]),s._v(" 和 "),t("code",[s._v("pagehide")]),s._v("。这两个事件是为了取代旧的、会破坏 BFCache 的 "),t("code",[s._v("load")]),s._v(" 和 "),t("code",[s._v("unload")]),s._v(" 事件而设计的。")]),s._v(" "),t("h5",{attrs:{id:"pagehide-事件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pagehide-事件"}},[s._v("🌙")]),s._v(" "),t("strong",[t("code",[s._v("pagehide")]),s._v(" 事件")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("触发时机")]),s._v("：当用户即将离开当前页面时触发。")]),s._v(" "),t("li",[t("strong",[s._v("关键属性")]),s._v("：事件对象 "),t("code",[s._v("event")]),s._v(" 中包含一个布尔值 "),t("code",[s._v("persisted")]),s._v("。\n"),t("ul",[t("li",[t("code",[s._v("event.persisted === true")]),s._v("：表示页面"),t("strong",[s._v("正在被存入 BFCache")]),s._v("，未来有可能被恢复。")]),s._v(" "),t("li",[t("code",[s._v("event.persisted === false")]),s._v("：表示页面"),t("strong",[s._v("不会被缓存")]),s._v("，将被正常卸载。")])])])]),s._v(" "),t("h5",{attrs:{id:"pageshow-事件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pageshow-事件"}},[s._v("🌙")]),s._v(" "),t("strong",[t("code",[s._v("pageshow")]),s._v(" 事件")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("触发时机")]),s._v("：当用户进入或返回到当前页面时触发。它在传统的 "),t("code",[s._v("load")]),s._v(" 事件之后触发。")]),s._v(" "),t("li",[t("strong",[s._v("关键属性")]),s._v("：事件对象 "),t("code",[s._v("event")]),s._v(" 中也包含一个布尔值 "),t("code",[s._v("persisted")]),s._v("。\n"),t("ul",[t("li",[t("code",[s._v("event.persisted === true")]),s._v("：表示页面是"),t("strong",[s._v("从 BFCache 中恢复")]),s._v("的。这时 "),t("code",[s._v("load")]),s._v(" 事件不会触发！")]),s._v(" "),t("li",[t("code",[s._v("event.persisted === false")]),s._v("：表示页面是"),t("strong",[s._v("首次加载")]),s._v("（或浏览器不支持 BFCache）。")])])])]),s._v(" "),t("h5",{attrs:{id:"代码示例-typescript"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#代码示例-typescript"}},[s._v("🌙")]),s._v(" "),t("strong",[s._v("代码示例 (TypeScript)")])]),s._v(" "),t("div",{staticClass:"language-typescript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-typescript"}},[t("code",[s._v("window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEventListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pageshow'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" PageTransitionEvent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("persisted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 页面从 BFCache 中恢复")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("console")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'This page was restored from the BFCache.'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 在这里执行恢复后需要更新的逻辑，比如重新请求实时数据")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("refreshRealTimeData")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 页面是首次加载")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("console")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'This page was loaded normally.'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nwindow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEventListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pagehide'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" PageTransitionEvent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("persisted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 页面即将进入 BFCache")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("console")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'This page will be saved in the BFCache.'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 在这里可以做一些清理工作，但不能是破坏性的")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 页面将被正常卸载")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("console")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'This page will be unloaded.'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("refreshRealTimeData")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("console")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Fetching fresh data because the page was restored...'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 例如：fetch('/api/latest-news').then(...)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("hr"),s._v(" "),t("h4",{attrs:{id:"_3-为什么我的页面无法进入-bfcache"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-为什么我的页面无法进入-bfcache"}},[s._v("🌙")]),s._v(" 3. 为什么我的页面无法进入 BFCache？")]),s._v(" "),t("p",[s._v("这是最关键的实践部分。很多时候我们的页面无法享受 BFCache 带来的好处，通常是因为包含了一些“不兼容”的特性。")]),s._v(" "),t("p",[t("strong",[s._v("导致 BFCache 失效的常见原因：")])]),s._v(" "),t("ol",[t("li",[t("p",[t("strong",[t("code",[s._v("unload")]),s._v(" 事件监听器：")]),s._v(" 这是"),t("strong",[s._v("头号杀手")]),s._v("。任何在 "),t("code",[s._v("window")]),s._v(" 上注册的 "),t("code",[s._v("unload")]),s._v(" 事件都会让浏览器放弃缓存该页面。因为浏览器无法保证 "),t("code",[s._v("unload")]),s._v(" 里的代码执行后，页面还能被安全地恢复。")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("解决方案")]),s._v("："),t("strong",[s._v("永远用 "),t("code",[s._v("pagehide")]),s._v(" 代替 "),t("code",[s._v("unload")])]),s._v("。如果你使用的第三方库（比如一些旧的统计脚本）还在用 "),t("code",[s._v("unload")]),s._v("，请联系其开发者更新或寻找替代品。")])])]),s._v(" "),t("li",[t("p",[t("strong",[t("code",[s._v("Cache-Control: no-store")]),s._v(" HTTP 头：")]),s._v(" 如果页面响应头中包含 "),t("code",[s._v("Cache-Control: no-store")]),s._v("，浏览器会遵从这个指令，不缓存页面。")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("注意")]),s._v("："),t("code",[s._v("no-cache")]),s._v(" 通常不影响 BFCache，但 "),t("code",[s._v("no-store")]),s._v(" 会。")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("未关闭的连接：")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("WebSocket")]),s._v(" 或 "),t("strong",[s._v("WebRTC")]),s._v(" 连接。")]),s._v(" "),t("li",[t("strong",[s._v("IndexedDB")]),s._v(" 事务。")]),s._v(" "),t("li",[t("strong",[t("code",[s._v("fetch")]),s._v(" 或 "),t("code",[s._v("XMLHttpRequest")])]),s._v(" 仍在进行中。")]),s._v(" "),t("li",[t("strong",[s._v("解决方案")]),s._v("：在 "),t("code",[s._v("pagehide")]),s._v(" 事件中，妥善关闭这些连接或请求。")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("需要用户授权的 API：")]),s._v(" 如果页面正在使用摄像头、麦克风或地理位置等需要用户授权的 API，通常无法被缓存。")])]),s._v(" "),t("li",[t("p",[t("strong",[t("code",[s._v("window.opener")]),s._v(" 引用：")]),s._v(" 如果页面是通过 "),t("code",[s._v("window.open")]),s._v(" 打开的，并且保留了对父窗口（"),t("code",[s._v("window.opener")]),s._v("）的引用，可能会阻止 BFCache。使用 "),t("code",[s._v('rel="noopener"')]),s._v(" 可以解决这个问题。")])])]),s._v(" "),t("p",[t("strong",[s._v("如何检查 BFCache 是否生效？")])]),s._v(" "),t("p",[t("strong",[s._v("Chrome DevTools")]),s._v(" 是你的好朋友：")]),s._v(" "),t("ol",[t("li",[s._v("打开开发者工具 ("),t("code",[s._v("F12")]),s._v(")。")]),s._v(" "),t("li",[s._v("进入 "),t("code",[s._v("Application")]),s._v(" (应用) 面板。")]),s._v(" "),t("li",[s._v("在左侧导航栏找到 "),t("code",[s._v("Background services")]),s._v(" (后台服务) 下的 "),t("code",[s._v("Back/forward cache")]),s._v("。")]),s._v(" "),t("li",[s._v("点击 "),t("code",[s._v("Run Test")]),s._v(" 按钮。DevTools 会模拟一次往返导航，并告诉你页面是否成功进入 BFCache。如果失败，它会明确列出原因（"),t("code",[s._v("Reasons")]),s._v('），例如 "Unload handler"。')])]),s._v(" "),t("hr"),s._v(" "),t("h3",{attrs:{id:"结合实际开发"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#结合实际开发"}},[s._v("🌙")]),s._v(" 结合实际开发")]),s._v(" "),t("h4",{attrs:{id:"场景一-h5-开发-如电商、新闻应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#场景一-h5-开发-如电商、新闻应用"}},[s._v("🌙")]),s._v(" 场景一：H5 开发（如电商、新闻应用）")]),s._v(" "),t("p",[t("strong",[s._v("问题：")]),s._v(" 在一个商品列表页，用户向下滚动了很多，然后进入详情页，再返回。我们希望用户能回到原来的位置，但同时，列表页的某些信息（如库存、最新价格）可能已经过时了。")]),s._v(" "),t("p",[t("strong",[s._v("解决方案：")])]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("确保 BFCache 生效")]),s._v("：检查代码，确保没有使用 "),t("code",[s._v("unload")]),s._v(" 事件，并且没有其他阻止 BFCache 的因素。")]),s._v(" "),t("li",[t("strong",[s._v("在 "),t("code",[s._v("pageshow")]),s._v(" 事件中更新数据")]),s._v("：利用 "),t("code",[s._v("event.persisted")]),s._v(" 来判断页面是否从缓存中恢复。如果是，就发起一个轻量级的数据请求来更新关键信息，同时保留用户的滚动位置。")])]),s._v(" "),t("p",[t("strong",[s._v("示例代码 (TypeScript):")])]),s._v(" "),t("div",{staticClass:"language-typescript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-typescript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 在商品列表页的 JS 中")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ProductListPage")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("constructor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("init")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("init")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("loadInitialData")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEventListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pageshow'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handlePageShow")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handlePageShow")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" PageTransitionEvent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 只有当页面从 BFCache 恢复时，才执行此逻辑")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("persisted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("console")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Page restored from BFCache. Refreshing stock levels.'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("refreshStockLevels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("loadInitialData")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 首次加载时获取完整数据")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("console")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Loading initial product list...'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("refreshStockLevels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 发起一个API请求，只获取最新的库存和价格信息")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// fetch('/api/products/stock-updates').then(...)")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 成功后，只更新DOM中对应的库存和价格部分，不重新渲染整个列表")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 这样用户的滚动位置和其他状态都得以保留")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ProductListPage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br")])]),t("h4",{attrs:{id:"场景二-webview-混合开发-hybrid-app"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#场景二-webview-混合开发-hybrid-app"}},[s._v("🌙")]),s._v(" 场景二：WebView 混合开发 (Hybrid App)")]),s._v(" "),t("p",[s._v("在混合应用中，前端页面运行在 Native App 提供的 WebView（如 iOS 的 WKWebView，Android 的 Chrome WebView）中。")]),s._v(" "),t("p",[t("strong",[s._v("BFCache 在 WebView 中的表现：")])]),s._v(" "),t("ul",[t("li",[s._v("现代的 WebView 已经很好地支持 BFCache。其行为和标准浏览器基本一致。")]),s._v(" "),t("li",[s._v("当用户在 WebView 内的页面之间进行前进/后退时，BFCache 会起作用。")]),s._v(" "),t("li",[t("strong",[s._v("注意")]),s._v("：当用户从 WebView "),t("strong",[s._v("返回到 Native 界面")]),s._v("时，WebView 实例本身可能会被销毁或进入后台，这不属于 BFCache 的范畴。BFCache 只管理 WebView 内部的浏览历史。")])]),s._v(" "),t("p",[t("strong",[s._v("问题：")]),s._v(" 一个 WebView 页面依赖 Native 提供的数据。当页面从 BFCache 恢复时，这些数据可能已经因为某些 Native 操作而变得陈旧。")]),s._v(" "),t("p",[t("strong",[s._v("解决方案：")]),s._v("\n建立一个通信机制，在 WebView 重新变为可见时，由 Native 主动通知 H5 页面进行数据刷新。")]),s._v(" "),t("ol",[t("li",[t("p",[t("strong",[s._v("Native 端")]),s._v("：监听 WebView 的生命周期（如 "),t("code",[s._v("viewWillAppear")]),s._v(" on iOS）。当 WebView 即将再次显示时，执行一段 JS 代码来通知 H5 页面。")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Android 示例")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// webView.evaluateJavascript(\"window.dispatchEvent(new CustomEvent('native-wakeup'))\", null);")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("H5 端")]),s._v("：除了监听 "),t("code",[s._v("pageshow")]),s._v(" 事件，也监听来自 Native 的自定义事件。")])])]),s._v(" "),t("p",[t("strong",[s._v("示例代码 (TypeScript):")])]),s._v(" "),t("div",{staticClass:"language-typescript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-typescript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HybridPage")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("constructor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("initListeners")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("initListeners")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 监听 BFCache 恢复")]),s._v("\n    window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEventListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pageshow'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" PageTransitionEvent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("persisted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("console")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Restored from BFCache, checking for native updates.'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("requestDataFromNative")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 监听来自 Native 的唤醒通知")]),s._v("\n    window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEventListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'native-wakeup'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("console")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Woken up by native, refreshing data.'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("requestDataFromNative")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("requestDataFromNative")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 通过 JSBridge 调用 Native 方法获取最新数据")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// bridge.call('getUserInfo', (userInfo) => { this.updateUI(userInfo); });")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("console")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Requesting fresh data from Native host...'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("updateUI")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("any")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 更新页面内容")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HybridPage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br")])]),t("h3",{attrs:{id:"总结与最佳实践"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结与最佳实践"}},[s._v("🌙")]),s._v(" 总结与最佳实践")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("拥抱 "),t("code",[s._v("pageshow")]),s._v(" 和 "),t("code",[s._v("pagehide")])]),s._v("：这是利用 BFCache 的基石。")]),s._v(" "),t("li",[t("strong",[s._v("告别 "),t("code",[s._v("unload")])]),s._v("：彻底从你的代码和依赖中移除它。")]),s._v(" "),t("li",[t("strong",[s._v("善用 DevTools")]),s._v("：定期检查关键页面的 BFCache 兼容性，并根据提示进行修复。")]),s._v(" "),t("li",[t("strong",[s._v("处理陈旧数据")]),s._v("：在 "),t("code",[s._v("pageshow")]),s._v(" 事件（当 "),t("code",[s._v("event.persisted")]),s._v(" 为 "),t("code",[s._v("true")]),s._v(" 时）中，智能地更新页面所需的核心数据。")]),s._v(" "),t("li",[t("strong",[s._v("管理好连接")]),s._v("：在 "),t("code",[s._v("pagehide")]),s._v(" 中清理 WebSocket、XHR 等资源，为页面进入 BFCache 做好准备。")])]),s._v(" "),t("p",[s._v("掌握 BFCache 是现代前端工程师提升用户体验的必备技能。它能以极低的成本带来巨大的性能提升，尤其是在网络环境不佳的移动端。")])])}),[],!1,null,null,null);t.default=e.exports}}]);