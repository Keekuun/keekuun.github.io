(window.webpackJsonp=window.webpackJsonp||[]).push([[287],{1004:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"vite-打包策略-如何仅让低版本浏览器加载兼容性代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vite-打包策略-如何仅让低版本浏览器加载兼容性代码"}},[t._v("🌙")]),t._v(" Vite 打包策略：如何仅让低版本浏览器加载兼容性代码？")]),t._v(" "),s("p",[t._v("这个问题可以拆解为两个部分：")]),t._v(" "),s("ol",[s("li",[t._v("Vite 如何打包以兼容低版本浏览器？")]),t._v(" "),s("li",[t._v("如何智能地只让低版本浏览器加载兼容性代码，而现代浏览器则加载最优代码？")])]),t._v(" "),s("p",[t._v("答案是："),s("strong",[t._v("Babel 和 Rollup 本身不会自动处理这个问题，但 Vite 通过一个官方插件 "),s("code",[t._v("@vitejs/plugin-legacy")]),t._v(" 巧妙地利用了它们，并结合浏览器的原生特性，完美地实现了这个需求。")])]),t._v(" "),s("p",[t._v("这个方案通常被称为 "),s("strong",[t._v('"Differential Loading" (差异化加载)')]),t._v("。")]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"核心原理-script-type-module-和-nomodule"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#核心原理-script-type-module-和-nomodule"}},[t._v("🌙")]),t._v(" 核心原理："),s("code",[t._v('script type="module"')]),t._v(" 和 "),s("code",[t._v("nomodule")])]),t._v(" "),s("p",[t._v("这个方案的基石是 HTML "),s("code",[t._v("script")]),t._v(" 标签的一个非常聪明的特性组合：")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[s("code",[t._v('<script type="module" src="...">')])]),t._v(":")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("现代浏览器")]),t._v(" (如新版 Chrome, Firefox, Safari) 能够识别 "),s("code",[t._v('type="module"')]),t._v("。它们会下载并执行这个脚本。")]),t._v(" "),s("li",[s("strong",[t._v("旧版浏览器")]),t._v(" (如 IE11) 不认识 "),s("code",[t._v('type="module"')]),t._v("，因此会 "),s("strong",[t._v("直接忽略")]),t._v(" 这个 "),s("code",[t._v("script")]),t._v(" 标签，不会下载也不会执行。")])])]),t._v(" "),s("li",[s("p",[s("strong",[s("code",[t._v('<script nomodule src="...">')])]),t._v(":")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("现代浏览器")]),t._v(" 识别 "),s("code",[t._v('type="module"')]),t._v("，因此它们也知道 "),s("code",[t._v("nomodule")]),t._v(" 的含义，所以它们会 "),s("strong",[t._v("忽略")]),t._v(" 带有 "),s("code",[t._v("nomodule")]),t._v(" 属性的脚本。")]),t._v(" "),s("li",[s("strong",[t._v("旧版浏览器")]),t._v(" 不认识 "),s("code",[t._v("nomodule")]),t._v(" 属性，它们会把它当作一个未知的布尔属性，但仍然会正常下载并执行这个脚本。")])])])]),t._v(" "),s("p",[s("strong",[t._v("结论就是：")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("现代浏览器")]),t._v("：加载 "),s("code",[t._v('type="module"')]),t._v(" 的脚本，忽略 "),s("code",[t._v("nomodule")]),t._v(" 的脚本。")]),t._v(" "),s("li",[s("strong",[t._v("旧版浏览器")]),t._v("：忽略 "),s("code",[t._v('type="module"')]),t._v(" 的脚本，加载 "),s("code",[t._v("nomodule")]),t._v(" 的脚本。")])]),t._v(" "),s("p",[t._v("这就实现了一个天然的、无需 JavaScript 判断的浏览器分流机制！")]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"vitejs-plugin-legacy-的工作流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vitejs-plugin-legacy-的工作流程"}},[t._v("🌙")]),t._v(" "),s("code",[t._v("@vitejs/plugin-legacy")]),t._v(" 的工作流程")]),t._v(" "),s("p",[s("code",[t._v("@vitejs/plugin-legacy")]),t._v(" 就是这个机制的自动化实现者。当你配置了它，在执行 "),s("code",[t._v("vite build")]),t._v(" 时，它会执行以下一系列操作：")]),t._v(" "),s("h4",{attrs:{id:"_1-生成两套产物-bundles"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-生成两套产物-bundles"}},[t._v("🌙")]),t._v(" 1. 生成两套产物 (Bundles)")]),t._v(" "),s("p",[t._v("插件会并行地构建两套 JavaScript 包：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Modern Bundle (现代包)")]),t._v(": 这是 Vite 的默认行为。它使用 esbuild 进行转换，代码非常现代（比如保留 "),s("code",[t._v("const")]),t._v(", "),s("code",[t._v("let")]),t._v(", 箭头函数等），体积小，性能高。这是为现代浏览器准备的。")]),t._v(" "),s("li",[s("strong",[t._v("Legacy Bundle (旧版包)")]),t._v(": 这是插件的核心工作。\n"),s("ul",[s("li",[t._v("它会调用 "),s("strong",[t._v("Babel")]),t._v(" 和 "),s("code",[t._v("@babel/preset-env")]),t._v("。")]),t._v(" "),s("li",[t._v("根据你设定的 "),s("code",[t._v("targets")]),t._v(" (例如 "),s("code",[t._v("'ie 11'")]),t._v(")，Babel 会将现代 JavaScript 语法（ES6+）"),s("strong",[t._v("降级转换 (Transpile)")]),t._v(" 成 ES5 语法。")]),t._v(" "),s("li",[t._v("它还会自动注入必要的 "),s("strong",[t._v("Polyfills")]),t._v("（通常通过 "),s("code",[t._v("core-js")]),t._v("）来模拟那些旧版浏览器缺失的 API（如 "),s("code",[t._v("Promise")]),t._v(", "),s("code",[t._v("Symbol")]),t._v(" 等）。这些 polyfills "),s("strong",[t._v("只会")]),t._v(" 被包含在旧版包中。")])])])]),t._v(" "),s("h4",{attrs:{id:"_2-修改-index-html"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-修改-index-html"}},[t._v("🌙")]),t._v(" 2. 修改 "),s("code",[t._v("index.html")])]),t._v(" "),s("p",[t._v("构建完成后，插件会自动修改输出目录 ("),s("code",[t._v("dist")]),t._v(") 中的 "),s("code",[t._v("index.html")]),t._v(" 文件，将这两套脚本都注入进去，并正确地设置 "),s("code",[t._v('type="module"')]),t._v(" 和 "),s("code",[t._v("nomodule")]),t._v(" 属性。")]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"实战演练"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实战演练"}},[t._v("🌙")]),t._v(" 实战演练")]),t._v(" "),s("p",[t._v("让我们来看一个完整的配置和产出示例。")]),t._v(" "),s("h4",{attrs:{id:"步骤-1-安装插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步骤-1-安装插件"}},[t._v("🌙")]),t._v(" 步骤 1: 安装插件")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" @vitejs/plugin-legacy "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-D")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或者 yarn add @vitejs/plugin-legacy -D")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("h4",{attrs:{id:"步骤-2-配置-vite-config-ts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步骤-2-配置-vite-config-ts"}},[t._v("🌙")]),t._v(" 步骤 2: 配置 "),s("code",[t._v("vite.config.ts")])]),t._v(" "),s("div",{staticClass:"language-typescript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" defineConfig "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vite'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" vue "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@vitejs/plugin-vue'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 以 Vue 为例")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" legacy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@vitejs/plugin-legacy'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  plugins"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("legacy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定需要兼容的浏览器列表")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可以使用 browserslist 格式，例如 'defaults' 或 ['> 0.5%', 'last 2 versions', 'not dead']")]),t._v("\n      targets"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ie >= 11'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n    \n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 是否为旧版浏览器生成额外的 polyfills")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 'usage' 会根据代码中使用到的 API 按需引入")]),t._v("\n      polyfills"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'es.promise.finally'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'es/map'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'es/set'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 默认情况下，插件还会为旧版 chunk 生成一个 SystemJS 加载器包装")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 以支持动态导入 `import()`")]),t._v("\n      modernPolyfills"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 为现代浏览器也生成 polyfill，但会通过 `nomodule` 避免加载")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br")])]),s("h4",{attrs:{id:"步骤-3-查看构建产物"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步骤-3-查看构建产物"}},[t._v("🌙")]),t._v(" 步骤 3: 查看构建产物")]),t._v(" "),s("p",[t._v("假设你的源码 "),s("code",[t._v("main.ts")]),t._v(" 很简单：")]),t._v(" "),s("div",{staticClass:"language-typescript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// src/main.ts")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("main")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("console")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello, Vite!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[t._v("当你运行 "),s("code",[t._v("vite build")]),t._v(" 后，查看 "),s("code",[t._v("dist")]),t._v(" 目录：")]),t._v(" "),s("p",[s("strong",[s("code",[t._v("dist")]),t._v(" 目录结构 (简化后):")])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("dist/\n├── assets/\n│   ├── main-a1b2c3d4.js         <-- 现代包 (ESM)\n│   └── main-legacy-e5f6g7h8.js   <-- 旧版包 (ES5)\n├── index.html\n└── ...\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("p",[s("strong",[s("code",[t._v("dist/index.html")]),t._v(" 文件内容 (关键部分):")])]),t._v(" "),s("div",{staticClass:"language-html line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token doctype"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),s("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- ... --\x3e")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 现代浏览器加载这个 --\x3e")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("crossorigin")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/assets/main-a1b2c3d4.js"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}}),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 插件注入的 polyfill 加载逻辑 --\x3e")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}},[s("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vite/modulepreload-polyfill"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  ")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 旧版浏览器加载这个 --\x3e")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("nomodule")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("crossorigin")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("vite-legacy-polyfill"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/assets/polyfills-legacy-....js"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}}),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("nomodule")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("crossorigin")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("vite-legacy-entry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/assets/main-legacy-e5f6g7h8.js"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}}),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- ... --\x3e")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br")])]),s("p",[t._v("如你所见，插件自动生成了带有 "),s("code",[t._v('type="module"')]),t._v(" 和 "),s("code",[t._v("nomodule")]),t._v(" 的 "),s("code",[t._v("<script>")]),t._v(" 标签。")]),t._v(" "),s("ul",[s("li",[t._v("一台装有最新 Chrome 的电脑访问这个页面，只会下载 "),s("code",[t._v("main-a1b2c3d4.js")]),t._v("，享受到最快的加载和执行速度。")]),t._v(" "),s("li",[t._v("一台 IE11 电脑访问这个页面，会忽略第一个 script，转而下载 "),s("code",[t._v("polyfills-legacy-....js")]),t._v(" 和 "),s("code",[t._v("main-legacy-e5f6g7h8.js")]),t._v("，虽然文件更大、执行稍慢，但页面功能可以正常运行。")])]),t._v(" "),s("h3",{attrs:{id:"总结-角色分工"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结-角色分工"}},[t._v("🌙")]),t._v(" 总结：角色分工")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("工具/技术")]),t._v(" "),s("th",[t._v("职责")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[t._v("Vite")])]),t._v(" "),s("td",[t._v("构建协调器，默认使用 esbuild 生成高性能的现代包。")])]),t._v(" "),s("tr",[s("td",[s("strong",[s("code",[t._v("@vitejs/plugin-legacy")])])]),t._v(" "),s("td",[s("strong",[t._v("总指挥")]),t._v("。 orchestrates the entire process. 调用 Babel，生成旧版包，并修改 HTML。")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("Babel")])]),t._v(" "),s("td",[s("strong",[t._v("转换工")]),t._v("。被插件调用，将现代 JS 语法转换为 ES5。")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("Rollup")])]),t._v(" "),s("td",[s("strong",[t._v("打包器")]),t._v("。Vite 在生产构建时底层使用 Rollup，插件通过其 API 来创建不同的构建任务。")])]),t._v(" "),s("tr",[s("td",[s("strong",[s("code",[t._v("type=module/nomodule")])])]),t._v(" "),s("td",[s("strong",[t._v("浏览器原生分流器")]),t._v("。是实现差异化加载的最终魔法。")])])])]),t._v(" "),s("p",[t._v("所以，Babel 和 Rollup 是实现这个目标的"),s("strong",[t._v("关键工具")]),t._v("，但真正将它们组织起来，实现"),s("strong",[t._v("自动化差异化加载")]),t._v("的是 "),s("strong",[s("code",[t._v("@vitejs/plugin-legacy")])]),t._v("。你作为开发者，只需要配置好这个插件，就能优雅地同时拥抱未来和兼容过去了。")]),t._v(" "),s("blockquote",[s("p",[s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/HTMLScriptElement/noModule",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTMLScriptElement: noModule property"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("RouterLink",{attrs:{to:"/frontEnd/VAR/Vue/nuxt2-to-nuxt3.html"}},[t._v("nuxt3 兼容处理")])],1),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/vitejs/vite/tree/main/packages/plugin-legacy#readme",target:"_blank",rel:"noopener noreferrer"}},[t._v("@vitejs/plugin-legacy"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);