(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{1056:function(t,e,a){"use strict";a.r(e);var s=a(2),n=Object(s.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"http缓存策略"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#http缓存策略"}},[t._v("🌙")]),t._v(" HTTP缓存策略")]),t._v(" "),e("blockquote",[e("p",[t._v("前期学习了一下缓存相关的知识，看了一下项目的接口发现Header里面设置的全是不允许缓存，巩固一下HTTP缓存")])]),t._v(" "),e("p",[e("img",{attrs:{src:a(683),alt:"接口Response"}})]),t._v(" "),e("p",[e("code",[t._v("area")]),t._v("接口返回的是地理区域信息(省、市、区)，一般这个数据是几乎不会改动的，但是从上图的"),e("code",[t._v("Response Header")]),t._v("中可以看出，是一刻都不让缓存啊（小朋友，你是不是有很多的问号⚡️），下面我挑出了上图中与缓存相关的几个Header信息：")]),t._v(" "),e("ul",[e("li",[e("p",[e("strong",[t._v("cache-control")]),t._v(": "),e("code",[t._v("no-cache, no-store, max-age=0, must-revalidate")])])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("connection")]),t._v(": "),e("code",[t._v("close")])])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("expires")]),t._v(": "),e("code",[t._v("0")])])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("pragma")]),t._v(": "),e("code",[t._v("no-cache")])])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("Connection")]),t._v(": "),e("code",[t._v("keep-alive")]),t._v(" （ HTTP 长连接或持久连接）在 HTTP/1.1 协议中，默认开启 keep-alive 。"),e("a",{attrs:{href:"https://lotabout.me/2019/Things-about-keepalive/",target:"_blank",rel:"noopener noreferrer"}},[t._v("【HTTP keep-alive 二三事】"),e("OutboundLink")],1)])])]),t._v(" "),e("p",[t._v("除了这些，还有诸如： "),e("code",[t._v("Etag")]),t._v("、"),e("code",[t._v("Last-modified")]),t._v("、"),e("code",[t._v("If-Modified-Since")]),t._v("是不是一脸懵逼（同道中人），没关系，下面我们一个一个来学习。")]),t._v(" "),e("h2",{attrs:{id:"_1-缓存策略"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-缓存策略"}},[t._v("🌙")]),t._v(" 1.缓存策略")]),t._v(" "),e("p",[t._v("HTTP缓存分为强缓存和协商缓存。")]),t._v(" "),e("h3",{attrs:{id:"_1-强缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-强缓存"}},[t._v("🌙")]),t._v(" 1. 强缓存")]),t._v(" "),e("p",[t._v("即在第一次访问服务器取到数据之后，在过期时间之内不会重复请求数据，那么怎么知道过期时间呢？")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("HTTP1.0：通过"),e("code",[t._v("expires")]),t._v("响应头来实现，表示资源过期时间（一个GMT时间格式个字符串）")]),t._v(" "),e("div",{staticClass:"language-markdown line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-markdown"}},[e("code",[t._v("Response Headers\n\tconnection: keep-alive\n\tDate: Fri, 08 Dec 2019 10:18:50 GMT\n\tExpires: Sun, 08 Dec 2019 10:18:50 GMT\n\tX-Powered-By: Express\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br")])])]),t._v(" "),e("li",[e("p",[t._v("HTTP1.1：通过 "),e("code",[t._v("Cache-Control")]),t._v(" 响应头来实现。"),e("code",[t._v("Cache-Control")]),t._v("属性值：")]),t._v(" "),e("ul",[e("li",[e("p",[e("code",[t._v("max-age")]),t._v("：过期时长s")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("private")]),t._v("： 这种情况就是只有浏览器能缓存了，中间的代理服务器不能缓存。")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("no-cache")]),t._v(": 跳过当前的"),e("strong",[t._v("强缓存")]),t._v("，发送HTTP请求，即直接进入"),e("code",[t._v("协商缓存阶段")]),t._v("。")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("no-store")]),t._v("：非常粗暴，不进行任何形式的缓存。")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("s-maxage")]),t._v("：这和"),e("code",[t._v("max-age")]),t._v("长得比较像，但是区别在于s-maxage是针对代理服务器的缓存时间。")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("must-revalidate")]),t._v(": 是缓存就会有过期的时候，加上这个字段一旦缓存过期，就必须回到源服务器验证。")])])]),t._v(" "),e("p",[t._v("值得注意的是，当"),e("strong",[t._v("Expires")]),t._v("和"),e("strong",[t._v("Cache-Control")]),t._v("同时存在的时候，"),e("strong",[t._v("Cache-Control")]),t._v("会优先考虑。")])])]),t._v(" "),e("h3",{attrs:{id:"_2-协商缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-协商缓存"}},[t._v("🌙")]),t._v(" 2.协商缓存")]),t._v(" "),e("p",[t._v("协商缓存每次读取数据时都需要跟服务器通信，并且会增加缓存标识。")]),t._v(" "),e("p",[t._v("在第一次请求服务器时，服务器会返回资源，并且返回一个资源的"),e("strong",[t._v("缓存标识")]),t._v("，一起存到浏览器的缓存数据库。")]),t._v(" "),e("p",[t._v("当第二次请求资源时，浏览器会首先将"),e("strong",[t._v("缓存标识")]),t._v("发送给服务器，服务器拿到标识后判断标识是否匹配，如果不匹配，表示资源有更新，服务器会将新数据和新的缓存标识一起返回到浏览器；"),e("strong",[t._v("如果缓存标识匹配，表示资源没有更新，并且返回 "),e("code",[t._v("304")]),t._v(" 状态码")]),t._v("，浏览器就读取本地缓存服务器中的数据。")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("HTTP1.0："),e("code",[t._v("Last-Modified")]),t._v(" 和 "),e("code",[t._v("If-Modified-Since")])]),t._v(" "),e("ul",[e("li",[t._v("第一次请求资源时服务器通过 "),e("code",[t._v("Last-Modified")]),t._v(" 来设置响应头的缓存标识，并且把资源最后修改的时间作为值填入，然后将资源返回给浏览器。")]),t._v(" "),e("li",[t._v("在第二次请求时，浏览器会首先带上 "),e("code",[t._v("If-Modified-Since")]),t._v(" 请求头去访问服务器，服务器会将 "),e("code",[t._v("If-Modified-Since")]),t._v(" 中携带的时间与资源修改的时间匹配，如果时间不一致，服务器会返回新的资源，并且将 "),e("code",[t._v("Last-Modified")]),t._v(" 值更新，作为响应头返回给浏览器。如果时间一致，表示资源没有更新，服务器返回 304 状态码，浏览器拿到响应状态码后从本地缓存数据库中读取缓存资源。")])]),t._v(" "),e("p",[t._v("这种方式有一个弊端，就是当服务器中的资源增加了一个字符，后来又把这个字符删掉，本身资源文件并没有发生变化，但修改时间发生了变化。当下次请求过来时，服务器也会把这个本来没有变化的资源重新返回给浏览器。")])]),t._v(" "),e("li",[e("p",[t._v("HTTP1.1："),e("code",[t._v("Etag")]),t._v("(设置响应头缓存标识)和"),e("code",[t._v("If-None-Match")]),t._v("(保存"),e("code",[t._v("Etag")]),t._v("信息)")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("在第一次请求时，服务器会将资源和 "),e("code",[t._v("Etag")]),t._v(" 一并返回给浏览器，浏览器将两者缓存到本地缓存数据库")])]),t._v(" "),e("li",[e("p",[t._v("在第二次请求时，浏览器会将 "),e("code",[t._v("Etag")]),t._v(" 信息放到 "),e("code",[t._v("If-None-Match")]),t._v(" 请求头去访问服务器，服务器收到请求后，会将服务器中的文件标识与浏览器发来的标识进行对比，如果不相同，服务器返回更新的资源和新的 "),e("code",[t._v("Etag")]),t._v(" ，如果相同，服务器返回 "),e("code",[t._v("304")]),t._v(" 状态码，浏览器读取缓存。")])])]),t._v(" "),e("p",[t._v("同样的，一般来讲为了兼容，两个版本的协商缓存都会被实现，"),e("code",[t._v("http 1.1")]),t._v(" 版本的实现优先级会高于 "),e("code",[t._v("http 1.0")]),t._v(" 版本的实现。")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("Etag")]),t._v("主要解决了"),e("code",[t._v("Last-Modified")]),t._v("一些无法解决的问题")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("一些文件也许会周期性的更改，但是他的内容并不改变(仅仅改变的修改时间)，这个时候我们并不希望客户端认为这个文件被修改了，而重新get；")])]),t._v(" "),e("li",[e("p",[t._v("某些文件修改非常频繁，比如在秒以下的时间内进行修改，(比方说1s内修改了N次)，"),e("code",[t._v("If-modified-since")]),t._v("能检查到的粒度是秒级的，这种修改无法判断(或者说UNIX记录MTIME只能精确到秒)；")])]),t._v(" "),e("li",[e("p",[t._v("某些服务器不能精确的得到文件的最后修改时间。")])])])])]),t._v(" "),e("h2",{attrs:{id:"_2-设置强缓存与协商缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-设置强缓存与协商缓存"}},[t._v("🌙")]),t._v(" 2.设置强缓存与协商缓存")]),t._v(" "),e("p",[e("code",[t._v("了解了强缓存和协商缓存，会发现无论单独使用哪一种都无法满足我们的需要，建议：")])]),t._v(" "),e("p",[e("code",[t._v("1.HTML采用协商缓存，用户每次请求index.html不拿浏览器缓存，直接请求服务器，这样就保证资源更新了，用户能马上访问到新资源，如果服务端返回304，这时候再拿浏览器的缓存的index.html。")])]),t._v(" "),e("p",[e("code",[t._v("2.JS/CSS/IMG采用强缓存，打包的时候给文件名加上hash值")]),t._v("，见"),e("a",{attrs:{href:"https://blog.zkkysqs.top/other/webpack/Webpack%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8.html#_6-%E6%96%87%E4%BB%B6%E6%8C%87%E7%BA%B9%E7%AD%96%E7%95%A5-chunkhash%E3%80%81contenthash%E5%92%8Chash",target:"_blank",rel:"noopener noreferrer"}},[t._v("【webpack学习系列笔记-文件指纹策略】"),e("OutboundLink")],1)]),t._v(" "),e("h3",{attrs:{id:"_2-1-nodejs服务器设置缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-nodejs服务器设置缓存"}},[t._v("🌙")]),t._v(" 2.1 nodejs服务器设置缓存:")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("res"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'max-age'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3600 public'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nres"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'etag'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'5c20abbd-e2e8'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nres"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'last-modified'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Mon, 24 Sep 2020 09:49:49 GMT'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br")])]),e("h3",{attrs:{id:"_2-2-nginx配置禁用强缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-nginx配置禁用强缓存"}},[t._v("🌙")]),t._v(" 2.2 nginx配置禁用强缓存")]),t._v(" "),e("blockquote",[e("p",[e("a",{attrs:{href:"https://juejin.im/post/6844903981181829134",target:"_blank",rel:"noopener noreferrer"}},[t._v("nginx设置资源缓存实战"),e("OutboundLink")],1)])]),t._v(" "),e("div",{staticClass:"language-nginx line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v("       "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v("  localhost")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v("  /Volumes/myFile/nginx_root")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   \n     "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v("  index.html index.htm")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" Cache-Control no-cache")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 为 public可以被任何对象缓存，private只能针对个人用户，而不能被代理服务器缓存")]),t._v("\n     "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" Cache-Control private")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br")])]),e("h3",{attrs:{id:"_2-3-tomcat-设置缓存图片、js、css-等"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-tomcat-设置缓存图片、js、css-等"}},[t._v("🌙")]),t._v(" 2.3 Tomcat 设置缓存图片、JS、CSS 等")]),t._v(" "),e("blockquote",[e("p",[e("a",{attrs:{href:"http://read.pudn.com/downloads416/ebook/1767859/Tomcat%20%E8%AE%BE%E7%BD%AE%E7%BC%93%E5%AD%98%E5%9B%BE%E7%89%87JS%E5%92%8CCSS%E7%AD%89.pdf",target:"_blank",rel:"noopener noreferrer"}},[t._v("Tomcat 设置缓存图片、JS、CSS 等"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://zhangzw.com/posts/20190926.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("闲谈 Tomcat 性能优化，通过 ExpiresFilter 设置浏览器缓存"),e("OutboundLink")],1)])]),t._v(" "),e("div",{staticClass:"language-java line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpServletResponse")]),t._v(" resp "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpServletResponse")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("response"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nresp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Cache-Control"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringBuilder")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"max-age="')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nresp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setDateHeader")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Expires"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentTimeMillis")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" exp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("longValue")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000L")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br")])]),e("p",[t._v("至此，我们对HTTP缓存有了新的认识，那么我们总结一下")]),t._v(" "),e("h2",{attrs:{id:"_3-小结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-小结"}},[t._v("🌙")]),t._v(" 3.小结")]),t._v(" "),e("ul",[e("li",[t._v("HTTP缓存分为强缓存（生效的话，不用请求数据）和协商缓存（需要请求数据，可以用缓存数据返回：304 Not Modified）。")]),t._v(" "),e("li",[t._v("强缓存-HTTP1.0（expires）;HTTP1.1（cache-control）。")]),t._v(" "),e("li",[t._v("协商缓存-HTTP1.0（"),e("code",[t._v("Last-Modified")]),t._v(" 和 "),e("code",[t._v("If-Modified-Since")]),t._v("）;HTTP1.1("),e("code",[t._v("Etag")]),t._v("(设置响应头缓存标识)和"),e("code",[t._v("If-None-Match")]),t._v("(保存"),e("code",[t._v("Etag")]),t._v("信息))。")]),t._v(" "),e("li",[t._v("为了兼容,一般HTTP1.0和HTTP1.1两种缓存策略都会加上，其中HTTP1.1优先级更高。")]),t._v(" "),e("li",[e("code",[t._v("max-age=0,must-revalidate")]),t._v("和"),e("code",[t._v("no-cache")]),t._v("等效，")])]),t._v(" "),e("p",[t._v("策略：")]),t._v(" "),e("ul",[e("li",[t._v("如果资源不可复用，直接为Cache-Control设置no-store，拒绝一切形式的缓存；")]),t._v(" "),e("li",[t._v("如果资源可复用，考虑是否每次都需要向服务器进行缓存确认，如果是，设置Cache-Control的值为no-cache；")]),t._v(" "),e("li",[t._v("如果不需要每次都向服务器确认，考虑资源是否可以被代理服务器缓存，根据其结果决定是设置为private还是public；")]),t._v(" "),e("li",[t._v("接下来考虑资源的过期时间，设置对应的max-age；")]),t._v(" "),e("li",[t._v("最后，配置协商缓存需要用到的Etag、Last-Modified等参数。")])]),t._v(" "),e("blockquote",[e("p",[e("strong",[t._v("推荐")]),t._v("："),e("a",{attrs:{href:"https://www.toutiao.com/i6734112972387385864/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CDN缓存控制原理，看看能不能难住你"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("strong",[t._v("推荐")]),t._v("："),e("a",{attrs:{href:"https://github.com/amandakelake/blog/issues/43",target:"_blank",rel:"noopener noreferrer"}},[t._v("【缓存（一）——缓存总览：从性能优化的角度看缓存】"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://www.cnblogs.com/chenqf/p/6386163.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("彻底弄懂HTTP缓存机制及原理"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://blog.zkkysqs.top/other/webpack/Webpack%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8.html#_6-%E6%96%87%E4%BB%B6%E6%8C%87%E7%BA%B9%E7%AD%96%E7%95%A5-chunkhash%E3%80%81contenthash%E5%92%8Chash",target:"_blank",rel:"noopener noreferrer"}},[t._v("【webpack学习系列笔记-文件指纹策略】"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://blog.csdn.net/huwei2003/article/details/70139062?utm_medium=distribute.pc_relevant.none-task-blog-title-1&spm=1001.2101.3001.4242",target:"_blank",rel:"noopener noreferrer"}},[t._v("【HTTP 304状态码的详细讲解】"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://blog.csdn.net/weixin_30443895/article/details/96133353?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-6.channel_param&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-6.channel_param",target:"_blank",rel:"noopener noreferrer"}},[t._v("【利用nginx设置浏览器协商缓存】"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://www.jianshu.com/p/f080181021cb",target:"_blank",rel:"noopener noreferrer"}},[t._v("详解HTTP的缓存机制与原理"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://lotabout.me/2019/TCP-connection-establish-and-termination/",target:"_blank",rel:"noopener noreferrer"}},[t._v("【复习：TCP 三次握手、四次挥手】"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=n.exports},683:function(t,e,a){t.exports=a.p+"assets/img/cache-header.b0d9201e.png"}}]);